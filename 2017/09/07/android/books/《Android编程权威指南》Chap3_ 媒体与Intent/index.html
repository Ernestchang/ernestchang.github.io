<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>《Android编程权威指南》Chap3_ 媒体与Intent | The Old Man and the Sea</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="这本书属于入门, 有很多内容可以当做扩展来了解一些API, 并且有的时候可以适当的利用Google提供好的API来做一些高效开发节约时间成本. 原理东西本书偏少. 可以学习本书中的代码的编写风格, 书中代码都是采用MVC模型来编写的. 就写这么多, 下面开始整理一些小知识点.注：本文主要参考http://szysky.com 关于Camera和SurfaceView的知识点练习都保存在仓库中的C">
<meta name="keywords" content="android">
<meta property="og:type" content="article">
<meta property="og:title" content="《Android编程权威指南》Chap3_ 媒体与Intent">
<meta property="og:url" content="http://yoursite.com/2017/09/07/android/books/《Android编程权威指南》Chap3_ 媒体与Intent/index.html">
<meta property="og:site_name" content="The Old Man and the Sea">
<meta property="og:description" content="这本书属于入门, 有很多内容可以当做扩展来了解一些API, 并且有的时候可以适当的利用Google提供好的API来做一些高效开发节约时间成本. 原理东西本书偏少. 可以学习本书中的代码的编写风格, 书中代码都是采用MVC模型来编写的. 就写这么多, 下面开始整理一些小知识点.注：本文主要参考http://szysky.com 关于Camera和SurfaceView的知识点练习都保存在仓库中的C">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://szysky.com/2016/09/09/%E3%80%8AAndroid%E7%BC%96%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E9%9A%8F%E8%AE%B0%E4%B8%89-%E5%AA%92%E4%BD%93%E4%B8%8EIntent%E7%AD%89/Launch.png">
<meta property="og:image" content="http://szysky.com/2016/09/09/%E3%80%8AAndroid%E7%BC%96%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E9%9A%8F%E8%AE%B0%E4%B8%89-%E5%AA%92%E4%BD%93%E4%B8%8EIntent%E7%AD%89/taskStack.png">
<meta property="og:image" content="http://szysky.com/2016/09/09/%E3%80%8AAndroid%E7%BC%96%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E9%9A%8F%E8%AE%B0%E4%B8%89-%E5%AA%92%E4%BD%93%E4%B8%8EIntent%E7%AD%89/xmlPullParser.png">
<meta property="og:updated_time" content="2017-09-07T10:10:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《Android编程权威指南》Chap3_ 媒体与Intent">
<meta name="twitter:description" content="这本书属于入门, 有很多内容可以当做扩展来了解一些API, 并且有的时候可以适当的利用Google提供好的API来做一些高效开发节约时间成本. 原理东西本书偏少. 可以学习本书中的代码的编写风格, 书中代码都是采用MVC模型来编写的. 就写这么多, 下面开始整理一些小知识点.注：本文主要参考http://szysky.com 关于Camera和SurfaceView的知识点练习都保存在仓库中的C">
<meta name="twitter:image" content="http://szysky.com/2016/09/09/%E3%80%8AAndroid%E7%BC%96%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E9%9A%8F%E8%AE%B0%E4%B8%89-%E5%AA%92%E4%BD%93%E4%B8%8EIntent%E7%AD%89/Launch.png">
    

    
        <link rel="alternate" href="/" title="The Old Man and the Sea" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">The Old Man and the Sea</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="https://ernestchang.github.io/2017/08/23/other/about/">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/uploads/images/avert.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="https://ernestchang.github.io/2017/08/23/other/about/">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/uploads/images/avert.png" />
            <h2 id="name">Ernest Chang</h2>
            <h3 id="title">Developer &amp; Designer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Hangzhou, China</span>
            <a id="follow" target="_blank" href="https://github.com/Ernestchang/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                75
                <span>posts</span>
            </div>
            <div class="article-info-block">
                21
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Ernestchang/" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-android/books/《Android编程权威指南》Chap3_ 媒体与Intent" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            《Android编程权威指南》Chap3_ 媒体与Intent
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/07/android/books/《Android编程权威指南》Chap3_ 媒体与Intent/">
            <time datetime="2017-09-07T09:02:19.000Z" itemprop="datePublished">2017-09-07</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android编程权威指南》/">《Android编程权威指南》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>这本书属于入门, 有很多内容可以当做扩展来了解一些API, 并且有的时候可以适当的利用Google提供好的API来做一些高效开发节约时间成本. 原理东西本书偏少. 可以学习本书中的代码的编写风格, 书中代码都是采用<strong>MVC</strong>模型来编写的. 就写这么多, 下面开始整理一些小知识点.<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
<p>关于Camera和SurfaceView的知识点练习都保存在仓库中的<strong>Criminal</strong>项目中.<br><a href="https://github.com/suzeyu1992/AndroidProgramminGuide" target="_blank" rel="external">git地址</a></p>
</blockquote>
<h2 id="MediaPlay播放音频"><a href="#MediaPlay播放音频" class="headerlink" title="MediaPlay播放音频"></a>MediaPlay播放音频</h2><blockquote>
<p><code>MediaPlayer</code>是一个支持音频及视频文件播放的Android类. 可播放不同的来源(本地或网络流媒体).多种格式(WAV, MP3, MPEG-4, 3GPP等)的多媒体文件.</p>
</blockquote>
<p>直接贴出代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Author :  suzeyu</div><div class="line"> * Time   :  2016-09-07  上午10:17</div><div class="line"> * Blog   :  http://szysky.com</div><div class="line"> * GitHub :  https://github.com/suzeyu1992</div><div class="line"> *</div><div class="line"> * ClassDescription : 主要用来管理MediaPlayer的实例, 和对该实例的播放和停止等功能</div><div class="line"> */</div><div class="line"></div><div class="line">public class AudioPlayer &#123;</div><div class="line"></div><div class="line">    private MediaPlayer mPlayer;</div><div class="line"></div><div class="line">    public void stop()&#123;</div><div class="line">        if (mPlayer != null)&#123;</div><div class="line">            // 销毁, 否则MediaPlayer将一直占用着音频解码硬件及其他系统资源</div><div class="line">            mPlayer.release();</div><div class="line">            mPlayer = null;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void play(Context context)&#123;</div><div class="line">        // 防止过多的创建MediaPlayer实例, 第一步先销毁已经存在的</div><div class="line">        stop();</div><div class="line"></div><div class="line">        //  设置要播放的音频文件, 如果音频来自其他渠道如网络或者URI, 则使用其他的create(...)函数</div><div class="line">        mPlayer = MediaPlayer.create(context, R.raw.ss_small);</div><div class="line">        mPlayer.start();</div><div class="line"></div><div class="line">        // 防止过多的创建MediaPlayer实例, 第二步设置监听, 存活时间为音频的时长</div><div class="line">        mPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onCompletion(MediaPlayer mp) &#123;</div><div class="line">                // 音频播放完成</div><div class="line">                stop();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>记得在<code>res/raw/</code>放置要播放的文件. 一个简便的播放就是这样.详细的查看官网的对于<code>MediaPlayer</code>的介绍</p>
<h2 id="播放视频"><a href="#播放视频" class="headerlink" title="播放视频"></a>播放视频</h2><p>关于播放视频, <code>Android</code>提供了多种实现方式. 其一便是使用上面说到的<code>MediaPlayer</code>, 而我们需要做的只是设置在哪里播放即可.</p>
<p>在<code>Android</code>系统中, 快速刷新显示的可视图像(如视频)是在<code>SurfaceView</code>中显示的. 准确的说, 是在<code>SurfaceView</code>内嵌的<code>Surface</code>中显示的. 通过获取<code>SurfaceView的SurfaceHolder</code>可是实现在<code>Surface</code>上显示视频. 简单的说就是通过<code>MediaPlayer.setDisplay(SurfaceHolder)</code>方法, 将<code>MediaPlayer</code>类于<code>SurfaceHolder</code>关联起来即可.</p>
<p>通常来说直接使用<code>VideoView</code>实例来播放视频会更简单些, 不同于<code>SurfaceView于MediaPlayer</code>之间的交互, <code>VideoView是与MediaController</code>交互的, 这样可以方便地提供视频播放界面. 而<code>VideoView</code>是不接受<em>ID资源的</em>. 而只接受文件路径或者URI对象.</p>
<p>创建一个指向<strong>Android资源</strong>的URI, 可使用如下代码:</p>
<p><code>Uri resourceUri = Uri.parse(&quot;android.resource://包名/raw/文件名称&quot;);</code></p>
<p>使用了<code>android.resource</code>格式, 用包名作为主机名, 资源文件类型与文件名称组成了一个路径用以创建URI.完成后就可以将其传给<code>VideoView</code>使用.</p>
<h2 id="Camera与SurfaceView"><a href="#Camera与SurfaceView" class="headerlink" title="Camera与SurfaceView"></a>Camera与SurfaceView</h2><ul>
<li><code>Camera:</code>提供了对设备相机硬件级别的调用. 相机是一种<strong>独占性资源</strong>: 一次只能有一个activity调用(如果你的应用没有释放相机资源,那么系统的相机也就无法调起使用)</li>
<li><code>SurfaceView:</code>这是一种特殊的视图, 可直接将要显示的内容渲染输出到设备的屏幕上.</li>
</ul>
<p>首先既然使用了相机那么就需要添加相机的使用权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;!--增加相机使用权限--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot;/&gt;</div><div class="line">&lt;!--指定应用使用的某项特色功能, 这个属性可以保证那些配备相机功能的设备才能看到发布在GooglePlay上的此应用--&gt;</div><div class="line">&lt;uses-feature android:name=&quot;android.hardware.camera&quot;/&gt;</div></pre></td></tr></table></figure>
<p><code>uses-feature</code>对我们貌似没什么用处.</p>
<p>既然是拍照那么很多都是横屏的,所以清单文件中把所在的<code>&lt;activity&gt;</code>设置横屏模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;activity android:name=&quot;.activity.CrimeCameraActivity&quot;</div><div class="line">            android:screenOrientation=&quot;landscape&quot;/&gt;</div></pre></td></tr></table></figure>
<hr>
<p><strong>开始了解相机使用</strong></p>
<ul>
<li><code>public static Camera open(int)</code></li>
<li><code>public static Camera release()</code></li>
</ul>
<p>这两个方法是管理<code>Camera</code>的方法. 最好用户可以与界面进行交互分别调用. 如<code>onResume()</code>和<code>onPause()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onResume() &#123;</div><div class="line">  super.onResume();</div><div class="line">  // 0为打开后置摄像头, 如果没有后置摄像头那么就打开前置摄像头</div><div class="line">  mCamera = Camera.open(0);</div><div class="line">&#125;</div><div class="line">    </div><div class="line">@Override</div><div class="line">public void onPause() &#123;</div><div class="line">  super.onPause();</div><div class="line">  if(mCamera != null)&#123;</div><div class="line">      mCamera.release();</div><div class="line">      mCamera = null;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>相机打开了现在轮到Surface,因为Camera的拍照需要它</strong></p>
<p><code>SurfaceView</code>类实现了<code>SurfaceHolder</code>接口. 首先我们先获取<code>SurfaceHolder</code>实例.(在<code>Activity#onCreate</code>或者<code>Fragment#onCreateView()</code>只要能保证布局已经加载就可以)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">*  对SurfaceView控件进行一些初始化和绑定客户端Camera</div><div class="line">*/</div><div class="line">private void initSurfaceView(View rootView) &#123;</div><div class="line">   mV_sfv_camera = (SurfaceView) rootView.findViewById(R.id.sfv_camera_display);</div><div class="line">   SurfaceHolder holder = mV_sfv_camera.getHolder();</div><div class="line">   // setType设置只为兼容旧版本3.0之前,可以选择考虑是否需要</div><div class="line">   holder.setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);</div><div class="line"></div><div class="line">   //  对SurfaceView的声明周期进行关联</div><div class="line">   holder.addCallback(new SurfaceHolder.Callback() &#123;</div><div class="line"></div><div class="line">       /** SurfaceView的视图层级结构被放在屏幕上时候被调用, 这里也是SurfaceView与客户端(Camera)进行关联的地方*/</div><div class="line">       @Override</div><div class="line">       public void surfaceCreated(SurfaceHolder holder) &#123;</div><div class="line">           try &#123;</div><div class="line">               if (mCamera != null) &#123;</div><div class="line">                   mCamera.setPreviewDisplay(holder);</div><div class="line">               &#125;</div><div class="line">           &#125; catch (IOException e) &#123;</div><div class="line">               Log.e(TAG, &quot;@@-&gt; Camera设置关联SurfaceView预览显示失败!&quot; );</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       /**  Surface首次显示在屏幕上的时候被动调用的方法, 通过此参数可以知道Surface的像素格式以及他的宽高.</div><div class="line">        通过此方法可以通知Surface客户端, 有多大的绘制区域可以使用. */</div><div class="line">       @Override</div><div class="line">       public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) &#123;</div><div class="line">           if (mCamera == null) return;</div><div class="line">           // The surface has change size, update the camera preview size</div><div class="line">           Camera.Parameters parameters = mCamera.getParameters();</div><div class="line">           Camera.Size size = getSupportedSize(parameters.getSupportedPreviewSizes(), width, height);</div><div class="line">           //  设置图片尺寸大小</div><div class="line">           parameters.setPictureSize(size.width, size.height);</div><div class="line"></div><div class="line">           mCamera.setParameters(parameters);</div><div class="line"></div><div class="line">           try &#123;</div><div class="line">               //  开始在Surface上绘制</div><div class="line">               mCamera.startPreview();</div><div class="line">           &#125;catch (Exception e)&#123;</div><div class="line">               //  如果开始预览绘制失败那么我们通过这里来释放相机资源</div><div class="line">               Log.e(TAG, &quot;@@-&gt; startPreview()启动失败, 准备释放相机资源!&quot; );</div><div class="line">               mCamera.release();</div><div class="line">               mCamera = null;</div><div class="line"></div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       /** SurfaceView从屏幕上移除时, Surface也随之被销毁, 通过客户端停止使用Surface*/</div><div class="line">       @Override</div><div class="line">       public void surfaceDestroyed(SurfaceHolder holder) &#123;</div><div class="line">           if (mCamera != null)&#123;</div><div class="line">               mCamera.stopPreview();</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">*  找出具有最大数目的像素的尺寸</div><div class="line">*/</div><div class="line">private Camera.Size getSupportedSize(List&lt;Camera.Size&gt; sizes, int width, int height)&#123;</div><div class="line">   Camera.Size bestSize = sizes.get(0);</div><div class="line">   int largestArea = bestSize.width * bestSize.height;</div><div class="line">   for (Camera.Size s : sizes) &#123;</div><div class="line">       int area = s.width * s.height;</div><div class="line">       if (area &gt; largestArea)&#123;</div><div class="line">           bestSize = s;</div><div class="line">           largestArea = area;</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   return bestSize;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>SurfaceHolder</code>是我们与<code>Surface</code>对象联系的纽带. <code>Surface</code>对象代表着原始像素数据的缓冲区.</p>
<p><code>Surface</code>对象也有生命周期: <code>SurfaceView</code>出现在屏幕上时, 会创建<code>Surface</code>; <code>SurfaceView</code>从屏幕上消失的时候,<code>Surface</code>随即被销毁. <code>Surface</code>不存在的时候, 必须保证没有任何内容要在它上面绘制.</p>
<p>不像其他视图一样, <code>SurfaceView</code>及其协同工作对象都不会自我绘制内容. 对于任何想要将内容绘制到<code>Surface</code>缓冲区的对象, 我们都称其为<code>Surface</code>的客户端. 比如这里的<code>Camera</code></p>
<p>为了对应<code>Surface</code>各个生命周期, <code>SurfaceHolder</code>提供了另外一个接口<code>SurfaceHolder.Callback</code>来关联.</p>
<p><strong>确定预览界面的大小</strong></p>
<p>可能看到了<code>surfaceChanged()</code>的生命周期回调中设置了<code>Camera</code>实例的一个属性大小.</p>
<p>首先要知道<strong>相机的预览大小不能随意设置</strong>, 如果设置了不可接受的值有可能会出现崩溃. 所以我们应该先获取到设备相机所支持的预览尺寸大小. 通过<code>Camera.Parameters</code>类中的<code>getSupportedPreviewSizes()</code>就可以获取到<strong>相机的支持的预览尺寸列表</strong>.</p>
<p>这个方法返回的是一个<code>List&lt;Camera.Size&gt;</code>, 泛型<code>Camera.Size</code>每一个实例都封装了一个具体的图片宽高尺寸. 利用<code>getSupportedSize()</code>简便的比较方法可以达到选择一个最大的像素尺寸.</p>
<p><strong>有可能你会需要先检测设备是否有前后相机</strong></p>
<p>可以获取到<code>PackageManager</code>后, 调用<code>hasSystemFeature(String)</code>方法并传入表示设备特色功能的常量即可根据布尔值来判断. <code>FEATURE_CAMERA</code>常量代表后置相机, <code>FEATURE_CAMERA_FRONT</code>常量代表前置相机.</p>
<p><strong>目前为止相机开启并渲染值Surface应该没问题了,下面就是利用Camera进行照片</strong></p>
<p>主要逻辑就是从相机的实时预览中捕获一帧图像, 然后将其保存为JPEG格式的文件. 而要进行拍摄需要<code>Camera#takePicture(Camera.shutterCallback shutter, Camera.PictureCallback raw, Camera.PictureCallback jpeg)</code></p>
<ul>
<li><code>shutterCallback</code> 此回调里面的方法会在相机捕获图像的时候调用, 但此时图像数据还未处理完成.</li>
<li><code>第一个PictureCallback</code> 回调方法是在原始图像数据可用时调用, 通常来说, 是在加工处理原始图像数据且没有存储之前.</li>
<li><code>第二个PictureCallback</code> 回调方法是在JPEG版本的图像可用时候调用.</li>
</ul>
<p>如果不需要某一个步骤的回调可以直接传递null. 这里我们实现参数一和参数三的回调, 首先定义回调如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">*  在进行快门的时候进行进度条View的显示</div><div class="line">*/</div><div class="line">private Camera.ShutterCallback mShutterCallback = new Camera.ShutterCallback() &#123;</div><div class="line">   @Override</div><div class="line">   public void onShutter() &#123;</div><div class="line">       //  这里我做了照相开始时候显示进度条, 如果为了练习这里可以不需要</div><div class="line">       mVFlProgress.setVisibility(View.VISIBLE);</div><div class="line">   &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">/**</div><div class="line">*  Camera如果快门之后有数据处理生成成功,  那么会调此回调, 可以进行把数据写入到本地的动作</div><div class="line">*/</div><div class="line">private Camera.PictureCallback mJpegCallback = new Camera.PictureCallback() &#123;</div><div class="line">   @Override</div><div class="line">   public void onPictureTaken(byte[] data, Camera camera) &#123;</div><div class="line">       // create a filename</div><div class="line">       String filename = UUID.randomUUID().toString()+&quot;.jpg&quot;;</div><div class="line">       //  save the jpeg date to disk</div><div class="line">       FileOutputStream out = null;</div><div class="line">       try &#123;</div><div class="line">           // 获得输出流进行数据的写入</div><div class="line">           out = mContext.openFileOutput(filename, Context.MODE_PRIVATE);</div><div class="line">           out.write(data);</div><div class="line">       &#125; catch (IOException e) &#123;</div><div class="line">           Log.e(TAG, &quot;onPictureTaken: @@-&gt; 图片写入disk失败, 失败文件地址:&quot;+filename, e );</div><div class="line">       &#125;finally &#123;</div><div class="line">           // 进行清扫动作, 关流</div><div class="line">           if (out != null)&#123;</div><div class="line">               try &#123;</div><div class="line">                   out.close();</div><div class="line">               &#125; catch (IOException e) &#123;</div><div class="line">                   Log.e(TAG, &quot;onPictureTaken: @@-&gt; 流文件关流失败, 失败文件地址:&quot;+filename, e );</div><div class="line">                  </div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">      Log.i(TAG, &quot;onPictureTaken(): 照片 JPEG 保存成功, 即将关闭activity, 保存地址:&quot;+filename);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>回调定义好了之后, 剩下的只需要搞一个按钮, 添加点击事件通过调用<code>Camera</code>的实例的<code>takePicture()</code>传入自定义的回调方法即可.</p>
<p><strong>扩展:</strong></p>
<p>如果需要显示大图可以直接<code>DialogFragment</code>.</p>
<ol>
<li>首先设置<code>Fragment</code>的样式为<code>DialogFragment.STYLE_NO_TITLE</code>.</li>
<li>因为想要的效果为一个图片查看放大, 那么不需要显示<code>AlertDialog</code>视图自带的标题和按钮. 所以可以直接复写<code>onCreateView()</code>方法使用一个简单视图, 比覆盖<code>onCreateDialog()</code>方法使用<code>Dialog</code>更简单.快捷灵活.</li>
<li>通过文件的路径得到<code>Bitmap</code>设置到在<code>onCreateView()</code>中创建并返回的<code>ImageView</code>即可.</li>
</ol>
<h2 id="隐式Intent"><a href="#隐式Intent" class="headerlink" title="隐式Intent"></a>隐式Intent</h2><p>在<code>Android</code>系统中, 使用<strong>隐式Intent</strong>可以启动其他应用的activity. 在<strong>显示Intent</strong>中, 需要指定要启动的<code>activity</code>类. 操作系统会负责启动它. 而<strong>隐式Intent</strong>中, 只要描述清楚要完成的任务, 操作系统会找到合适的应用. 并在其中启动相应的<code>activity</code>.</p>
<p><strong>典型的隐式Intent的组成</strong></p>
<ul>
<li><strong>要执行的动作(action)</strong>: 通常以<code>Intent</code>类中的常量进行表示. 例如要访问查看某个<code>URL</code>,可以使用<code>Intent_ACTION_VIEW</code>; 要发送邮件,可以使用<code>Intent.ACTION_SEND</code></li>
<li><strong>要发送的数据位置以及数据类型</strong>: 数据位置的话可能会是某个网页的<code>URL</code>,也可能是指向某个文件的<code>URI</code>, 或者指向<code>ContentProvider</code>中某条记录的某个内容<code>URI</code>; 数据类型这里指的是<code>MIME</code>形式的数据类型, 如<code>text/html</code>或者<code>audio/mpeg3</code>. 如果一个intent包含某类数据的位置, 那么通常可以从中推测出数据的类型.</li>
<li><strong>可选类别(category)</strong>: 如果<code>action</code>用于描述具体要做什么, 那么类别通常用来描述我们<strong>何时,何地或者说如何使用</strong>某个activity. <code>android.intent.category.LAUNCHER</code>类别表明, activity应该显示在顶级应用启动器中. 而<code>android.intent.category.INFO</code>类别表明,虽然activity向用户显示了包信息, 但它不应该显示在启动器中.</li>
</ul>
<p><strong>而在配置清单文件中的intent过滤器设置时</strong></p>
<ul>
<li><code>&lt;action&gt;</code>: 告诉操作系统, activity能够处理指定的哪个action动作.</li>
<li><code>&lt;category&gt;</code>: 一般情况下都是要指定<code>DEFAULT</code>类别. 每发起<strong>隐式intent</strong>如果没有指定<code>category那么系统都会默认的添加</code>DEFALUT`类别.</li>
</ul>
<p>操作系统进行<code>隐式Intent</code>寻找的时候, 是不需要使用数据(extra)来参与匹配规则的.</p>
<p><strong>利用Intent选择器</strong></p>
<p>比如打开一个视频文件的时候, 如果手机上有多个选择的话可能会弹出一个全部列表, 然后选择一个进行播放, 而之后会发现再也不会询问用户使用哪个视频播放软件进行播放. 对于这种情况有时候或许不需要, 这个时候就可以使用<strong>选择器</strong>来创建一个activity来展示可打开的软件, 每次都进行选择. 使用很简单.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Intent intent = new Intent();</div><div class="line">intent.setType(&quot;text/plain&quot;);</div><div class="line">intent.putExtra(Intent.EXTRA_TEXT, getCrimeReport());</div><div class="line">intent.putExtra(Intent.EXTRA_SUBJECT, getString(R.string.crime_report_subject));</div><div class="line"></div><div class="line">// 设置一个选择每一次都显示activity的选择器. </div><div class="line">// 这是重点</div><div class="line">intent= intent.createChooser(intent, getString(R.string.send_report));</div><div class="line"></div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<p>通过<code>createChooser()</code>方法重新构建一个<code>intent</code>即可, 参数二传递的字符串是用来作为弹出的选择界面的标题.</p>
<p><strong>再说一下获取联系人信息</strong></p>
<p>如果要获取手机通讯录, 那么要指定<code>action</code>,并且要找指定获取位置; action对应的<code>Intent.ACTION_PICK</code>. 获取的位置为<code>ContactsContract.Contacts.CONTENT_URI</code>. 就是请求Android协助从手机联系人数据库获取某个具体联系人.</p>
<p>打开手机联系人代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 打开联系人Contract列表</div><div class="line">// 这是通讯录应用将其权限临时给了本应用, 首先通讯录应用对联系人的数据库具有全部权限. 所以在通讯录应用</div><div class="line">// 返回包含在Intent中的URI的时候, 他会添加一个Intent.FLAG_GRANT_READ_URI_PERMISSION标识,</div><div class="line">// 此标志向系统表示, 我们这个应用可以使用联系人数据一次.</div><div class="line">Intent intent = new Intent(Intent.ACTION_PICK, ContactsContract.Contacts.CONTENT_URI);</div><div class="line"></div><div class="line">// 检测是否有接收此Intent的应用</div><div class="line">List&lt;ResolveInfo&gt; resolveInfos = getActivity().getPackageManager().queryIntentActivities(intent, 0);</div><div class="line"></div><div class="line">if (resolveInfos.size() &gt; 0)&#123;</div><div class="line">startActivityForResult(intent, REQUEST_CONTACT);</div><div class="line">&#125;else&#123;</div><div class="line">Toast.makeText(getActivity().getApplicationContext(), &quot;无法打开Intent&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码很容易懂, 并且做了一定的防错处理. 接下来就准备接收返回结果就可以在<code>onActivityResult()</code>中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">if (requestCode == REQUEST_CONTACT)&#123;</div><div class="line">  //  打开联系人列表关闭后返回的逻辑</div><div class="line"></div><div class="line">  //  从intent取出URI, 该数据URI是一个指向用户所选联系人的定位符.</div><div class="line">  Uri contactUri = data.getData();</div><div class="line"></div><div class="line">  //  specify which fields you want you query to return values for</div><div class="line">  //  指定在返回数据的时候所对应查找的字段</div><div class="line">  String[] queryFileds = &#123;ContactsContract.Contacts.DISPLAY_NAME&#125;;</div><div class="line"></div><div class="line">  //  perform query</div><div class="line">  Cursor query = getActivity().getContentResolver().query(contactUri, queryFileds, null, null, null);</div><div class="line"></div><div class="line">  if (query.getCount() == 0)&#123;</div><div class="line">      query.close();</div><div class="line">      return;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // 获取嫌疑人的姓名 添加到陋习记录中的suspect</div><div class="line">  query.moveToFirst();</div><div class="line">  String suspect = query.getString(0);</div><div class="line"></div><div class="line">  // 拿到了姓名 可以做后续的事情....</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面获得了一个<code>Cursor</code>, 因为已经知道<code>Cursor</code>只是包含一条记录, 所以将<code>Cursor</code>移动到第一条记录并获取它的字符串形式.就是姓名.</p>
<p>上面代码中有两句话是对可以响应的<code>activity</code>做检查. 通过<code>PackageManager#queryIntentActivitys()</code>返回集合的size大小来决定是否可以执行后续的操作.</p>
<p><strong>打电话的隐式Intent</strong></p>
<p>电话相关的<code>Intent</code>有两种</p>
<ul>
<li><code>Intent.ACTION_DIAL</code>: 选择联系人(得到号码发送一个<code>tel:xxx</code>数据uri)之后会停止到拨号界面等待用户手动呼叫</li>
<li><code>Intent.ACTION_CALL</code>: 选择联系人(得到号码发送一个<code>tel:xxx</code>数据uri)之后会立即拨打出去. 而不会等待用户的手动拨打.</li>
</ul>
<h2 id="深入了解Intent"><a href="#深入了解Intent" class="headerlink" title="深入了解Intent"></a>深入了解Intent</h2><p>利用<code>隐式的Intent</code>可以创建一个启动器来替换系统默认的启动器应用. 例如这样:</p>
<p><img src="http://szysky.com/2016/09/09/%E3%80%8AAndroid%E7%BC%96%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E9%9A%8F%E8%AE%B0%E4%B8%89-%E5%AA%92%E4%BD%93%E4%B8%8EIntent%E7%AD%89/Launch.png" alt="img"></p>
<p>展示出来手机上面的所有应用, 选择一个并可以打开, 有点丑, 你也可以设置上图片. 显示实现这个直接贴出代码.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">//  创建一个隐式Intent, 从PackageManager中获取匹配intent的activity列表</div><div class="line">Intent intent = new Intent(Intent.ACTION_MAIN);</div><div class="line">intent.addCategory(Intent.CATEGORY_LAUNCHER);</div><div class="line"></div><div class="line">PackageManager pm = getActivity().getPackageManager();</div><div class="line">List&lt;ResolveInfo&gt; resolveInfos = pm.queryIntentActivities(intent, 0);</div><div class="line"></div><div class="line">Log.i(TAG, &quot;onCreate: 可以打开的数量:&quot;+resolveInfos.size());</div><div class="line"></div><div class="line">//  进行排序</div><div class="line">Collections.sort(resolveInfos, new Comparator&lt;ResolveInfo&gt;() &#123;</div><div class="line">  @Override</div><div class="line">  public int compare(ResolveInfo o1, ResolveInfo o2) &#123;</div><div class="line">      PackageManager pm = getActivity().getPackageManager();</div><div class="line">      //  按照名称进行排序</div><div class="line">      int result = String.CASE_INSENSITIVE_ORDER.compare(o1.loadLabel(pm).toString(), o2.loadLabel(pm).toString());</div><div class="line">      return result;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">​``` </div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">首先利用`PackageManager`对`Main/Launcher`进行匹配, 这个没什么说的, 所有的应用都有一个启动入口就是这个. 可以得到所有应用的入口信息集合. </div><div class="line"></div><div class="line">这里有一点需要了解: **`MAIN/LAUNCHER`intent过滤器不能`startActivity()`这种方式发送的`MAIN/LAUNCHER`相匹配**.  因为对于`类别category为Launcher`的时候, 系统是不希望你通过隐式Intent的方式去打开. 而是要你使用显示intent. 一般情况下隐式Intent打开的时候系统总是会给你添加`category为default`的类别. 所以可以认为`隐式Intent`打开的基本都是过滤器信息中类别包含为`Default`的类别的Intent. 而这一点在系统的入口`activity`过滤其中却无法得到保证. </div><div class="line"></div><div class="line">定义了`MAIN/LAUNCHER`过滤器的activity是应用的主要入口, 它只关心作为应用主要入口点要处理的工作. 通常不关心自己是否属于默认的主要入口点, 因此,他也就不必包含`CATEGORY_DEFAULT`类别. </div><div class="line"></div><div class="line">**但好在我们可以通过隐式的`MAIN/LAUNCHER`**查到匹配的`activity`集合信息, 而不需要先打开. 通过集合中的每个activity的`ResolveInfo`实例得到`ActivityInfo`我们也就可以得到**包名, 类名**. 那么就可以通过**显示Intent打开**! 如下代码</div><div class="line"></div><div class="line">通过上面得到的集合, 随便获取一个`resolveInof`实例.</div><div class="line"></div><div class="line">​```java</div><div class="line">ResolveInfo resolveInfo = (ResolveInfo) resolveInfos.get(0);;</div><div class="line"></div><div class="line">//  准备获取要打开activity的包名 类名等信息</div><div class="line">ActivityInfo activityInfo = resolveInfo.activityInfo;</div><div class="line"></div><div class="line">if (activityInfo == null) return;</div><div class="line"></div><div class="line">// 创建显示Intent来打开Activity</div><div class="line">//  先指定一个action</div><div class="line">Intent intent = new Intent(Intent.ACTION_MAIN);</div><div class="line">intent.setClassName(activityInfo.applicationInfo.packageName, activityInfo.name);</div><div class="line">//  添加新任务标识给intent</div><div class="line">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</div><div class="line"></div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<p>上面使用的是<code>setClassName()</code>方法, 这个方法可以自动创建<strong>组件名</strong>, 也可以自己通过类名和包名创建一个<strong>ComponentName</strong>, 然后使用<code>setComponent()</code>创建一个显示的intent.</p>
<p>上面还添加了一个<code>FLAG</code>, 主要的区别就是没有这个<code>Flag</code>的话, 那么打开的新应用的界面本质上是存在我们的<strong>应用任务栈中</strong>, 如果有那么就会在<strong>属于自己独立的任务中</strong>. 如下图, 在我们自己的应用打开同一个任务. 然后查看任务管理器. (前面为没有添加flag的)</p>
<p><img src="http://szysky.com/2016/09/09/%E3%80%8AAndroid%E7%BC%96%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E9%9A%8F%E8%AE%B0%E4%B8%89-%E5%AA%92%E4%BD%93%E4%B8%8EIntent%E7%AD%89/taskStack.png" alt="img"></p>
<p>至此, 现在这个应用可以得到手机的全部应用并可以做为展示列表. 但是还没完, 还差一点<strong>将我们这个应用作为设备主屏幕</strong>.</p>
<p>没有人愿意通过一个应用来启动另一个应用, 所以要做的就是替换<code>Android主界面</code>配置我们应用的启动<code>activity</code>再添加两个类别category,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;activity android:name=&quot;.NerdLauncherActivity&quot;&gt;</div><div class="line">  &lt;intent-filter&gt;</div><div class="line">      &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">      &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line"></div><div class="line">      &lt;category android:name=&quot;android.intent.category.HOME&quot;/&gt;</div><div class="line">      &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</div><div class="line">  &lt;/intent-filter&gt;</div><div class="line">&lt;/activity&gt;</div></pre></td></tr></table></figure>
<h2 id="应用图标与任务重排"><a href="#应用图标与任务重排" class="headerlink" title="应用图标与任务重排"></a>应用图标与任务重排</h2><p>通过上面的获得的<code>ResolveInfo.loadLable()</code>方法, 可以获取各个<code>activity</code>的名称, 其中还有一个方法<code>loadIcon()</code>可以使用该方法为每一个应用加载显示图标.</p>
<p>关于<strong>任务重排</strong>, 需要使用<code>ActivityManager</code>系统服务, 该系统服务提供了当前运行<code>activity</code>, 任务以及应用的有用信息. 通过<code>Activity.getSystemService(Activity.ACTIVITY_SERVICE)</code>来获取<code>ActivityManager</code>然后调用<code>ActivityManager实例的getRunningTasks()</code>方法, 得到按照时间由近到久的排序的任务列表. 在调用<code>moveTaskToFront()</code>方法实现将任意任务切换到前台. 关于任务切换需要一些权限配置, 具体参考android文档.</p>
<h2 id="进程和任务"><a href="#进程和任务" class="headerlink" title="进程和任务"></a>进程和任务</h2><ul>
<li>进程: 是操作系统创建的供应用对象生存以及应用运行的地方. 包含了应用的全部运行代码和对象.</li>
<li>每一个<code>activity</code>实例都仅存在一个进程和一个任务中. 这也是进程与任务的唯一类似的地方.</li>
<li>任务: 只包含<code>activity</code>, 这些<code>activity</code>通常来自不同应用.</li>
</ul>
<p><code>activity</code>赖以生存的任务和进程有可能会有所不同. 比如上面的<code>深入了解Intentn</code>中给出的图片参考. 可以发现. 当我没有指定<code>new_task</code>的时候, 新的应用打开的activity是和我们的应用在一个任务栈的. 这也就意味当后退的时候虽然看着只是界面的切换,但是实际上发生了<code>进程间的切换</code></p>
<h2 id="XmlPullParser使用"><a href="#XmlPullParser使用" class="headerlink" title="XmlPullParser使用"></a>XmlPullParser使用</h2><p><code>XmlPullParser</code>接口采用拉的方式从<code>xml</code>数据流中获取解析事件. Android内部也使用<code>XmlPullParser</code>接口来实例化布局文件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">// 模拟一个xml字符串</div><div class="line">String textXMLStr = &quot;&lt;school&gt;\n&quot; +</div><div class="line">     &quot;    &lt;class name=\&quot;1年级\&quot;&gt;\n&quot; +</div><div class="line">     &quot;        &lt;student name=\&quot;张三\&quot;/&gt;\n&quot; +</div><div class="line">     &quot;        &lt;student name=\&quot;李四\&quot;/&gt;\n&quot; +</div><div class="line">     &quot;    &lt;/class&gt;\n&quot; +</div><div class="line">     &quot;\n&quot; +</div><div class="line">     &quot;    &lt;class name=\&quot;2年级\&quot;&gt;\n&quot; +</div><div class="line">     &quot;        优班\n&quot; +</div><div class="line">     &quot;        &lt;student name=\&quot;张三\&quot;/&gt;\n&quot; +</div><div class="line">     &quot;        &lt;student name=\&quot;李四\&quot;/&gt;\n&quot; +</div><div class="line">     &quot;    &lt;/class&gt;\n&quot; +</div><div class="line">     &quot;\n&quot; +</div><div class="line">     &quot;&lt;/school&gt;&quot;;</div><div class="line"></div><div class="line">// 利用xmlPullParser的工厂类创建出一个解析流对象</div><div class="line">XmlPullParser xmlPullParser = XmlPullParserFactory.newInstance().newPullParser();</div><div class="line"></div><div class="line">// 把要解析的xml格式的字符串设置到解析流对象中</div><div class="line">xmlPullParser.setInput(new StringReader(textXMLStr));</div><div class="line"></div><div class="line">// 准备开始解析 移动指针到第一个标签</div><div class="line">int eventType = xmlPullParser.next();</div><div class="line"></div><div class="line">// 如果标签类型不是结束文档标签标示, 那么就标示还有内容继续循环</div><div class="line">while(eventType != XmlPullParser.END_DOCUMENT)&#123;</div><div class="line"> // 判断class标签</div><div class="line"> if (eventType == xmlPullParser.START_TAG &amp;&amp; &quot;class&quot;.equals(xmlPullParser.getName()))&#123;</div><div class="line">     String className = xmlPullParser.getAttributeValue(null, &quot;name&quot;);</div><div class="line">     Log.e(&quot;sususu&quot;,&quot;获得的class标签的名称属性为: &quot;+className );</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> // 判断student标签</div><div class="line"> if (eventType == xmlPullParser.START_TAG &amp;&amp; &quot;student&quot;.equals(xmlPullParser.getName()))&#123;</div><div class="line">     String studentName = xmlPullParser.getAttributeValue(null, &quot;name&quot;);</div><div class="line">     Log.e(&quot;sususu&quot;,&quot;获得的student标签的属性: &quot;+studentName );</div><div class="line"> &#125;</div><div class="line"> // 移动指针到下一个标签</div><div class="line"> eventType = xmlPullParser.next();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:</p>
<p><img src="http://szysky.com/2016/09/09/%E3%80%8AAndroid%E7%BC%96%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E9%9A%8F%E8%AE%B0%E4%B8%89-%E5%AA%92%E4%BD%93%E4%B8%8EIntent%E7%AD%89/xmlPullParser.png" alt="img"></p>
<p>代码中的注释已经很详细了, 不用再做解释. 有一点需要注意, 如果要获得便签的内容的话,那么别忘了考虑到空白字符或者换行符的也是存在的.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/07/android/books/《Android编程权威指南》Chap3_ 媒体与Intent/" data-id="cj7aafudt00015fpjz7qnqvai" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/07/android/books/《Android编程权威指南》Chap3_ 媒体与Intent/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/09/07/android/books/《Android编程权威指南》Chap4_ 组件等/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    《Android编程权威指南》Chap4_ 组件等
                
            </div>
        </a>
    
    
        <a href="/2017/09/07/android/books/《Android编程权威指南》Chap2_ Fragment概括/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">《Android编程权威指南》Chap2_ Fragment概括</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="uyan_frame"></div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/other/">other</a></p>
                            <p class="item-title"><a href="/2017/09/20/other/github hexo 博客迁移 /" class="title">github hexo博客多电脑迁移</a></p>
                            <p class="item-date"><time datetime="2017-09-20T09:58:30.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/ssh/">ssh</a></p>
                            <p class="item-title"><a href="/2017/09/20/other/Gitlab权限说明/" class="title">Gitlab权限说明</a></p>
                            <p class="item-date"><time datetime="2017-09-20T09:54:25.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/20/android/github/glide解析5_图片变换/" class="title">Glide解析5_图片变换</a></p>
                            <p class="item-date"><time datetime="2017-09-20T08:53:48.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/20/android/github/glide解析4_回调监听/" class="title">Glide解析4_回调监听</a></p>
                            <p class="item-date"><time datetime="2017-09-20T08:46:52.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/20/android/github/glide解析3_缓存流程/" class="title">Glide解析3_缓存流程</a></p>
                            <p class="item-date"><time datetime="2017-09-20T08:42:24.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">44</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/android/code/">code</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/github/">github</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android开发艺术探索》/">《Android开发艺术探索》</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android编程权威指南》/">《Android编程权威指南》</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/设计模式/">设计模式</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/面试/">面试</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/learn/">learn</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/learn/《如何高效学习》/">《如何高效学习》</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/7days/">7days</a><span class="category-list-count">7</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ssh/">ssh</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">54</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">7</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/analysis/">analysis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">37</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anslysis/">anslysis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/autoLink/">autoLink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code/">code</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glide/">glide</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/indicator/">indicator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/learn/">learn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/share/">share</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/textview/">textview</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/analysis/" style="font-size: 10px;">analysis</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/anslysis/" style="font-size: 10px;">anslysis</a> <a href="/tags/autoLink/" style="font-size: 10px;">autoLink</a> <a href="/tags/code/" style="font-size: 15px;">code</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/github/" style="font-size: 18.33px;">github</a> <a href="/tags/glide/" style="font-size: 15px;">glide</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/indicator/" style="font-size: 10px;">indicator</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/learn/" style="font-size: 10px;">learn</a> <a href="/tags/markdown/" style="font-size: 11.67px;">markdown</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/node/" style="font-size: 16.67px;">node</a> <a href="/tags/share/" style="font-size: 10px;">share</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/ssh/" style="font-size: 11.67px;">ssh</a> <a href="/tags/textview/" style="font-size: 10px;">textview</a> <a href="/tags/vim/" style="font-size: 11.67px;">vim</a> <a href="/tags/设计模式/" style="font-size: 11.67px;">设计模式</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 Ernest Chang<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2142274"></script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>