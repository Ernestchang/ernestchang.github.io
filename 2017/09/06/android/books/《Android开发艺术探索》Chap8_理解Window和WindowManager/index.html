<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>《Android开发艺术探索》Chap8_理解Window和WindowManager | The Old Man and the Sea</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="所有的视图都是Windown呈现的, 那它都干了什么?注：本文主要参考http://szysky.com  blog相关代码保存在第7章项目window包中 Window表示一个窗口的概念, 如有需要在桌面上显示一个类似悬浮窗的东西, 那么这种效果就需要Window来实现. Window是一个抽象类, 具体实现是PhoneWindow. 如果想要创建一个Window只需要通过WindowMana">
<meta name="keywords" content="android">
<meta property="og:type" content="article">
<meta property="og:title" content="《Android开发艺术探索》Chap8_理解Window和WindowManager">
<meta property="og:url" content="http://yoursite.com/2017/09/06/android/books/《Android开发艺术探索》Chap8_理解Window和WindowManager/index.html">
<meta property="og:site_name" content="The Old Man and the Sea">
<meta property="og:description" content="所有的视图都是Windown呈现的, 那它都干了什么?注：本文主要参考http://szysky.com  blog相关代码保存在第7章项目window包中 Window表示一个窗口的概念, 如有需要在桌面上显示一个类似悬浮窗的东西, 那么这种效果就需要Window来实现. Window是一个抽象类, 具体实现是PhoneWindow. 如果想要创建一个Window只需要通过WindowMana">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-09-06T09:47:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《Android开发艺术探索》Chap8_理解Window和WindowManager">
<meta name="twitter:description" content="所有的视图都是Windown呈现的, 那它都干了什么?注：本文主要参考http://szysky.com  blog相关代码保存在第7章项目window包中 Window表示一个窗口的概念, 如有需要在桌面上显示一个类似悬浮窗的东西, 那么这种效果就需要Window来实现. Window是一个抽象类, 具体实现是PhoneWindow. 如果想要创建一个Window只需要通过WindowMana">
    

    
        <link rel="alternate" href="/" title="The Old Man and the Sea" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">The Old Man and the Sea</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="https://ernestchang.github.io/2017/08/23/other/about/">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/uploads/images/avert.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="https://ernestchang.github.io/2017/08/23/other/about/">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/uploads/images/avert.png" />
            <h2 id="name">Ernest Chang</h2>
            <h3 id="title">Developer &amp; Designer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Hangzhou, China</span>
            <a id="follow" target="_blank" href="https://github.com/Ernestchang/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                94
                <span>posts</span>
            </div>
            <div class="article-info-block">
                23
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Ernestchang/" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-android/books/《Android开发艺术探索》Chap8_理解Window和WindowManager" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            《Android开发艺术探索》Chap8_理解Window和WindowManager
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/06/android/books/《Android开发艺术探索》Chap8_理解Window和WindowManager/">
            <time datetime="2017-09-06T09:35:14.000Z" itemprop="datePublished">2017-09-06</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android开发艺术探索》/">《Android开发艺术探索》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>所有的视图都是Windown呈现的, 那它都干了什么?<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<p><a href="https://github.com/suzeyu1992/Notes_AndroidDevSeek" target="_blank" rel="external">blog相关代码保存在第7章项目window包中</a></p>
<p>Window表示一个窗口的概念, 如有需要在桌面上显示一个类似悬浮窗的东西, 那么这种效果就需要<code>Window</code>来实现. <code>Window</code>是一个抽象类, 具体实现是<code>PhoneWindow</code>. 如果想要创建一个<code>Window</code>只需要通过<code>WindowManager</code>即可完成. <code>WindowManager</code>是外界访问<code>Window</code>的入口, Window具体实现位于<code>WindowManagerService</code>中, <strong>WM</strong>和<strong>WMS</strong>的交互是一个IPC过程. Android中所有的视图都是通过<code>Window</code>来呈现的, 不管是Activity, Dialog, Toast他们的视图实际上都是附加在Window上的.</p>
<h2 id="Window和WindowManager"><a href="#Window和WindowManager" class="headerlink" title="Window和WindowManager"></a>Window和WindowManager</h2><p>先演示使用<code>WindowManger</code>添加一个Window.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public void addWindow()&#123;</div><div class="line">        Button button = new Button(getApplicationContext());</div><div class="line">        button.setText(&quot;动态添加&quot;);</div><div class="line">        WindowManager.LayoutParams layoutParams = new WindowManager.LayoutParams(WindowManager.LayoutParams.WRAP_CONTENT, WindowManager.LayoutParams.WRAP_CONTENT, 0, 0, PixelFormat.TRANSPARENT);</div><div class="line"></div><div class="line">        layoutParams.flags = WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL</div><div class="line">                | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE</div><div class="line">                | WindowManager.LayoutParams.FLAG_SHOW_WHEN_LOCKED;</div><div class="line"></div><div class="line">        layoutParams.gravity = Gravity.LEFT ;</div><div class="line"></div><div class="line">        layoutParams.width = 400;</div><div class="line">        layoutParams.height = 300;</div><div class="line"></div><div class="line">        getWindowManager().addView(button, layoutParams);</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>Flag参数表示Window的属性</strong>,这些属性可以控制Window的显示特性. 下面是常用的属性:</p>
<ul>
<li><code>FLAG_NOT_FOCUSABLE</code>: 表示Window不需要获取焦点, 而不需要接收各种输入事件, 此标记会同时启动<code>FLAG_NOT_TOUCH_MODAL</code>, 最终事件会直接传递给下层的具有焦点的Window.</li>
<li><code>FLAG_NOT_TOUCH_MODAL</code>: 这种模式下, 系统会将当前Window区域以外的点击事件传递给底层的Window, 当前Window区域以内的单击事件则自己处理. 这个标记很重要, 一般来说都需要开启此标记, 否则其他Window将无法接收到单击事件.</li>
<li><code>FLAG_SHOW_WHEN_LOCKED</code>: 开启此模式可以让Window显示在锁屏的界面上.</li>
</ul>
<p><strong>Type参数表示Window的类型</strong></p>
<p>Window共有三种类型, 分别是<strong>应用Window</strong>, <strong>子Window</strong>, <strong>系统Window</strong>. 应用类Window对应着一个Activity. 子Window不能单独存在, 他需要附属在特定的父Window中,比如常见的<code>Dialog</code>就是一个子Window. 系统Window是需要声明权限才能创建的Window, 比如<code>Toast</code>和系统状态栏都是系统的Window.</p>
<p>Window是分层的, 每个Window都有对应的<code>z-ordered</code>, 层级大的会覆盖在层级小的Window的上面, 这和HTML中的<code>z-index</code>的概念一样. <strong>应用Window</strong>的层级范围是1~99, <strong>子Window</strong>的层级范围是1000~1999, <strong>系统Window</strong>的层级范围是2000~2999.</p>
<p>如果想要在最顶层显示, 可以选择使用<code>TYPE_SYSTEM_OVERLAY</code>, <code>TYPE_SYSTEM_ERROR</code>. 如果采用了<code>TYPE_SYSTEM_ERROR</code>同时要声明权限<code>android.permission.SYSTEM_ALERT_WINDOW</code>. 如果不声明那么在创建的时候就会报错.</p>
<p><strong>WindowManager常用的功能</strong></p>
<p>在<code>ViewManager</code>接口中定义了三个方法. 就是我们常用的方法<strong>添加View</strong>,<strong>删除View</strong>,<strong>修改View</strong>. <code>WM</code>继承了这个接口.</p>
<h2 id="Window的内部机制"><a href="#Window的内部机制" class="headerlink" title="Window的内部机制"></a>Window的内部机制</h2><p><code>Window</code>是一个抽象的概念, 每一<code>Window</code>都对应着一个View和一个ViewRootImpl, <code>Window</code>和View通过<code>ViewRootImpl</code>来建立联系, 因此Window并不是实际存在的, 他是以View的形式存在. 通过<code>WindowManager</code>的定义和提供的三个接口方法看出都是针对View的. 说明View才是<code>Windwo</code>存在的实体. 而在实际的使用中无法直接访问<code>Window</code>, 对<code>Window</code>的访问都是必须通过WM.</p>
<h3 id="Window的添加过程"><a href="#Window的添加过程" class="headerlink" title="Window的添加过程"></a>Window的添加过程</h3><p><code>Window</code>的添加过程需要通过<code>WindowManager</code>的<code>addView()</code>来实现, 而<code>WindowManager</code>是一个接口, 它的真正实现是<code>WindowManagerImpl</code>类, 在WindowManagerImpl中Window的三大操作如下.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void addView(@NonNull View view, @NonNull ViewGroup.LayoutParams params) &#123;</div><div class="line">   applyDefaultToken(params);</div><div class="line">   mGlobal.addView(view, params, mDisplay, mParentWindow);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void updateViewLayout(@NonNull View view, @NonNull ViewGroup.LayoutParams params) &#123;</div><div class="line">   applyDefaultToken(params);</div><div class="line">   mGlobal.updateViewLayout(view, params);</div><div class="line">&#125;</div><div class="line"></div><div class="line"> </div><div class="line">@Override</div><div class="line">public void removeView(View view) &#123;</div><div class="line">   mGlobal.removeView(view, false);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>WindowManagerImpl</code>并没有直接实现Window的三大操作, 而是全部交给了<code>WindowManagerGlobal</code>来处理. <code>WindowManagerGlobal</code>以工厂的形式向外提供自己的实例. 而<code>WindowManagerImpl</code>这种工作模式就典型的桥接模式, 将所有的操作全部委托给<code>WindowManagerGlobal</code>来实现.</p>
<p><strong>WindowManagerGlobal的addView()主要分为</strong></p>
<ol>
<li>检查所有参数是否合法, 如果是子Window那么还需要调整一些布局参数.</li>
<li>创建<code>ViewRootImpl</code>并将View添加到列表中.</li>
<li>通过<code>ViewRootImpl</code>来更新界面并完成Window的添加过程. 这个过程是通过<code>ViewRootImpl#setView()</code>来完成的. View的绘制过程是由<code>ViewRootImpl</code>来完成的, 在内部会调用<code>requestLayout()</code>来完成异步刷新请求. 而<code>scheduleTraversals()</code>实际上是View绘制的入口. 接着会通过<code>WindowSession</code>完成Window的添加过程(Window的添加过程是一次IPC调用). 最终会通过<code>WindowManagerService</code>来实现Window的添加.</li>
</ol>
<p><code>WindowManagerService</code>内部会为每一个应用保留一个单独的Session.</p>
<h3 id="Window的删除过程"><a href="#Window的删除过程" class="headerlink" title="Window的删除过程"></a>Window的删除过程</h3><p>Window 的删除过程和添加过程一样, 都是先通过<code>WindowManagerImpl</code>后, 在进一步通过<code>WindowManagerGlobal的removeView()</code>来实现的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public void removeView(View view, boolean immediate) &#123;</div><div class="line">   synchronized (mLock) &#123;</div><div class="line">       int index = findViewLocked(view, true);</div><div class="line">       View curView = mRoots.get(index).getView();</div><div class="line">       removeViewLocked(index, immediate);</div><div class="line">       if (curView == view) &#123;</div><div class="line">           return;</div><div class="line">       &#125;</div><div class="line">       throw new IllegalStateException(&quot;Calling with view &quot; + view</div><div class="line">               + &quot; but the ViewAncestor is attached to &quot; + curView);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>方法内首先通过<code>findViewLocked</code>来查找待删除的View的索引, 这个过程就是建立数组遍历, 然后调用<code>removeViewLocked</code>来做进一步的删除.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">private void removeViewLocked(int index, boolean immediate) &#123;</div><div class="line">   ViewRootImpl root = mRoots.get(index);</div><div class="line">   View view = root.getView();</div><div class="line"></div><div class="line">   if (view != null) &#123;</div><div class="line">       InputMethodManager imm = InputMethodManager.getInstance();</div><div class="line">       if (imm != null) &#123;</div><div class="line">           imm.windowDismissed(mViews.get(index).getWindowToken());</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">   boolean deferred = root.die(immediate);</div><div class="line">   if (view != null) &#123;</div><div class="line">       view.assignParent(null);</div><div class="line">       if (deferred) &#123;</div><div class="line">           mDyingViews.add(view);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里通过<code>ViewRootImpl</code>的<code>die()</code>完成来完成删除操作. <code>die()</code>方法只是发送了请求删除的消息后就立刻返回了, 这个时候View并没有完成删除操作, 所以最后会将其添加到<code>mDyingViews</code>中, <code>mDyingViews</code>表示待删除的View的列表.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">boolean die(boolean immediate) &#123;</div><div class="line">   // Make sure we do execute immediately if we are in the middle of a traversal or the damage</div><div class="line">   // done by dispatchDetachedFromWindow will cause havoc on return.</div><div class="line">   if (immediate &amp;&amp; !mIsInTraversal) &#123;</div><div class="line">       doDie();</div><div class="line">       return false;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   if (!mIsDrawing) &#123;</div><div class="line">       destroyHardwareRenderer();</div><div class="line">   &#125; else &#123;</div><div class="line">       Log.e(TAG, &quot;Attempting to destroy the window while drawing!\n&quot; +</div><div class="line">               &quot;  window=&quot; + this + &quot;, title=&quot; + mWindowAttributes.getTitle());</div><div class="line">   &#125;</div><div class="line">   mHandler.sendEmptyMessage(MSG_DIE);</div><div class="line">   return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>die方法中只是做了简单的判断, 如果是异步删除那么就发送一个<code>MSG_DIE</code>的消息, <code>ViewRootImpl</code>中的<code>Handler</code>会处理此消息并调用<code>doDie()</code>; 如果是同步删除, 那么就不发送消息直接调用<code>doDie()</code>方法.</p>
<p>在<code>doDie()</code>方法中会调用<code>dispatchDetachedFromWindow()</code>方法, 真正删除View的逻辑在这个方法内部实现. 其中主要做了四件事:</p>
<ol>
<li>垃圾回收的相关工作, 比如清除数据和消息,移除回调.</li>
<li>通过Session的remove方法删除Window: <code>mWindowSession.remove(mWindow)</code>, 这同样是一个IPC过程, 最终会调用<code>WMS</code>的removeWindow()方法.</li>
<li>调用View的<code>dispatchDetachedFromWindow()</code>方法, 内部会调用View的<code>onDetachedFromWindow()</code>以及<code>onDetachedFromWindowInternal()</code>. 而对于<code>onDetachedFromWindow()</code>就是在View从Window中移除时, 这个方法就会被调用, 可以在这个方法内部做一些资源回收的工作. 比如停止动画,停止线程</li>
<li>调用<code>WindowManagerGlobal#doRemoveView</code>方法刷新数据, 包括<code>mRoots</code>, <code>mParams</code>, <code>mDyingViews</code>, 需要将当前Window所关联的这三类对象从列表中删除.</li>
</ol>
<h3 id="Window的更新过程"><a href="#Window的更新过程" class="headerlink" title="Window的更新过程"></a>Window的更新过程</h3><p><code>WindowManagerGlobal#updateViewLayout()</code>方法做的比较简单, 它需要更新View的<code>LayoutParams</code>并替换掉老的<code>LayoutParams</code>, 接着在更新<code>ViewRootImpl</code>中的LayoutParams. 这一步主要是通过<code>setLayoutParams()</code>方法实现.</p>
<p>在<code>ViewRootImpl</code>中会通过<code>scheduleTraversals()</code>来对View重新布局, 包括测量,布局,重绘. 除了View本身的重绘以外, <code>ViewRootImpl</code>还会通过<code>WindowSession</code>来更新Window的视图, 这个过程最后由<code>WMS</code>的<code>relayoutWindow()</code>实现同样是一个IPC过程.</p>
<h2 id="Window的创建过程"><a href="#Window的创建过程" class="headerlink" title="Window的创建过程"></a>Window的创建过程</h2><p>View是Android中视图的呈现方式, 但是View不能单独存在, 它必须依附在Window这个抽象的概念上面, 因此有视图的地方就有<code>Window</code>.</p>
<h3 id="Activity的Window创建过程"><a href="#Activity的Window创建过程" class="headerlink" title="Activity的Window创建过程"></a>Activity的Window创建过程</h3><p><code>Activity</code>的大体启动流程: 最终会由<code>ActivityThread</code>中的<code>PerformLaunchActivity()</code>来完成整个启动过程, 这个方法内部会通过类加载器创建<code>Activity</code>的实例对象, 并调用其<code>attach()</code>方法为其关联运行过程中所依赖的一系列上下文环境变量. 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">private Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;</div><div class="line">  Activity activity = null;</div><div class="line">   </div><div class="line">  //获得类加载器</div><div class="line">  java.lang.ClassLoader cl = r.packageInfo.getClassLoader();</div><div class="line">  activity = mInstrumentation.newActivity(</div><div class="line">          cl, component.getClassName(), r.intent);</div><div class="line">  StrictMode.incrementExpectedActivityCount(activity.getClass());</div><div class="line">  r.intent.setExtrasClassLoader(cl);</div><div class="line">  r.intent.prepareToEnterProcess();</div><div class="line">  if (r.state != null) &#123;</div><div class="line">      r.state.setClassLoader(cl);</div><div class="line">  &#125;</div><div class="line"></div><div class="line"> Context appContext = createBaseContextForActivity(r, activity);</div><div class="line"> CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager());</div><div class="line"> Configuration config = new Configuration(mCompatConfiguration);</div><div class="line">     </div><div class="line"> activity.attach(appContext, this, getInstrumentation(), r.token,</div><div class="line">         r.ident, app, r.intent, r.activityInfo, title, r.parent,</div><div class="line">         r.embeddedID, r.lastNonConfigurationInstances, config,</div><div class="line">         r.referrer, r.voiceInteractor);</div><div class="line"></div><div class="line">        return activity;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在<code>attach()</code>方法里, 系统会创建<code>Activity</code>所属的Window对象并为其设置回调接口, Window对象的创建是通过<code>PolicyManager#makeNewWindow()</code>方法实现. 由于<code>Activity</code>实现了<code>Window</code>的CallBack接口, 因此当<code>Window</code>接收到外界的状态改变的时候就会回调Activity方法. 比如说我们熟悉的<code>onAttachedToWindow()</code>, <code>onDetachedFromWindow()</code>, <code>dispatchTouchEvent()</code>等等.代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mWindow = new PhoneWindow(this);</div><div class="line">       mWindow.setCallback(this);</div><div class="line">       mWindow.setOnWindowDismissedCallback(this);</div><div class="line">       mWindow.getLayoutInflater().setPrivateFactory(this);</div><div class="line">       if (info.softInputMode != WindowManager.LayoutParams.SOFT_INPUT_STATE_UNSPECIFIED) &#123;</div><div class="line">           mWindow.setSoftInputMode(info.softInputMode);</div><div class="line">       &#125;</div><div class="line">       if (info.uiOptions != 0) &#123;</div><div class="line">           mWindow.setUiOptions(info.uiOptions);</div><div class="line">       &#125;</div><div class="line">       mUiThread = Thread.currentThread();</div></pre></td></tr></table></figure>
<p>那么Activity视图是怎么附属在Window上的呢? 查看经常使用的<code>setContentView()</code>方法干了什么</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public void setContentView(@LayoutRes int layoutResID) &#123;</div><div class="line">   getWindow().setContentView(layoutResID);</div><div class="line">   initWindowDecorActionBar();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Activity</code>将具体实现交给了Window处理, 而<code>Window</code>的具体实现就是<code>PhoneWindow</code>, 所以只需要看<code>PhoneWindow</code>的相关逻辑分为以下几步.</p>
<ol>
<li>如果没有DecorView, 那么就创建它. 由<code>installDecor()--&gt;generateDecor()</code>触发</li>
<li>将View添加到<code>DecorView</code>的<code>mContentParent</code>中</li>
<li>回调Activity的<code>onContentChanged()</code>通知activity视图已经发生改变</li>
</ol>
<p>这个时候<code>DecorView</code>已经被创建并初始化完毕, Activity的布局文件也已经添加成功到<code>DecorView的mContentParent</code>中. 但是这个时候<code>DecorView</code>还没有被<code>WindowManager</code>正式添加到Window中. 虽然早在<code>Activity的attach</code>方法中window就已经被创建了, 但是这个时候由于<code>DecorView</code>并没有被<code>WindowManager</code>识别, 所以这个时候的Window无法提供具体功能, 因为他还无法接收外界的输入信息.</p>
<p>在<code>ActivityThread#handleResumeActivity()</code>方法中, 首先会调用<code>Activity#onResume()</code>, 接着会调用<code>Activity#makeVisible()</code>, 正是在makeVisible方法中, <code>DecorView</code>真正的完成了添加和显示这两个过程. 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">void makeVisible() &#123;</div><div class="line">   if (!mWindowAdded) &#123;</div><div class="line">       ViewManager wm = getWindowManager();</div><div class="line">       wm.addView(mDecor, getWindow().getAttributes());</div><div class="line">       mWindowAdded = true;</div><div class="line">   &#125;</div><div class="line">   mDecor.setVisibility(View.VISIBLE);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Dialog的Window创建过程"><a href="#Dialog的Window创建过程" class="headerlink" title="Dialog的Window创建过程"></a>Dialog的Window创建过程</h3><p><code>Dialog</code>的<code>Window</code>的创建过程和Activity类似, 有如下几步</p>
<p><strong>1. 创建Window</strong></p>
<p>Dialog的创建后的实际就是<code>PhoneWindow</code>, 这个过程和Activity的Window创建过程一致.</p>
<p><strong>2. 初始化DecorView并将Dialog的视图添加到DecorView中</strong></p>
<p>这个过程也类似, 都是通过<code>Window</code>去添加指定的布局文件.</p>
<p><strong>3. 将DecorView添加到Window中并显示</strong></p>
<p>在<code>Dialog</code>的show方法中, 会通过<code>WindowManager</code>将<code>DecorView</code>添加Window中.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mWindowManager.addView(mDecor, l);</div><div class="line">mShowing = true;   </div><div class="line">sendShowMessage();</div></pre></td></tr></table></figure>
<p>普通的<code>Dialog</code>有一个特殊之处, 那就是必须采用<code>Activity</code>的Content, 如果采用<code>Application</code>的Content, 那么就会报错. 报的错<strong>是没有应用token所导致的, 而应用token一般只有Activity才拥有</strong>.</p>
<p>还有一种方法. <code>系统Window比较特殊, 他可以不需要token</code>, 因此只需要指定对话框的Window为系统类型就可以正常弹出对话框.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//JAVA 给Dialog的Window改变为系统级的Window</div><div class="line">dialog.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ERROR);</div><div class="line"></div><div class="line"></div><div class="line">//XML 声明权限</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;/&gt;</div></pre></td></tr></table></figure>
<h3 id="Toast的Window创建过程"><a href="#Toast的Window创建过程" class="headerlink" title="Toast的Window创建过程"></a>Toast的Window创建过程</h3><p><code>Toast</code>和<code>Dialog</code>不同, 它的工作过程就稍显复杂. 首先<code>Toast</code>也是基于Window来实现的. 但是由于<code>Toast</code>具有定时取消的功能, 所以系统采用了<code>Handler</code>. 在<code>Toast</code>的内部有两类IPC过程, 第一类是Toast访问<code>NotificationManagerService()</code>后面简称<code>NMS</code>. 第二类是<code>NotificationManagerService</code>回调Toast里的<code>TN</code>接口.</p>
<p><code>Toast</code>属于系统Window, 它内部的视图有两种方式指定, 一种是系统默认的样式, 另一种是通过<code>setView</code>方法来指定一个自定义View. 不管如何, 他们都对应<code>Toast</code>的一个View类型的内部成员<code>mNextView</code>. Toast内部提供了<code>cancel</code>和<code>show</code>两个方法. 分别用于显示和隐藏<code>Toast</code>. 他们内部是一个IPC过程.</p>
<p>显示和隐藏<code>Toast</code>都是需要通过<code>NMS</code>来实现的. 由于<code>NMS</code>运行在系统的进程中, 所以只能通过远程调用的方式来显示和隐藏<code>Toast</code>. 而<code>TN</code>这个类是一个<code>Binder</code>类. 在<code>Toast</code>和<code>NMS</code>进行IPC的过程中, 当NMS处理Toast的显示或隐藏请求时会跨进程回调<code>TN</code>的方法. 这个时候由于<code>TN</code>运行在Binder线程池中, 所以需要通过<code>Handler</code>将其切换到当前主线程. 所以由其可知, <code>Toast</code>无法在没有<code>Looper</code>的线程中弹出, 因为Handler需要使用<code>Looper</code>才能完成切换线程的功能.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> if (!isSystemToast) &#123;</div><div class="line">   int count = 0;</div><div class="line">   final int N = mToastQueue.size();</div><div class="line">   for (int i=0; i&lt;N; i++) &#123;</div><div class="line">        final ToastRecord r = mToastQueue.get(i);</div><div class="line">        if (r.pkg.equals(pkg)) &#123;</div><div class="line">            count++;</div><div class="line">            // MAX_PACKAGE_NOTIFICATIONS == 50</div><div class="line">            if (count &gt;= MAX_PACKAGE_NOTIFICATIONS) &#123; </div><div class="line">                Slog.e(TAG, &quot;Package has already posted &quot; + count</div><div class="line">                       + &quot; toasts. Not showing more. Package=&quot; + pkg);</div><div class="line">                return;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于非系统应用来说, 最多能同时存在对<code>Toast</code>封装的<code>ToastRecord</code>上限为50个. 这样做是为了防止<strong>DOS(Denial of Service)</strong>. 如果不这样, 当通过大量循环去连续的弹出Toast, 这将会导致其他应用没有机会弹出Toast, 那么对于其他应用的Toast请求, 系统的行为就是拒绝服务, 这就是拒绝服务攻击的含义.</p>
<p>在<code>ToastRecord</code>被添加到<code>mToastQueue()</code>中后, <code>NMS</code>就会通过<code>showNextToastLocked()</code>方法来显示当前的Toast.</p>
<p>Toast的显示是由<code>ToastRecord</code>的<code>callback</code>来完成的. 这个<code>callback</code>实际上就是<code>Toast</code>中的<code>TN</code>对象的远程Binder. 通过callback来访问TN中的方法是需要跨进程的. 最终被调用的<code>TN</code>中的方法会运行在发起<code>Toast</code>请求的应用的Binder线程池.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">private void scheduleTimeoutLocked(ToastRecord r)&#123;</div><div class="line">   mHandler.removeCallbacksAndMessages(r);</div><div class="line">   Message m = Message.obtain(mHandler, MESSAGE_TIMEOUT, r);</div><div class="line">   long delay = r.duration == Toast.LENGTH_LONG ? LONG_DELAY : SHORT_DELAY;</div><div class="line">   mHandler.sendMessageDelayed(m, delay);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上代码就是在<code>Toast</code>显示以后, <code>NMS</code>通过这个方法来发送一个延时消息, 具体取决Toast的时长. <code>LONG_DELAY</code>, <code>SHORT_DELAY</code>分别对应着3.5秒和2秒. 当延时时间达到的时候. <code>NMS</code>会通过<code>cancelToastLocked()</code>方法来隐藏<code>Toast</code>并将其从<code>mToastQueue</code>中移除, 这个时候如果<code>mToastQueue</code>中还有其余<code>Toast</code>那么<code>NMS</code>就继续显示其他.</p>
<p><strong>Toast的隐藏也会通过ToastRecord的callback完成的</strong>.同样是一次IPC过程. 方式和Toast显示类似.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">void cancelToastLocked(int index) &#123;</div><div class="line">ToastRecord record = mToastQueue.get(index);</div><div class="line">try &#123;</div><div class="line">  record.callback.hide();</div><div class="line">&#125; catch (RemoteException e) &#123;</div><div class="line">  Slog.w(TAG, &quot;Object died trying to hide notification &quot; + record.callback</div><div class="line">          + &quot; in package &quot; + record.pkg);</div><div class="line">  // don&apos;t worry about this, we&apos;re about to remove it from</div><div class="line">  // the list anyway</div><div class="line">&#125;</div><div class="line">mToastQueue.remove(index);</div><div class="line">keepProcessAliveLocked(record.pid);</div><div class="line">if (mToastQueue.size() &gt; 0) &#123;</div><div class="line">  // Show the next one. If the callback fails, this will remove</div><div class="line">  // it from the list, so don&apos;t assume that the list hasn&apos;t changed</div><div class="line">  // after this point.</div><div class="line">  showNextToastLocked();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上基本说明<code>Toast</code>的显示和影响过程实际上是通过<code>Toast</code>中的<code>TN</code>这个类来实现的. 他有两个方法<code>show()</code>, <code>hide()</code>. 分别对应着<code>Toast</code>的显示和隐藏. 由于这两个方法是被<code>NMS</code>以跨进程的方式调用的, 因此他们运行在<code>Binder线程池中</code>. 为了将执行环境切换到Toast请求所在线程中, 在他们内部使用了<code>handler</code>,如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void show() &#123;</div><div class="line">  if (localLOGV) Log.v(TAG, &quot;SHOW: &quot; + this);</div><div class="line">  mHandler.post(mShow);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line">* schedule handleHide into the right thread</div><div class="line">*/</div><div class="line">@Override</div><div class="line">public void hide() &#123;</div><div class="line">  if (localLOGV) Log.v(TAG, &quot;HIDE: &quot; + this);</div><div class="line">  mHandler.post(mHide);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中, <code>mShow</code>, <code>mHide</code>是两个Runnable, 他们内部分别调用了<code>handleShow</code>和<code>handleHide</code>方法. 所以这两个方法才是真正完成隐藏和显示<code>Toast</code>的地方.</p>
<p><code>TN</code>的<strong>handleShow</strong>中会将<code>Toast</code>的视图添加到<code>Window</code>中.</p>
<p><code>TN</code>的<strong>handleHide</strong>中会将<code>Toast</code>的视图从<code>Window</code>中移除.</p>
<p>具体实现代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//handleShow()</div><div class="line"> mWM = (WindowManager)context.getSystemService(Context.WINDOW_SERVICE);</div><div class="line"> mWM.addView(mView, mParams);</div><div class="line"> </div><div class="line">//handleHide()</div><div class="line">if (mView != null) &#123;</div><div class="line">  if (mView.getParent() != null) &#123;</div><div class="line">     if (localLOGV) Log.v(TAG, &quot;REMOVE! &quot; + mView + &quot; in &quot; + this);</div><div class="line">     mWM.removeView(mView);</div><div class="line">  &#125;</div><div class="line">  mView = null;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>关于<code>Toast</code>流程已经完事. 除了说到的<code>Activity</code>, <code>Dialog</code>, <code>Toast</code>. 还有<code>PopupWindow</code><br>菜单栏, 状态栏都是通过<code>Window</code>来实现的.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/06/android/books/《Android开发艺术探索》Chap8_理解Window和WindowManager/" data-id="cj78uk382000kkbpj22nxvt3x" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/06/android/books/《Android开发艺术探索》Chap8_理解Window和WindowManager/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/09/06/android/books/《Android开发艺术探索》Chap9_四大组件的工作过程/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    《Android开发艺术探索》Chap9_四大组件的工作过程
                
            </div>
        </a>
    
    
        <a href="/2017/09/06/android/books/《Android开发艺术探索》Chap7_View动画/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">《Android开发艺术探索》Chap7_View动画</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="uyan_frame"></div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/react/">react</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/react/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/28/react/github/React Native Elements/" class="title">Looped carousel for React Native</a></p>
                            <p class="item-date"><time datetime="2017-09-28T11:42:20.000Z" itemprop="datePublished">2017-09-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/react/">react</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/react/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/28/react/github/React Navigation   /" class="title">Looped carousel for React Native</a></p>
                            <p class="item-date"><time datetime="2017-09-28T11:41:47.000Z" itemprop="datePublished">2017-09-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/react/">react</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/react/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/28/react/github/Lottie for React Native, iOS, and Android/" class="title">Looped carousel for React Native</a></p>
                            <p class="item-date"><time datetime="2017-09-28T11:41:15.000Z" itemprop="datePublished">2017-09-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/react/">react</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/react/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/28/react/github/Create React Native App/" class="title">Create React Native App</a></p>
                            <p class="item-date"><time datetime="2017-09-28T11:40:34.000Z" itemprop="datePublished">2017-09-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/react/">react</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/react/github/">github</a></p>
                            <p class="item-title"><a href="/2017/09/28/react/github/React Native Loading Spinner Overlay/" class="title">Looped carousel for React Native</a></p>
                            <p class="item-date"><time datetime="2017-09-28T11:40:00.000Z" itemprop="datePublished">2017-09-28</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">45</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/android/code/">code</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/github/">github</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android开发艺术探索》/">《Android开发艺术探索》</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android编程权威指南》/">《Android编程权威指南》</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/设计模式/">设计模式</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/面试/">面试</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/learn/">learn</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/learn/《如何高效学习》/">《如何高效学习》</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/7days/">7days</a><span class="category-list-count">7</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/react/">react</a><span class="category-list-count">17</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/react/github/">github</a><span class="category-list-count">7</span></li></ul></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">73</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">7</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/analysis/">analysis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">38</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anslysis/">anslysis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/autoLink/">autoLink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code/">code</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/">gitlab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glide/">glide</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/indicator/">indicator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/learn/">learn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/share/">share</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/textview/">textview</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/analysis/" style="font-size: 10px;">analysis</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/anslysis/" style="font-size: 10px;">anslysis</a> <a href="/tags/autoLink/" style="font-size: 10px;">autoLink</a> <a href="/tags/code/" style="font-size: 15px;">code</a> <a href="/tags/git/" style="font-size: 11.25px;">git</a> <a href="/tags/github/" style="font-size: 17.5px;">github</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/glide/" style="font-size: 13.75px;">glide</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/indicator/" style="font-size: 10px;">indicator</a> <a href="/tags/java/" style="font-size: 12.5px;">java</a> <a href="/tags/learn/" style="font-size: 10px;">learn</a> <a href="/tags/markdown/" style="font-size: 11.25px;">markdown</a> <a href="/tags/mysql/" style="font-size: 13.75px;">mysql</a> <a href="/tags/node/" style="font-size: 16.25px;">node</a> <a href="/tags/react/" style="font-size: 18.75px;">react</a> <a href="/tags/share/" style="font-size: 10px;">share</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/textview/" style="font-size: 10px;">textview</a> <a href="/tags/vim/" style="font-size: 11.25px;">vim</a> <a href="/tags/设计模式/" style="font-size: 11.25px;">设计模式</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 Ernest Chang<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2142274"></script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>