<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>The Old Man and the Sea</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="All any predator can do is to keep on trying.">
<meta property="og:type" content="website">
<meta property="og:title" content="The Old Man and the Sea">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="The Old Man and the Sea">
<meta property="og:description" content="All any predator can do is to keep on trying.">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Old Man and the Sea">
<meta name="twitter:description" content="All any predator can do is to keep on trying.">
    

    
        <link rel="alternate" href="/" title="The Old Man and the Sea" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">The Old Man and the Sea</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="https://ernestchang.github.io/2017/08/23/other/about/">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/uploads/images/avert.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="https://ernestchang.github.io/2017/08/23/other/about/">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/uploads/images/avert.png" />
            <h2 id="name">Ernest Chang</h2>
            <h3 id="title">Developer &amp; Designer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Hangzhou, China</span>
            <a id="follow" target="_blank" href="https://github.com/Ernestchang/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                75
                <span>posts</span>
            </div>
            <div class="article-info-block">
                21
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/Ernestchang/" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-android/books/《Android 编程实战》Chap7_序列化说明" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/12/android/books/《Android 编程实战》Chap7_序列化说明/">《Android 编程实战》Chap7_序列化说明</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/12/android/books/《Android 编程实战》Chap7_序列化说明/">
            <time datetime="2017-09-11T23:56:25.000Z" itemprop="datePublished">2017-09-12</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>阅读《Android 编程实战》一书的随记笔记<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h2 id="数据存储的介绍"><a href="#数据存储的介绍" class="headerlink" title="数据存储的介绍"></a>数据存储的介绍</h2><p>谈到数据数据存储通常会使用<code>持久化</code>, 而用<code>序列化</code>描述数据是如何表现其存储状态的. 如果没有数据的<code>持久化</code>, 那么数据还能在<code>RAM</code>中保持其状态, 一旦相关进程结束数据就会消失. 实现数据的持久化通常涉及性能, 延迟, 数据大小和复杂度等因素的这种. 例如, 快速的数据读取往往会导致较慢的写入. 序列化就是关于数据如何组织的, 同时包括在持久化状态和内存中.</p>
<h2 id="Android持久化选项"><a href="#Android持久化选项" class="headerlink" title="Android持久化选项"></a>Android持久化选项</h2><p><code>Android</code>中提供了两种现成的方法, 分别是:</p>
<ul>
<li><code>偏好文件(preference files)</code>: 使用<code>XML</code>格式, 通过<code>SharePreferences</code>类提供接口</li>
<li><code>数据库(sqlite)</code>: 通常被包装成<code>ContentProider</code>组件.</li>
</ul>
<p>通常选项, 应用配置属性用<code>preferences files</code>来存储; 数组表格,或者Java表示的一些数据用数据库进行存储; 而一些二进制数据, 例如图片通常当做常规文件来存储在本地.</p>
<h2 id="Preferences-file"><a href="#Preferences-file" class="headerlink" title="Preferences file"></a>Preferences file</h2><p>这些文件存储在应用程序的内部目录中, 其结构只允许存储键值对.</p>
<p>创建<code>SharePreferences</code>对象最简单的方式是使用<code>PreferenceManager.getDefaultSharedPreferences()</code>方法, 它会返回应用程序默认的偏好对象. 这种方式的便利是系统会自动管理<strong>偏好文件名</strong>. 如果需要多个偏好文件那么要使用<code>Context.getSharedPreferences()</code>方法, 它允许开发者自由命名文件. 如果只是创建<code>Activity</code>相关的偏好文件, 可以使用<code>Activity.getPreference()</code>方法, 他会在调用时得到<code>Activity</code>的名字.</p>
<blockquote>
<p><code>getDefaultSharePreferences()</code>创建的偏好文件名是由包名+<code>_preferences</code>组成的.</p>
</blockquote>
<p>其内部支持的存储值类型有<code>int</code>, <code>float</code>, <code>long</code>, <code>boolean</code>, <code>String</code>以及<code>Set&lt;String&gt;</code>对象. 键名必须是一个有效的字符串.</p>
<hr>
<p><strong>如果需要文件修改并提交存储</strong></p>
<p>首先需要获得<code>Editor</code>实例, 他提供了相应的<code>PUT</code>方法, 以及用于提交修改的方法. 在<code>Android 2.3</code>之前, 通过使用<code>commit()</code>方法把修改<strong>同步</strong>提交到存储设备中. 但在2.3之后, <code>Editor</code>类提供了用于<strong>异步</strong>执行写操作的<code>apply()</code>方法. 因为要尽可能地避免主线程执行阻塞操作, 所以<code>apply()</code>相对来说比<code>commit()</code>更好.</p>
<hr>
<p><strong>如果需要对偏好值被修改的时候可以收到通知</strong></p>
<p>那么可以通过注册一个回调函数, 每当<code>apply()</code>和<code>commit()</code>方法时都会触发该监听器. 通过对<code>SharedPreferences</code>的实例调用<code>registerOrSharedPreferenceChangeListener()</code>方法来添加内容改变回调.</p>
<h3 id="用户选项和设置用户界面"><a href="#用户选项和设置用户界面" class="headerlink" title="用户选项和设置用户界面"></a>用户选项和设置用户界面</h3><p>Android提供一套现成的<code>Activity</code>和<code>Fragment</code>类针对用户更改应用程序的选项和设置, 使得创建这类用户界面非常简单容易<code>PreferenceActivity</code>和<code>PreferenceFragment</code>.</p>
<p>但! 是! 感觉没啥用处, 基本应用都会按照自己的ui风格进行设计. 知道一下就行</p>
<h2 id="ContentProvider注意事项"><a href="#ContentProvider注意事项" class="headerlink" title="ContentProvider注意事项"></a>ContentProvider注意事项</h2><h3 id="Android数据库设计"><a href="#Android数据库设计" class="headerlink" title="Android数据库设计"></a>Android数据库设计</h3><p>关系数据库的设计通常通过<code>数据库规范化</code>完成. 该过程使用一些<code>范式</code>规则来减少数据库中的依赖和冗余. 有许多数据库范式, 但在大多数情况下, 只有前三个是相关的. 如果一个数据库设计满足了前三个范式, 可以认为它是<code>规范化</code>的.</p>
<p>由于面向的对象为<code>android</code>应用. 有可能不一定在表中尽可能多的使用外键, 虽然使用外键可以更好的减少空间的占用, 但是相对于开发中操作多表的困难度也就相应的提高. 所以需要权衡一下.</p>
<h3 id="创建和升级数据库"><a href="#创建和升级数据库" class="headerlink" title="创建和升级数据库"></a>创建和升级数据库</h3><p>建议总是使用<code>ContentProvider</code>组件包装<code>SQLite</code>数据库. 通过这种方式, 可以只在一个地方管理的数据库调用, 还可以使用一些现成的数据库工具类.</p>
<h3 id="查询方法说明"><a href="#查询方法说明" class="headerlink" title="查询方法说明"></a>查询方法说明</h3><p>查询数据库(通常会调用<code>ContentResolver.query()</code>)会调用<code>ContentProvider.query()</code>方法. 在实现查询方式时必须解析传入的<code>Uri</code>以决定执行哪个查询, 并且还要检查所有传入的参数是否正确.</p>
<blockquote>
<p>编写数据库查询要把<code>WHERE</code>语句中较简单的比较放在前面. 这样会加快查询, 因为其可以尽早决定要包含的信息.</p>
</blockquote>
<h3 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h3><p>每次在<code>SQLite</code>数据库执行一条<code>SQL</code>语句都会执行一次数据库事务操作. 除非是自己专门管理事务, 否则每条语句都会自动创建一个事务. 因为大多数<code>ContentProvider</code>调用最终都只会生成一条<code>SQL</code>语句, 这种情况下几乎没有必要手动处理事务. 但是如果应用程序将执行多条<code>SQL</code>语句, 比如一次插入很多条记录, 记得总是自己管理事务.</p>
<p><code>ContentProvider</code>类提供了两个事务管理的方法: <code>ContentProvider.bulkInsert()</code>和<code>ContentProvider.applyBatch()</code> 相比与普通的<code>insert()</code>快了很多.</p>
<p>事务的语义很简单. 首先调用<code>SQLiteDatabase.beginTransaction()</code>开始一个新的事务. 当成功插入所有记录之后调用<code>SQLiteDatabase.setTransactionSuccessful()</code>, 然后使用<code>SQLiteDatabase.endTransaction()</code>结束本次事务. 如果某条数据插入失败, 会抛出<code>SQLiteException</code>, 而之前的所有插入都会回滚, 因为在成功之前没有调用过<code>setTransactionSuccessful()</code></p>
<p><strong>bulkInsert()虽然会提高数据插入性能, 但是此方法只使用插入操作</strong></p>
<p>如果要在一次事务中执行多次<code>update()</code>或者<code>delete()</code>语句, 必须实现<code>ContentProvider.applyBatch()</code>方法. 接收一个<code>ContentProviderOperation集合</code>.内部循环集合通过调用<code>apply()</code>在事务内部实现操作.</p>
<p>该API是为<code>ContactsProvider</code>等较复杂的<code>ContentProvider</code>设计的, 他们有许多连接的表, 每个都有自己的<code>Uri</code>. 另外如果要批量插入多个表, 该API也可以使用.</p>
<h2 id="序列化数据"><a href="#序列化数据" class="headerlink" title="序列化数据"></a>序列化数据</h2><p>如果要在<code>Intent</code>上传输数据或者和另外一台设备共享数据, 需要把数据转化成接收端能识别的格式, 并且还要适于在网络上传输. 这种技术称为<code>序列化(serialization)</code></p>
<p>序列化是从内存中取出数据并把其写到文件(或者其他输出)中, 是的以后能读取完全相同的数据称为<code>反序列化</code>. android内部使用了<code>Parcelable</code>接口来处理序列化工作, 但它不适合在文件上持久存储或者在网络上传输数据.</p>
<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><p><code>JSON</code>是<code>JavaScript Object Notation</code>的缩写, 是<code>JavaScript</code>标准的一个子集. 这种格式很适合表示非二进制数据的.</p>
<p>例如一下JSON数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">    &#123;</div><div class="line">        &quot;name&quot;:&quot;张三&quot;</div><div class="line">        &quot;id&quot;  :&quot;1&quot;</div><div class="line">        &quot;sex&quot; :&quot;男&quot;</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        &quot;name&quot;:&quot;张三&quot;</div><div class="line">        &quot;id&quot;  :&quot;1&quot;</div><div class="line">        &quot;sex&quot; :&quot;男&quot;</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        &quot;name&quot;:&quot;张三&quot;</div><div class="line">        &quot;id&quot;  :&quot;1&quot;</div><div class="line">        &quot;sex&quot; :&quot;男&quot;</div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>这里说一下另一个<code>API</code>作为了解, 通过获得输入输出流利用<code>JsonReader</code>和<code>JsonWriter</code>API进行. 相比较直接把一个流中的全部内容读取为一个<code>String</code>中, 然后传给<code>JSONArray</code>的构造函数, 使用<code>JsonReader</code>会消耗更少的内存, 并且相对来说会更快.</p>
<p>直接使用JSON API 现在也不常用, 想了解看一下<a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/blob/master/StoreOrTest/app/src/main/java/com/szysky/note/storeortest/serialization/JSONDemo.java" target="_blank" rel="external">实例代码</a></p>
<h3 id="Gson介绍"><a href="#Gson介绍" class="headerlink" title="Gson介绍"></a>Gson介绍</h3><p><code>JSONObject</code>和<code>JSONArray</code>类使用起来虽然很方便, 但是他们也有一定的局限性, 并且通常会消耗更多不必要的内存. 同样, 如果有多个不同类型的对象, 使用<code>JsonReader</code>和<code>JsonWriter</code>需要编写比较多的代码. 所以如果需要更高级的JSON数据序列化和反序列化方法, 可是使用<code>Gson</code></p>
<p><code>Gson</code>允许把简单的Java对象转换成<code>JSON</code>, 反之亦然. 所以常做的就是生成一个<code>JavaBean</code>对象, 提供set/get并转换成json对象.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/12/android/books/《Android 编程实战》Chap7_序列化说明/" data-id="cj7hnifdq00106opjay74moqq" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/12/android/books/《Android 编程实战》Chap7_序列化说明/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android/books/《Android 编程实战》Chap6_重识BroadcastReceiver" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/12/android/books/《Android 编程实战》Chap6_重识BroadcastReceiver/">《Android 编程实战》Chap6_重识BroadcastReceiver</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/12/android/books/《Android 编程实战》Chap6_重识BroadcastReceiver/">
            <time datetime="2017-09-11T23:55:35.000Z" itemprop="datePublished">2017-09-12</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>阅读《Android 编程实战》一书的随记笔记<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h2 id="BroadcastReceiver"><a href="#BroadcastReceiver" class="headerlink" title="BroadcastReceiver"></a>BroadcastReceiver</h2><p><code>Android</code>中发送广播事件最常用的方式是通过<code>Content.sendBroadcast()</code>方法给<code>BroadcastReceiver</code>发送<code>Intent</code>对象. 许多标准系统事件都被定义成操作字符串, 并可以在<code>Intent</code>类的API文档中查看. 例如, 如果需要在用户连接或者断开充电器的时候收到通知, 可以使用<code>Intent</code>中定义的两个广播操作: <code>ACTION_POWER_DISCONNECTED</code>和<code>ACTION_POWER_CONNECTED</code>.</p>
<hr>
<p><strong>举例: 例如监听手机充电状态改变的广播</strong></p>
<p>首先派生出一个<code>BroadcastReceiver</code>的子类.复写<code>onReceiver()</code>方法. 如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class ChargerConnectedReceiver extends BroadcastReceiver &#123;</div><div class="line">    public ChargerConnectedReceiver() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onReceive(Context context, Intent intent) &#123;</div><div class="line">        String action = intent.getAction();</div><div class="line"></div><div class="line">        if (Intent.ACTION_POWER_CONNECTED.equals(action))&#123;</div><div class="line">            Toast.makeText(context, &quot;手机充电啦&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;else if (Intent.ACTION_POWER_DISCONNECTED.equals(action))&#123;</div><div class="line">            Toast.makeText(context, &quot;手机不充电了&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后需要注册广播, 告诉系统在当哪一个<code>action</code>动作发生的时候需要回调我们自定的接收者的<code>onReceive()</code>方法. 这里有两种方法, <code>静态注册</code>和<code>动态注册</code>.</p>
<p><strong>静态注册</strong></p>
<p>在清单文件中声明这个广播组件, 并设置<code>intent-filter</code>即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;receiver android:name=&quot;broadcast.ChargerConnectedReceiver&quot;&gt;</div><div class="line">  &lt;intent-filter&gt;</div><div class="line">      &lt;action android:name=&quot;android.intent.action.ACTION_POWER_CONNECTED&quot;/&gt;</div><div class="line">      &lt;action android:name=&quot;android.intent.action.ACTION_POWER_DISCONNECTED&quot;/&gt;</div><div class="line">  &lt;/intent-filter&gt;</div><div class="line">&lt;/receiver&gt;</div></pre></td></tr></table></figure>
<p><strong>动态注册</strong></p>
<p>一般情况动态注册都是在<code>Activity</code>中的<code>onCreate()</code>和<code>onResume()</code>同时出现的. 例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class ChargerConnectedActivity extends Activity &#123;</div><div class="line"></div><div class="line">    private ChargerConnectedReceiver chargerConnectedReceiver;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onResume() &#123;</div><div class="line">        super.onResume();</div><div class="line">        // 生成对于广播的 intent过滤条件</div><div class="line">        IntentFilter intentFilter = new IntentFilter();</div><div class="line">        intentFilter.addAction(Intent.ACTION_POWER_CONNECTED);</div><div class="line">        intentFilter.addAction(Intent.ACTION_POWER_DISCONNECTED);</div><div class="line">        chargerConnectedReceiver = new ChargerConnectedReceiver();</div><div class="line">        registerReceiver(chargerConnectedReceiver, intentFilter);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onPause() &#123;</div><div class="line">        super.onPause();</div><div class="line">        unregisterReceiver(chargerConnectedReceiver);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果只在应用程序处于运行或活动状态时才关心广播事件时, 可以选择在代码中注册广播. 这样可以让应用程序消耗更少的资源; 如果在清单文件中声明, 则每当有事件发生时, 广播接收器都会启动, 因此会消耗更多资源.</p>
<h3 id="本地BroadcastReceiver"><a href="#本地BroadcastReceiver" class="headerlink" title="本地BroadcastReceiver"></a>本地BroadcastReceiver</h3><p>如果只是在应用程序进程内发送和接收广播, 那么可以使用<code>LocalBroadcastManager</code>而不是更常用的<code>Context.sendBroadcast()</code>方法. 这种方法更高效, 因为不需要跨进程管理操作, 也不需要考虑广播通常涉及的安全问题. 标准IPA中没有包含<code>LocalBroadcastManager</code>类, 但是可以在支持包(support_V4)中找到. 下面演示如何使用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public static final String LOCAL_BROADCAST_ACTION = &quot;localBroadcast&quot;;</div><div class="line">private BroadcastReceiver mLocalReceiver;</div><div class="line"></div><div class="line">// 注册本地广播</div><div class="line">private void initLocalBroadcast() &#123;</div><div class="line">   LocalBroadcastManager instance = LocalBroadcastManager.getInstance(getApplicationContext());</div><div class="line">   IntentFilter intentFilter = new IntentFilter(LOCAL_BROADCAST_ACTION);</div><div class="line"></div><div class="line">   mLocalReceiver = new BroadcastReceiver() &#123;</div><div class="line">       @Override</div><div class="line">       public void onReceive(Context context, Intent intent) &#123;</div><div class="line">           Toast.makeText(getApplicationContext(), &quot;本地广播接收到&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">       &#125;</div><div class="line">   &#125;;</div><div class="line"></div><div class="line">   instance.registerReceiver(mLocalReceiver, intentFilter);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 发送本地广播</div><div class="line">findViewById(R.id.btn_send).setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">  @Override</div><div class="line">  public void onClick(View v) &#123;</div><div class="line">      LocalBroadcastManager instance = LocalBroadcastManager.getInstance(getApplicationContext());</div><div class="line">      // 上面定义的通电状态action</div><div class="line">      Intent intent = new Intent(LOCAL_BROADCAST_ACTION);</div><div class="line">      instance.sendBroadcast(intent);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>在应用程序内部使用本地广播来广播消息和状态也非常方便. 本地广播比标准的全局广播更高效和安全, 因为它不会把数据泄露给其他应用程序. 切记要和正常的接收器一样, 在对应的方法中要移除注册, 否则可能会有内存泄漏.</p>
<h3 id="普通广播和粘性广播"><a href="#普通广播和粘性广播" class="headerlink" title="普通广播和粘性广播"></a>普通广播和粘性广播</h3><p>广播分为两种类型: <strong>普通广播</strong>和<strong>有序广播</strong>.</p>
<ul>
<li><strong>普通广播</strong>会以异步方式发送给所有的接收者, 并且没有指定的接收顺序. 该方式更加高效, 但是缺少有序广播额一些高级功能, 比如不能发送结果反馈.</li>
<li><strong>有序广播</strong>按照特定的顺序分发, 每次只发给一个接收者, 开发者可以在清单文件中设置接收者的<code>intent-filter</code>标签的<code>android:priority</code>属性来控制广播的接收顺序. 有序广播还有另外一个特性: 通过使用<code>abortBroadcast()</code>, <code>setResultCode()</code>和<code>setResultData()</code>方法, 接收者可以把结果回传给广播, 或者终止广播的分发, 这样<code>Intent</code>就不会传递给下一个广播接收者.</li>
</ul>
<p>有序广播由<code>Context.sendOrderedBroadcast()</code>发起, 在接收者的<code>onReceive()</code>回调中, 通过<code>isOrderedBroadcast()</code>来判断该广播是否是有序广播. 如果是, 可以通过上面<code>setXxxx()</code>方法设置要传递下去的数据.</p>
<p>日常开发很少需要在自己的应用程序发送有序广播, 但如果要跟其他应用程序通信(比如插件), 有序广播就有用途. 在Android系统中, 有序广播最常见的场景就是监听传入的短信(隐藏API)的一部分. 后面篇幅会说.</p>
<h3 id="粘性广播"><a href="#粘性广播" class="headerlink" title="粘性广播"></a>粘性广播</h3><p><code>粘性广播(sticky broadcast)</code> 是一个普通广播的变体, 它和普通广播有细微的区别. 粘性广播在使用<code>Context.sendStickyBroadcast()</code>发送<code>Intent</code>之后, 该<code>Intent</code>还会”继续保留”, 允许之后匹配由该<code>Intent</code>新注册的广播接收者, 并发送<code>Intent</code>.(<a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/commit/ec42e2e44877f5b4b3c5363600646c4e808929e3" target="_blank" rel="external">查看验证代码</a>)</p>
<p>粘性广播的一个例子是<code>Intent.ACTION_BATTERY_CHANGED</code>, 它用来指示设备中电池电量的变化. 另一个列子是<code>Intent.ACTION_DOCK_EVENT</code>, 用来只是设备是否放在了底座. 更多的粘性广播请参考google文档. 下面的代码展示如何</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">private void myRegisterBattery()&#123;</div><div class="line">   // 构建广播接收者要接收的action</div><div class="line">   IntentFilter intent = new IntentFilter();</div><div class="line">   intent.addAction(Intent.ACTION_BATTERY_CHANGED);</div><div class="line">   intent.addAction(Intent.ACTION_BATTERY_OKAY);</div><div class="line">   intent.addAction(Intent.ACTION_BATTERY_LOW);</div><div class="line">   </div><div class="line">   // 创建监听</div><div class="line">   BroadcastReceiver broadcastReceiver = new BroadcastReceiver() &#123;</div><div class="line">       @Override</div><div class="line">       public void onReceive(Context context, Intent intent) &#123;</div><div class="line">           if (isInitialStickyBroadcast()) &#123;</div><div class="line">               Log.e(&quot;sususu&quot;, &quot;这是一个粘性广播&quot;);</div><div class="line">           &#125; else &#123;</div><div class="line">               Log.e(&quot;sususu&quot;, &quot;这是不是粘性广播&quot;);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;;</div><div class="line">   // 注册接收者</div><div class="line">   registerReceiver(broadcastReceiver, intent);</div><div class="line">&#125;</div><div class="line">​``` </div><div class="line"></div><div class="line">该方法在广播全系统的状态时特别有用, 如果你需要发送粘性广播, 那么**请添加权限**在清单文件中`&lt;uses-permission android:name=&quot;android.permission.BROADCAST_STICKY&quot;/&gt;`权限, 并使用`Context.sendStickyBroadcast()`发送粘性广播. </div><div class="line"></div><div class="line">&gt; 对于粘性广播一定要慎用, 因为它比普通广播更消耗资源.</div><div class="line"></div><div class="line"></div><div class="line">### 定向广播</div><div class="line"></div><div class="line">普通广播的另一个变体是`定向广播(directed broadcast)`. 定向广播使用过了`intent-filter`的一个特性, 通过在`Intent`设置`ComponentName`来显示指定接收者. 它把注册接收者的类名和包名结合在了一起. 如下:</div><div class="line"></div><div class="line"></div><div class="line">​```java</div><div class="line">Intent intent = new Intent();</div><div class="line">intent.setComponent(new Component(packName, className));</div><div class="line">sendBroadcast(intent);</div></pre></td></tr></table></figure>
<p>这个例子只会指定的class类的广播接收者才可以收到广播, 即便其他接收器也注册了相同的<code>Intent</code>操作. <strong>注意:使用定向广播需要同时知道接收者的包名和类名.</strong>. 使用场景很少.</p>
<h3 id="启动和禁用广播接收器"><a href="#启动和禁用广播接收器" class="headerlink" title="启动和禁用广播接收器"></a>启动和禁用广播接收器</h3><p>如果广播接收者在清单文件中注册的, 还有另外一种减少对系统负载的影响的方法. 通过<code>PackageManager</code>, 开发者可以启动和禁用应用程序的组件, 这在用户比如在应用设置更改后使用此方法即可. 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* 设置组件</div><div class="line">* @param setClass 要设置改变的组件</div><div class="line">* @param isEnable true为启用, false为禁用</div><div class="line">*/</div><div class="line">public void setComponentEnable(boolean isEnable, Class setClass)&#123;</div><div class="line">   PackageManager pm = getPackageManager();</div><div class="line">   // 构建要改变组件的Component</div><div class="line">   ComponentName componentName = new ComponentName(getApplicationContext(), setClass);</div><div class="line">   pm.setComponentEnabledSetting(componentName,</div><div class="line">           isEnable ? PackageManager.COMPONENT_ENABLED_STATE_ENABLED : PackageManager.COMPONENT_ENABLED_STATE_DISABLED,</div><div class="line">           PackageManager.DONT_KILL_APP);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>记住, 这里仅适用静态注册就是清单文件上注册, 不支持动态注册的会抛出异常, 并且这里接收的class同样适用于Activity, Service, ContentProvider</code>. 其本质就是改变在清单文件中组件标签的<code>&lt;android:enable=&#39;true/false&#39;&gt;</code>.</p>
<p>关于<code>setComponentEnabledSetting()</code>方法的最后一个参数<code>PackageManager.DONT_KILL_APP</code>的使用. 这回防止平台杀死应用, 如果不设置该值平台默认会杀死应用.</p>
<blockquote>
<p>可以用在应用程序启动图标的切换, 比如,开发者可以在安装应用程序后只显示设置Activity界面, 在设置完成之后使用该方法把启动图标隐藏</p>
</blockquote>
<h3 id="系统广播Intent"><a href="#系统广播Intent" class="headerlink" title="系统广播Intent"></a>系统广播Intent</h3><p><code>Android API</code>定义了许多不同的系统广播事件. 例如电池电量变化, 是否连接了设备电源. 并且还有一些可能会用到的广播, 但是action并没有在API中公开, 所以后面的篇幅也会对一些隐藏的API进行一定记录.这里说一下常用的系统事件</p>
<hr>
<p><strong>自动启动应用程序</strong></p>
<p>关于自启动这个问题在国内比较蛋疼, 由于各种厂商对<code>ROM</code>的修改, 各式各样. 目前为我自己的实验是只有<code>Google Nexus4</code>可以直接声明<code>BOOT_complete</code>重启的广播, <code>魅族4</code>,<code>三星S6</code>都无法做到重启可以监听到重启广播. 需要对应用通过手机提供的应用管理, 把<code>自启动开启才可以达到预期的效果</code>. 这里尝试的做法是<code>注册监听重启广播的接收</code>, <code>添加权限&lt;uses-permission android:name=&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;/&gt;</code>, <code>添加&lt;manifest&gt;标签的内属性android:installLocation=&quot;internalOnly&quot;</code>确保应用正确安装到内存储位置.</p>
<p>广播的监听的对应action:<code>android.intent.action.BOOT_COMPLETED</code></p>
<p>还有一个应用程序包替换的时候的广播, 例如升级<code>android.intent.action.MY_PACKAGE_REPLACED</code></p>
<hr>
<p><strong>用户状态和屏幕状态</strong></p>
<p>虽然当按下关机键和锁屏键会触发屏幕熄灭, <code>Activity</code>会调用对应的焦点失去或者获取的回调. 但是如果服务<code>Service</code>需要注意此动作的时候, 我们通过屏幕的状态广播来监听这是很方便的.</p>
<p>相关广播<code>action</code></p>
<ul>
<li><code>action.intent.action.SCREEN_OFF</code></li>
<li><code>action.intent.action.SCREEN_ON</code></li>
<li><code>action.intent.action.SCREEN_PRESENT</code></li>
</ul>
<p>开启和关闭设备屏幕时, 系统会分别发送<code>Intent.ACTION_SCREEN_ON</code>和<code>Intent.ACTION_OFF</code>广播事件. 当用户解锁屏幕时系统会发送<code>Intent.ACTION_USER_PRESENT</code>广播事件.</p>
<hr>
<p><strong>网络和连接变化</strong></p>
<p>大多数<code>Android</code>设备都支持两种类型的网络: <strong>蜂窝网络</strong>和<strong>Wi-Fi网络</strong>. 如果应用程序过度依赖网络操作, 开发者可能要在蜂窝网络中推迟数据的传输, 知道设备连接到<code>Wi-Fi网络</code>; 否则, 如果使用<code>3G</code>, <code>LTE</code>之类的移动网络传输可能会产生相当可观的流量.</p>
<p>连接的相关广播和网络相关的广播分别由不同的API负责. 每当有通用的网络连接变化发生时, 比如从<code>Wi-Fi</code>切换到移动数据, 系统就会发送<code>ConnectivityManager.CONNECTIVITY_ACTION</code>广播, 接下来可以使用<code>Context.getService()</code>方法来检索<code>ConnectivityManager</code>服务, 它允许开发者获取当前网络的更多信息.</p>
<p>然而, 要获取当前网络更细粒度的信息, 开发者还需要监听来自<code>TelephonyManager</code>和<code>WifiManager</code>的广播事件. <code>TelephonyManager</code>允许查询移动数据连接的类型, <code>WiFiManager</code>允许检索<code>WiFi</code>连接状态并访问和<code>WiFi</code>相关的不同<code>ID(SSID是wifi名称和BSSID对应mac地址)</code></p>
<p>以下代码会检测设备是否连接到了预先设置的某一个<code>WiFi</code>. 使用此方法可以有效地和服务器或者只是支持特定的<code>Wi-Fi</code>的媒体进行通信.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 检查wifi广播--&gt;</div><div class="line">&lt;receiver</div><div class="line">  android:name=&quot;broadcast.CheckForHomeWifi&quot;&gt;</div><div class="line"></div><div class="line">  &lt;intent-filter&gt;</div><div class="line">      &lt;!--监听wifi的连接状态是否连接上一个有效无线路由--&gt;</div><div class="line">      &lt;action android:name=&quot;android.net.wifi.WIFI_STATE_CHANGED&quot; /&gt;</div><div class="line">      &lt;!--监听wifi的打开和关闭, 和wifi具体的连接不关心--&gt;</div><div class="line">      &lt;action android:name=&quot;android.net.wifi.STATE_CHANGE&quot; /&gt;</div><div class="line">  &lt;/intent-filter&gt;</div><div class="line"></div><div class="line">&lt;/receiver&gt;</div></pre></td></tr></table></figure>
<p>如果只需要关心wifi的开启, 和wifi连接到某一个路由, 那么这两个广播监听足够了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onReceive(Context context, Intent intent) &#123;</div><div class="line"></div><div class="line">   // 需要判断的路由名字 对应ssid </div><div class="line">   String name = &quot;\&quot;ziroom502\&quot;&quot;;</div><div class="line"></div><div class="line">   // 1.首先判断wifi是否开启, 并连接</div><div class="line">   NetworkInfo networkInfo = intent.getParcelableExtra(WifiManager.EXTRA_NETWORK_INFO);</div><div class="line">   if (networkInfo != null &amp;&amp; networkInfo.getState().equals(NetworkInfo.State.CONNECTED)) &#123;</div><div class="line"></div><div class="line">       // 2.再判断连接的wifi的具体信息</div><div class="line">       WifiInfo WifiInfo = intent.getParcelableExtra(WifiManager.EXTRA_WIFI_INFO);</div><div class="line">       if (WifiInfo != null &amp;&amp; name.equals(WifiInfo.getSSID())) &#123;</div><div class="line">           Log.d(&quot;sususu&quot;, &quot;连接到指定wifi&quot;);</div><div class="line">       &#125; else &#123;</div><div class="line">           Log.d(&quot;sususu&quot;, &quot;连接到其他wifi&quot;);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是一个简单的初步判断, 如果需要结合手机连接判断, 结合下面的另一个监听, 整合起来就差不多了.</p>
<hr>
<p>这个监听来自<code>ConnectivityManager</code>的变化, 并确定当前连接的是否为移动数据网络. 如果收到移动数据, 接下来在使用<code>TelephonyManager</code>检查是否在使用<code>3G</code>或者<code>LTE</code>网络.</p>
<p>监听广播的清单文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> &lt;!--判断手机连接--&gt;</div><div class="line">&lt;receiver</div><div class="line">  android:name=&quot;broadcast.WhenOn3GorLTE&quot;&gt;</div><div class="line">  &lt;intent-filter&gt;</div><div class="line">      &lt;!--此广播监听, 网络连接的设置包括wifi和数据的打开和关闭--&gt;</div><div class="line">      &lt;action android:name=&quot;android.net.conn.CONNECTIVITY_CHANGE&quot; /&gt;</div><div class="line">  &lt;/intent-filter&gt;</div><div class="line">&lt;/receiver&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">public class WhenOn3GorLTE extends BroadcastReceiver &#123;</div><div class="line">    private static final String TAG = WhenOn3GorLTE.class.getSimpleName();</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onReceive(Context context, Intent intent) &#123;</div><div class="line">        String action = intent.getAction();</div><div class="line">        if (ConnectivityManager.CONNECTIVITY_ACTION.equals(action))&#123;</div><div class="line">            boolean noConnectivity = intent.getBooleanExtra(ConnectivityManager.EXTRA_NO_CONNECTIVITY, false);</div><div class="line">            </div><div class="line">            if (noConnectivity)&#123;</div><div class="line">                Log.e(TAG, &quot;没有连接&quot; );</div><div class="line">            &#125;else&#123;</div><div class="line">                int networkType = intent.getIntExtra(ConnectivityManager.EXTRA_NETWORK_TYPE, ConnectivityManager.TYPE_DUMMY);</div><div class="line">                </div><div class="line">                if (networkType == ConnectivityManager.TYPE_MOBILE)&#123;</div><div class="line">                    checkfor3GorLte(context);</div><div class="line">                &#125;else&#123;</div><div class="line">                    Log.i(TAG, &quot;不是移动连接&quot;);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    /**</div><div class="line">     *  当前如果移动数据开启, 那么显示出移动数据的连接类型</div><div class="line">     */</div><div class="line">    private void checkfor3GorLte(Context context)&#123;</div><div class="line"></div><div class="line">        TelephonyManager telephonyManager = (TelephonyManager) context.getSystemService(Context.TELEPHONY_SERVICE);</div><div class="line"></div><div class="line">        switch (telephonyManager.getNetworkType())&#123;</div><div class="line">            case TelephonyManager.NETWORK_TYPE_HSDPA:</div><div class="line">                Log.d(TAG, &quot;连接类型: NETWORK_TYPE_HSDPA&quot;);</div><div class="line">                break;</div><div class="line"></div><div class="line">            case TelephonyManager.NETWORK_TYPE_HSPA:</div><div class="line">                Log.d(TAG, &quot;连接类型: NETWORK_TYPE_HSPA&quot;);</div><div class="line">                break;</div><div class="line"></div><div class="line">            case TelephonyManager.NETWORK_TYPE_HSPAP:</div><div class="line">                Log.d(TAG, &quot;连接类型: NETWORK_TYPE_HSPAP&quot;);</div><div class="line">                break;</div><div class="line"></div><div class="line">            case TelephonyManager.NETWORK_TYPE_HSUPA:</div><div class="line">                Log.d(TAG, &quot;连接类型: NETWORK_TYPE_HSUPA&quot;);</div><div class="line">                break;</div><div class="line"></div><div class="line">            case TelephonyManager.NETWORK_TYPE_LTE:</div><div class="line">                Log.d(TAG, &quot;连接类型: NETWORK_TYPE_LTE&quot;);</div><div class="line">                break;</div><div class="line"></div><div class="line">            default:</div><div class="line">                Log.d(TAG, &quot;连接类型: 未知类型, 可能传输速度会慢&quot;);</div><div class="line">                break;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>此广播稍微有2秒左右延迟, 当wifi开关,和移动数据开关变化的时候不会立即响应</strong></p>
<p>一下记录一下测试的结果广播接收情况,以上判断条件是获取的<code>intent中的ConnectivityManager.EXTRA_NO_CONNECTIVITY</code>(测试手机三星S6), 可能会因为不同的条件产生不同的结果. 这里只说明代码中的条件说明:</p>
<ul>
<li><code>当wifi连接开启</code>: 这时打开或者关闭移动数据, 不会发送广播.</li>
<li><code>当移动数据开启</code>: 这时操作wifi开关会接收到两个广播.</li>
<li><ul>
<li>如果从<code>wifi关闭</code>-&gt;<code>wifi开启</code>那么首先会发送一个<code>移动数据的状态info广播</code>,紧接着会发送一个<code>wifi连接</code>相关的广播(总共两个有效连接)</li>
</ul>
</li>
<li><ul>
<li>如果<code>wifi开启</code> -&gt; <code>wifi关闭</code>那么首先会收到一个<code>无连接</code>的广播, 然后会接收到一个<code>移动数据</code>连接类型的广播.</li>
</ul>
</li>
<li><code>如果当都关闭的时候</code>: 开启任意一个只能接收到一个广播.</li>
</ul>
<p>这种方式也可以获取<code>wifi</code>连接的信息, 但是<strong>延迟性</strong>是这个方式的特点.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/12/android/books/《Android 编程实战》Chap6_重识BroadcastReceiver/" data-id="cj7hnifdw00176opj1wh47t2d" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/12/android/books/《Android 编程实战》Chap6_重识BroadcastReceiver/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android/books/《Android 编程实战》Chap5_重识IPC" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/12/android/books/《Android 编程实战》Chap5_重识IPC/">《Android 编程实战》Chap5_重识IPC</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/12/android/books/《Android 编程实战》Chap5_重识IPC/">
            <time datetime="2017-09-11T23:54:53.000Z" itemprop="datePublished">2017-09-12</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>阅读《Android 编程实战》一书的随记笔记<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h2 id="Binder简介"><a href="#Binder简介" class="headerlink" title="Binder简介"></a>Binder简介</h2><p><code>Android</code>有一个强大的功能, 就是能够在不同应用程序之间进行通信. 绝大部分的实现都是由<code>Binder IPC(Inter-Process Communication)</code>进行处理的.</p>
<p><code>Android</code>中的<code>Binder</code>有着悠久的历史. 最终它的名字叫做<code>OpenBinder</code>, 是Be公司开发的Be操作系统(BeOS). 后来被移植到<code>Android</code>平台, 并且进行了重写以支持应用程序间的IPC. 基本上<code>Binder</code>提供了在不同执行环境间绑定功能和数据的特性. <code>Binder</code>非常适合在<code>Android</code>应用程序间进行通信, 因为每个<code>Android</code>应用程序都运行在自己的<code>Dalvik</code>虚拟机里, 而每个虚拟机又是独立的运行环境.</p>
<blockquote>
<p>在2009年, <code>Linux</code>社区就谷歌选择<code>Binder</code>而非选择<code>dbus</code>的原因有过很长时间的争论, 因为在此之前<code>Linux</code>内核一直使用<code>dbus</code>来实现IPC机制. 最开始开发<code>Android</code>时, <code>Binder</code>成了IPC的最佳选择, 如今它已成为<code>Android</code>系统的一个组成成分. <code>Linux</code>中的<code>dbus</code>机制也用在许多的<code>Android</code>设备上, 特别是为无线接口层(Radio Interface Layer, RIL)通信以及<code>Android 4.3</code>以后的蓝牙通信. 但大部分IPC还是<code>Binder</code>.</p>
</blockquote>
<p>使用<code>Binder IPC</code>进行通信时, 两个应用程序使用内核驱动来传递消息(如下图), 除了发送消息, <code>Binder</code>还提供了其他功能, 比如识别远程调用者(进程ID和用户ID), 以及当远程进程被烧死(<code>link-to-death</code>)时发送通知.</p>
<p><img src="http://szysky.com/2016/09/28/%E3%80%8AAndroid-%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B05-%E9%87%8D%E8%AF%86-IPC/BinderIPC.png" alt="img"></p>
<p>例如, 当<code>系统Service</code>(通过WindowManager管理Android所有窗口)为每个应用保持一个<code>Binder</code>引用时会调用这些附加函数, 当应用窗口关闭时会收到link-to-death通知.</p>
<p><code>Binder</code>通信遵循<strong>客户端-服务端模式</strong>, 客户端使用客户端代理来处理与内核驱动程序的通信. 在服务器端, <code>Binder</code>框架维护了一系列<code>Binder线程</code>. 内核驱动会使用服务端的<code>Binder</code>线程把消息从客户端代理分发个接收对象. 这一点需要特别注意, 因为当通过Binder接收<code>Service</code>调用时, 他们并不会运行在应用程序的主线程上, 这样一来, 客户端连接远程Service的连接就不会阻塞应用的主线程.</p>
<h3 id="Binder地址"><a href="#Binder地址" class="headerlink" title="Binder地址"></a>Binder地址</h3><p>使用<code>Binder</code>通信时, 客户端需要知道远程<code>Binder</code>对象的地址. 然而, <code>Binder</code>的设计要求只有实现类(比如要调用的Service)才知道该地址. 开发者使用<code>Intent</code>解析来进行寻址. 客户端使用<code>action</code><br>字符串或者组件名(componentName)来构造<code>Intent</code>对象, 然后使用它初始化于远程应用程序的通信. <code>Intent</code>只是实际<code>Binder</code>地址的抽象描述, 为了能够建立通信, 还需要翻译成实际的地址.</p>
<p><code>ServiceManager</code>是一个特殊的<code>Binder</code>节点, 它运行在<code>Android</code>系统服务内, 管理所有的地址解析, 是唯一一个有全局地址的<code>Binder</code>节点. 因为所有的<code>Android组件</code>都是用<code>Binder</code>进行通信, 所以它们需要使用<code>ServiceManager</code>进行注册.</p>
<p>客户端要想和<code>Service</code>或者其他组件进行通信, 需隐式地通过<code>Intent</code>查询<code>ServiceManager</code>来接收<code>Binder</code>地址.</p>
<h3 id="Binder事务"><a href="#Binder事务" class="headerlink" title="Binder事务"></a>Binder事务</h3><p>在<code>Android</code>中, <strong>事务(transaction)</strong>是指一个进程发送数据到另一个进程. 在<code>Binder</code>上开启事务首先会在客户端调用<code>IBinder,transact()</code>, 然后<code>Service</code>收到<code>Binder.onTranscat()</code>方法回调.</p>
<p>如下演示了在客户端如何使用<code>IBinder</code>引用向服务端执行自定义的<code>Binder</code>事务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public String performCustomBinderTransaction(IBinder binder, String arg0, int arg1) throws RemoteException &#123;</div><div class="line"></div><div class="line">   Parcel request = Parcel.obtain();</div><div class="line">   Parcel response = Parcel.obtain();</div><div class="line"></div><div class="line">   // 组装请求数据, 要发送到服务端的</div><div class="line">   request.writeString(arg0);</div><div class="line">   request.writeInt(arg1);</div><div class="line"></div><div class="line">   // 执行事务</div><div class="line">   binder.transact(IBinder.FIRST_CALL_TRANSACTION, request, response, 0);</div><div class="line"></div><div class="line">   // 从响应中读取结果</div><div class="line">   String result = response.readString();</div><div class="line"></div><div class="line">   // 释放资源, 以便循环利用</div><div class="line">   request.recycle();</div><div class="line">   response.recycle();</div><div class="line"></div><div class="line">   return result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而服务端会实现一个继承<code>Binder</code>类, 通过<code>onTransact()</code>来接收客户端的数据, 如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public class ServerBinder extends Binder &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected boolean onTransact(int code, Parcel data, Parcel reply, int flags) throws RemoteException &#123;</div><div class="line">//        return super.onTransact(code, data, reply, flags);</div><div class="line"></div><div class="line">        // 开始读取客户端发送的请求数据</div><div class="line">        String arg0 = data.readString();</div><div class="line">        int arg1 = data.readInt();</div><div class="line"></div><div class="line">        // 处理接收结果, 并生成返回的数据</div><div class="line">        String result = buildResult(arg0, arg1);</div><div class="line"></div><div class="line">        // 把结果写入想用Parcel</div><div class="line">        reply.writeString(result);</div><div class="line"></div><div class="line">        // 成功后返回true</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private String buildResult(String arg0, int arg1)&#123;</div><div class="line">        String result = null;</div><div class="line"></div><div class="line">        // ...这里省略业务逻辑, 以后可自行添加</div><div class="line"></div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上, 因为属于作为远程服务端中实现自定义的<code>Binder</code>对象时没有使用<code>AIDL</code>. 所以这里需要自己处理<code>onTransact()</code>方法.</p>
<p>上面两个代码通过<code>Binder IPC</code>进行的同步双向调用. 也可在客户端执行单项的调用, 只需在客户端发送事务的方法进行相应更改即可, 如<code>IBinder.transact()</code>方法调用中把标识位设置为<code>FLAG_ONEWAY</code>, 这样就可以把第二个<code>Parcel</code>参数设置为null. 单项调用会提供更好的性能, 因为只需对一个<code>Parcel</code>对象进行编解码操作.</p>
<p>当然这里只是让其了解一下流程, 当真正实现进程间通信, 或者提供其他应用调用的API的时候不会直接操作这种底层的方式在两个程序之间执行事务, 而是使用对这种事务进行进一步封装的<code>AIDL</code>或者<code>Messenger</code>等.<br>而对于更细粒度地控制数据如何应用间发送, 使用底层binder操作事务这是正确的.</p>
<h3 id="Parcel"><a href="#Parcel" class="headerlink" title="Parcel"></a>Parcel</h3><p><code>Binder</code>事务通常会传递事务数据, 这种数据被称为<code>Parcel</code>(包裹).</p>
<p><code>Android</code>中的<code>Parcel</code>和<code>Java SE</code>中序列化对象类似, 不同之处在于, 开发者需要使用<code>Parcelable</code>接口实现对象的编解码工作. 该接口定义了两个编写<code>Parcel</code>对象的方法, 以及一个静态的不可被复写的<code>Creator</code>对象, 该对象用来从<code>Parcel</code>中读取相应的对象.</p>
<h3 id="link-to-death"><a href="#link-to-death" class="headerlink" title="link to death"></a>link to death</h3><p><code>Binder</code>的另一个特点, 允许客户端在<code>Service</code>终止的时候收到通知. 这就被称为<code>link to death</code>.</p>
<p><code>Binder</code>的<code>IBinder.linkToDeath()</code>方法实现了该机制. 当客户端在<code>onServiceConnected()</code>方法中收到<code>IBinder</code>对象, 它可以用实现了<code>IBinder.DeathRecipient</code>接口的参数调用<code>linkToDeath()</code>方法. 因为<code>Android</code>可能在资源不足的(RAM)时被系统杀死, 在客户端注册远程被终止的监听通知会很有用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"> /*</div><div class="line">  * ClassDescription: 无实际意义, 只为演示如何使用IBinder注册link-to-death</div><div class="line">  */</div><div class="line">public class LinkToDeathSample extends Service &#123;</div><div class="line"></div><div class="line">    private static final String TAG = LinkToDeathSample.class.getSimpleName();</div><div class="line"></div><div class="line"></div><div class="line">    /**</div><div class="line">     *  对客户端提供注册方法</div><div class="line">     */</div><div class="line">    private void notifyRemoteServiceDeath(IBinder iBinder )&#123;</div><div class="line">        try &#123;</div><div class="line">            iBinder.linkToDeath(new MyLinkToDeath(), 0);</div><div class="line">        &#125; catch (RemoteException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    class MyLinkToDeath implements IBinder.DeathRecipient&#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void binderDied() &#123;</div><div class="line">            // 处理远端binder被杀死的情况</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Nullable</div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>也可以调用<code>IBinder.pingBinder()</code>检查远端的<code>Binder</code>进程是否处于活动状态. 如果结果为true, 表明远端的进程处于活跃可用的状态.</p>
<p>如果绑定到的是<code>Service</code>那么就不需要监听了, 因为断开连接时总会是伴随着<code>ServiceConnection.onServiceDisconnected()</code>函数被回调. 但是, 如果使用其他方式接受<code>Binder</code>对象, 该方法可能就有用处了.</p>
<h2 id="设计API"><a href="#设计API" class="headerlink" title="设计API"></a>设计API</h2><p>虽然大多数的应用都不需要为第三方应用提供API, 但是说不定哪一天领导就突发奇想的想要这个结果.</p>
<p>可以使用<code>Service</code>或者<code>ContentProvider</code>为第三方应用开发API. 这里先介绍使用<code>Service</code>提供API. 在后续的篇幅会展示如何使用<code>ContentProvider</code>. 当实现API是, 开发者还需要考虑的因素: 是否需要处理并发请求? 每次只处理一个客户端请求是否足够? API是否只包含一个或是很少的操作? 或者是一组更加复杂的方法? 这些问题的答案将决定实现远程API最合适的方法.</p>
<p>另一个问题考虑的细节是否与其他开发者分享该API? 或者只是用于自己的应用? 如果是第一种情况 , 可以考虑构建一个库工程, 使用易于使用的Java API包装客户端的实现. 如果只是自己使用API, 那么可以使用<code>Messenger</code>或者<code>AIDL</code>, 下面我们将针对这两个使用展开.</p>
<h3 id="AIDL"><a href="#AIDL" class="headerlink" title="AIDL"></a>AIDL</h3><p>在软件工程中, <strong>接口定义语言</strong>(Interface Definition Language,IDL)已经成为通用的术语. 是用来描述软件组件接口的特定语言. 在<code>Android</code>中, 该<code>IDL</code>被称为<code>Android接口定义语言(AIDL)</code>. 它是纯文本文件, 使用Java类似语法编写. 但是, 编写Java接口和编写AIDL文件还有所有不同:</p>
<ul>
<li>首先, 对所有的非原始数据类型参数, 需要指定如下三种类型方向指示符之一:<code>in</code>, <code>out</code>, <code>inout</code>.<code>in</code>类型方向指示符只用于输入, 客户端不会看到<code>Service</code>对对象的修改. <code>out</code>类型表明输入对象不包含相关的数据, 但会由<code>Service</code>生成相关的数据. <code>inout</code>类型是上面两种类型的结合. 切记只使用需要的类型, 因为每种类型都有相应的消耗.</li>
<li>所有用于通信的自定义都需要创建一个<code>AIDL</code>文件, 用来声明该类实现了<code>Parcelable</code>接口.</li>
</ul>
<p>整理一下步骤:</p>
<ol>
<li>首先创建<code>AIDL</code>文件, 为了客户端和服务端后续的使用. <a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/commit/592cd9ef1db38fc768e5defe87be6bc7c50f1801" target="_blank" rel="external">参考链接</a> 注意: 在<code>IMyApiInterfaceV1.aidl</code>文件中对<code>CustomData</code>进行了手动的<code>import</code>导入, 并且当作为参数传递的时候使用了<strong>方向指示符</strong>,因为只有原始数据类型才不需要<strong>方向指示符</strong>,因只调用其值.(有一个<code>CustomData</code>在下次参考链接中可以看到, 应该属于这一个步骤的)</li>
<li>然后对客户端服务端进行代码实现. <a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/commit/2aa6da78376f33ac4aa3ad2f386c388ade0d6e0c" target="_blank" rel="external">参考链接</a>. 现在客户端就可以利用<code>Binder</code>调用远程的服务实现的<code>IBinder</code>方法. <strong>注意:</strong>一旦客户端实现了代码, 那么就不要在修改或者移除AIDL文件中的方法. 可以在文件末尾添加新的方法, 因为AIDL编译器会为每一个方法生成标识符, 所以不能修改现存的方法, 否则不能向后兼容老版本. 这个方法使用AIDL的缺点就是如上. 解决方案中的一种方法就是提供Java包装类, 并以库工程或者.jar文件的形式发布一遍使用. 后续会说道.</li>
<li>现在可以考虑是否需要对客户端进行回调. 如果需要,那么相同的步骤创建<code>AIDL</code>接口文件. 并在客户端实现接口文件. 在服务端使用的<code>AIDL</code>文件中添加新的方法, 这个方法用来在服务端注册一个客户端回调. 客户端的回调通过方法的参数传入, 并在客户端获取远程服务端的<code>Binder</code>对象进行注册方法调用.<a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/commit/7e75d4d7b8aa27521952dac87b5fe3d951b5e5b1" target="_blank" rel="external">参考链接</a></li>
</ol>
<p>关于客户端实现AIDL文件的时候, 在使用了<code>oneway</code>关键字, 这会告诉AIDL编译器该接口只是单向通信. 对调用者(本类中的Service)的响应不是必须的. 这样做会轻微的性能提升. 例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">package com.szysky.note.ipc.aidl;</div><div class="line"></div><div class="line">import com.szysky.note.ipc.aidl.CustomData;</div><div class="line"></div><div class="line">oneway interface IMyAidlCallback &#123;</div><div class="line">  void onDataUpdated(in CustomData[] data);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>到这里, 说明了两个应用之间传输Binder对象, 而不需要使用<code>ServiceManager</code>注册它. 由于只有客户端和<code>Service</code>知道<code>Binder</code>的地址, 因此它可以作为一种高效的IPC安全机制.</p>
<h3 id="Messenger"><a href="#Messenger" class="headerlink" title="Messenger"></a>Messenger</h3><p>使用<code>Messenger</code>进行远程通信, 有时会更简单, 当然使用场景是<strong>Service不需要支持并发操作时就可以选择使用Messenger信使来跨进程通信</strong>. <code>Messenger</code>使用<code>Handler</code>执行每个传入的消息, 所有的客户端的调用按顺序运行在同一个线程上.</p>
<ul>
<li><strong>服务端的实现</strong>: 在<code>onCreate()</code>中构建<code>Messenger</code>, 然后在<code>onBind()</code>中返回<code>Binder</code>对象. 当<code>Messenger</code>接收到消息的时候, 它可以使用在<code>replyTo</code>成员变量里的Messenger对象响应客户端都请求.<a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/commit/8833697273dc9bb0cda6850d76c82b1ffcc2d47b" target="_blank" rel="external">参考链接</a></li>
<li><strong>客户端的实现</strong>: 为了可以在服务端响应回来数据, 在<code>onCreate()</code>方法中, 同样构建一个<code>Messenger</code>作为客户端的信使. 然后在<code>onResume()</code>进行服务绑定, 在<code>ServiceConnection#onServiceConnected()</code>回调中通过获取的<code>IBinder</code>来还原出服务端的<code>Messenger</code>. 然后就可以调用其<code>send(Message)</code>方法向远程发送消息. 当然参数中的<code>Message</code>需要新建一个. 如果要做到回应客户端那么使用<code>Message.replyTo=本地Messenger实例</code>, 这样就可以在客户端构建的Messenger时传入的<code>Handler.callback()</code>接收处理.<a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/commit/4b0f94b6a39a09e0a67784f8476ac839c13d1ed7" target="_blank" rel="external">参考链接</a></li>
</ul>
<p>这种方法和<code>IntentServiec</code>很相似, 但本例没有使用<code>Intent</code>, 而是使用<code>Message</code>触发<code>Handler</code>的操作. 此外, <code>Messenger</code>实现异步通信很方便, 并且也不需要使用<code>BroadcastReceiver</code>.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/12/android/books/《Android 编程实战》Chap5_重识IPC/" data-id="cj7hnife1001d6opjiaoxcjhq" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/12/android/books/《Android 编程实战》Chap5_重识IPC/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android/books/《Android 编程实战》Chap4_手势操作进阶, 重识Service" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/11/android/books/《Android 编程实战》Chap4_手势操作进阶, 重识Service/">《Android 编程实战》Chap4_手势操作进阶, 重识Service</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/11/android/books/《Android 编程实战》Chap4_手势操作进阶, 重识Service/">
            <time datetime="2017-09-11T13:36:48.000Z" itemprop="datePublished">2017-09-11</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>阅读《Android 编程实战》一书的随记笔记<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h2 id="设计自定义视图"><a href="#设计自定义视图" class="headerlink" title="设计自定义视图"></a>设计自定义视图</h2><h3 id="View的声明周期"><a href="#View的声明周期" class="headerlink" title="View的声明周期"></a>View的声明周期</h3><p><code>View</code>也有自己的声明周期. 该生命周期并不直接和展示它的<code>Fragment</code>或者<code>Activity</code>相连, 相反<strong>它和显示它的窗口状态以及渲染循环相关</strong></p>
<p>当视图被添加到View层级结构中时, 第一个被回调的函数是<code>View.onAttachedToWindow()</code>, 这标志着它现在可以加载所需的资源了. 构建自定义视图时, 开发者应该重载该方法, 并在该方法中加载所有资源并初始化视图所需的依赖. 基本上所有的耗时的初始化都应该放在这个方法内.</p>
<p>还要一个匹配的回调名为<code>View.onDetachedFromWindow()</code>, 从View层次结构中移除视图时调用这个方法. 在这里需要关注的是需要显示清理的操作, 比如所有被加载的资源, 启动的<code>Service</code>, 或者其他依赖.</p>
<p>视图被添加到<code>View</code>层次结构中之后, 它会经过一个循环, 该循环首先计算动画, 接下来会一次回调<code>View.onMeasure()</code>, <code>View.onLayout()</code>, <code>View.onDraw()</code>等方法.</p>
<h3 id="多点触控"><a href="#多点触控" class="headerlink" title="多点触控"></a>多点触控</h3><p>先看下图效果:</p>
<p><img src="http://szysky.com/2016/09/26/%E3%80%8AAndroid-%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B04-%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C-Service/multi1.gif" alt="img"></p>
<p>贴一下实现的主要代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected void onDraw(final Canvas canvas) &#123;</div><div class="line">   super.onDraw(canvas);</div><div class="line"></div><div class="line">   // 绘制已经完成过的手势事件的所有path路径</div><div class="line">   // 如果不循环绘制, 那么当一个触控点到达了up事件之后, 那么这个触控点从down到up的事件的轨迹将会消失.</div><div class="line">   for (Path completedPath : mCompletedPaths) &#123;</div><div class="line">       canvas.drawPath(completedPath, mFingerPaint);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   // 绘制当前触摸屏上的触摸事件正在进行的轨迹 (down ~ up)</div><div class="line">   for (Path fingerPath : mFingerPaths) &#123;</div><div class="line">       if (fingerPath != null)&#123;</div><div class="line">           canvas.drawPath(fingerPath, mFingerPaint);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public boolean onTouchEvent(MotionEvent event) &#123;</div><div class="line">   // 获得当前触摸屏上的触摸个数</div><div class="line">   int pointerCount = event.getPointerCount();</div><div class="line">   int cappedPointerCount = pointerCount &gt; MAX_FINGERS ? MAX_FINGERS : pointerCount;</div><div class="line"></div><div class="line">   // 获得当前触摸事件对象所在系统保存队列中的位置</div><div class="line">   int actionIndex = event.getActionIndex();</div><div class="line">   // 获得当前触摸事件的动作类型,  这里包括 MotionEvent.ACTION_POINTER_DOWN, MotionEvent.ACTION_POINTER_UP 多点触控按下和多点触控抬起(对应数值5, 6)</div><div class="line">   int action = event.getActionMasked();</div><div class="line">   // 此值返回此触摸事件存在时刻的唯一标识id.</div><div class="line">   int pointerId = event.getPointerId(actionIndex);</div><div class="line"></div><div class="line"></div><div class="line">   // 检查是否收到按下或者抬起的动作</div><div class="line">   if ((action == MotionEvent.ACTION_DOWN || action == MotionEvent.ACTION_POINTER_DOWN) &amp;&amp; pointerId &lt; MAX_FINGERS )&#123;</div><div class="line">  </div><div class="line">       // 当有新的触摸事件开始的时候, 就使用这个事件的标识id来当下标创建一个Path对象存储起来</div><div class="line">       mFingerPaths[pointerId] = new Path();</div><div class="line">       // 注意虽然在down事件中, actionIndex和pointerId会保持一致, 但最好使用触摸事件所在的队列位置来获取坐标</div><div class="line">       mFingerPaths[pointerId].moveTo(event.getX(actionIndex), event.getY(actionIndex));</div><div class="line">  </div><div class="line"></div><div class="line">   &#125;else if ((action == MotionEvent.ACTION_UP || action == MotionEvent.ACTION_POINTER_UP) &amp;&amp; pointerId &lt; MAX_FINGERS)&#123;</div><div class="line">       // 这里的pointerId和actionIndex不一定保持一致!! 所以一定要正确使用这个两个来获取</div><div class="line">       mFingerPaths[pointerId].setLastPoint(event.getX(actionIndex), event.getY(actionIndex));</div><div class="line">       mCompletedPaths.add(mFingerPaths[pointerId]);</div><div class="line"></div><div class="line">       mFingerPaths[pointerId].computeBounds(mPathBounds, true);</div><div class="line">       invalidate((int) mPathBounds.left, (int) mPathBounds.top, (int) mPathBounds.right, (int) mPathBounds.bottom);</div><div class="line">       mFingerPaths[pointerId] = null;</div><div class="line"></div><div class="line">   &#125;</div><div class="line"></div><div class="line">   int tempIndex = 0;</div><div class="line">   // 这里主要是move事件时候进行的动态绘制实现</div><div class="line">   for (int i = 0; i &lt; cappedPointerCount; i++) &#123;</div><div class="line">       // 保证滑动事件不丢失</div><div class="line">       while(mFingerPaths[tempIndex] == null)&#123;</div><div class="line">           tempIndex++;</div><div class="line">           if (tempIndex &gt; 4)&#123;</div><div class="line">               return true;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       if (mFingerPaths[tempIndex] != null)&#123;</div><div class="line">           // 通过数组的下标也就是触摸事件的唯一标识id获得队列中的位置</div><div class="line">           int index = event.findPointerIndex(tempIndex);</div><div class="line">           // 对从down事件或者上一次移动事件的Path进行lineTo移动.</div><div class="line">           mFingerPaths[tempIndex].lineTo(event.getX(index), event.getY(index));</div><div class="line">           mFingerPaths[tempIndex].computeBounds(mPathBounds, true);</div><div class="line">           invalidate((int) mPathBounds.left, (int) mPathBounds.top, (int) mPathBounds.right, (int) mPathBounds.bottom);</div><div class="line">           tempIndex++;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上是伪代码, 如果想需要完整类,<a href="https://github.com/suzeyu1992/AndroidProgrammingPushingTheLimits/blob/master/MultiTouch/app/src/main/java/com/szysky/note/multitouch/MultiTouchView.java" target="_blank" rel="external">点击此链接到github查看</a></p>
<p>这里在进行解释说明一下:</p>
<p>每次时间发生改变的时候<code>onTouchEvent(MotionEvent)</code>都会被回调. 并且<code>MotionEvent</code>会保存当前时间点的所有<strong>触摸点的事件</strong>.</p>
<hr>
<p>举例一个场景: <strong>当三个手指同时按下</strong></p>
<p>首先系统内部有一个保存当前多点触摸事件的<strong>集合</strong>,由于跟进源码后发现方法调用的是本地方法,所以只能从出现的规律可以反推出这个集合应该是一个<strong>队列</strong>.从以下结果也可以看出.</p>
<p>虽然三个手指同时按下, 但是会依次触发<code>onTouchEvent()</code>回调. 也就是说会走三遍此回调. 当第一个触摸事件发生<code>down</code>时. 系统会创建保存一个事件对象并给这个对象的<code>pointerID</code>赋一个<code>0</code>的值并放到队列的首部, 这时当多点触控的第二个触摸事件按下的时候. 系统会遍历队列中的触摸事件的<code>pointerID</code>,如果队列第一个对象的<code>pointerID</code>不等于0那么就插入在这个对象的头部,如果等于继续下一个元素,如果下一个对象的<code>pointerID为1(就是顺序递增的效果)</code>那就继续遍历下一个元素,如果不是那就插入到这个元素也就是第二个元素对象的首部, 依次类推. 当插入后, 插入元素的<strong>所在队列的位置</strong>当做第二个触控点事件的<code>pointerID</code>; 当第三个多点触控发生时, 还是会重复上面的插入规则, 这个时候会遍历到已经存在的两个触摸对象其<code>pointerID</code>是从0开始的递增,所以这个触摸事件放到这个队列的尾部, 也就是第三个触控事件的<code>pointerID=3</code>. <code>这也就是同一个时间段,不会存在相同的pointerID的原因</code></p>
<p><code>为什么要这么麻烦的说这个? 因为当多点触控的时候不弄仅通过getX()或者getY()来取得最后一个坐标点,这个方法只是返回这个队列中的第一个元素的坐标点, 而处理多点的时候我们应该知道具体是队列总的哪一个事件触发并获取其值需要getActionIndex()获得触发事件对象的位置,然后通过getX(actionIndex)才能获取真正的发生变化的触摸点, 而且我们自己在本地记录的出现过得Path路径轨迹进行存储整理. 所以我们需要一个唯一标示来区分不同的触控点进行后续的操作</code></p>
<p><img src="http://szysky.com/2016/09/26/%E3%80%8AAndroid-%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B04-%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C-Service/multitouch_add.png" alt="img"></p>
<p><strong>而获取这个触控的事件的队列虽然在插入的时候会保证返回的所在队列的位置和其pointerID一致, 但是在连续抬起事件队列删除的元素时候有序队列元素的位置会变化, 就会导致这两个值有所不同, 请看下图</strong></p>
<p><img src="http://szysky.com/2016/09/26/%E3%80%8AAndroid-%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B04-%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C-Service/multitouch_action_index.png" alt="img"></p>
<p>上图和实现代码中有一个<code>getActionIndex()</code>获得的<code>ActionIndex</code>的int值.<strong>这个值表示触发事件对象所在系统保存的所有还在运行的事件的队列的位置.</strong> 当我们知道是一个队列的时候规律也就不难推出<code>move事件</code>的时候, 此值不会发生改变. 但是当<code>down和up事件的时候</code>会动态变化. 因为队列前面元素的变化会导致后边的元素.</p>
<p>这里可能我说的有点啰嗦, 如果看不懂解释可以去上面的连接地址down下代码, 观察输出日志即可.</p>
<hr>
<p><code>Android</code>中的<code>MotionEvent</code>类是所有<code>pointer</code>相关的操作的核心类, <code>pointer</code>意味着手指, 手写笔, 电脑鼠标或者一个外部的触摸板.</p>
<h3 id="PointerCoordinates"><a href="#PointerCoordinates" class="headerlink" title="PointerCoordinates"></a>PointerCoordinates</h3><p>这个知识点只做了解, 因为关于触摸压力值并不是真正的支持, 有的是由按下面积和或者获得的值就是恒定的.</p>
<p><code>MotionEvent</code>对象包含<code>pointer</code>的所有信息. 不同类型的的输入设备, 手指, 鼠标等都能生成<code>pointer</code>, 所以<code>MotionEvent</code>不仅包含x,y坐标. Android API支持所有<code>Linux</code>内核定义的输入设备. 因为不同设备的输入参数可能不同, 所以<code>pointer</code>被设计成有多个坐标轴. 最常用的就是坐标轴xy. 但也有描述其他信息的坐标轴, 比如压力, 距离, 方向等.</p>
<p>另外<code>MotionEvent</code>类不仅支持生成<code>pointer</code>坐标的输入设备, 还支持游戏控制相关的坐标轴信息以及诸如节流阀, 方向舵, 倾斜, 滚轮之类的输入来源.</p>
<h3 id="旋转手势"><a href="#旋转手势" class="headerlink" title="旋转手势"></a>旋转手势</h3><p><code>Android API</code>中有两个工具类能帮助开发者检测各种手势, <code>GestureDetector</code>类和<code>ScaleGestureDetector</code>类. 第一个类支持一些简单的触控手势: 比如长按, 双击, 快速滑动. 第二个类能检测类似于地图所用的双指缩放手势, 以及图片的放大手势等.</p>
<p>类似这样的效果:</p>
<p><img src="http://szysky.com/2016/09/26/%E3%80%8AAndroid-%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B04-%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C-Service/rotate.gif" alt="img"></p>
<p>代码就不贴了, 有兴趣<a href="http://szysky.com/2016/09/26/%E3%80%8AAndroid-%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B04-%E7%95%8C%E9%9D%A2%E6%93%8D%E4%BD%9C-Service/" target="_blank" rel="external">类链接地址</a></p>
<h3 id="OpenGL-ES"><a href="#OpenGL-ES" class="headerlink" title="OpenGL ES"></a>OpenGL ES</h3><p>虽然可以使用SDK提供的部件, 或者使用自定义的视图来构建大部分的Android应用, 但有时需要更底层和更高性能的图形API. 主要用于游戏. <code>OpenGL ES</code>(嵌入式子系统)很适合. Android系统最高支持<code>OpenGL ES 3.0版本</code>主要取决于硬件和android版本. <code>Android 4.3</code>支持最新的3.0标准.</p>
<p>Android已经在标准UI框架中使用<code>OpenGL ES 2.0</code>来启动硬件加速, 但是并没有对开发者开放. 而3.0完全向后兼容2.0的. 所以如果使用3.0可以放心使用.</p>
<p>如果想要了解<code>Android上的OpenGl</code>, 可以在官网,这里跳转<a href="https://developer.android.com/guide/topics/graphics/opengl.html" target="_blank" rel="external">到Google介绍openGL</a></p>
<h2 id="重识Service"><a href="#重识Service" class="headerlink" title="重识Service"></a>重识Service</h2><h3 id="何时并如何使用Service"><a href="#何时并如何使用Service" class="headerlink" title="何时并如何使用Service"></a>何时并如何使用Service</h3><p><code>Android</code>文档关于<code>Service</code>组件的描述如下:</p>
<blockquote>
<p>Service组件表示在不影响用户的情况下执行耗时的操作或者提供给其他应用使用的功能.</p>
</blockquote>
<p>即使使用<code>Service</code>还是需要把耗时的任务放到一个独立的线程中, 那为什么还有服务的出现?</p>
<p>因为<code>Service</code>和<code>Activity</code>有着不同的生命周期, 对比起来<code>Service</code>更适合管理耗时的操作.</p>
<p>那么耗时操作的定义, 其实建议把所有和用户界面无关的操作都放到后台线程去执行. 因为UI线程需要保持高度响应来与用户进行交互. 所以应尽可能排除掉一切可以不影响用户界面响应速度的操作.</p>
<h3 id="Service类型"><a href="#Service类型" class="headerlink" title="Service类型"></a>Service类型</h3><ol>
<li><strong>用来执行和用户输入无关的操作</strong>. 例如音乐播放器能够在用户从前台退出应用的情况下还能继续播放音乐. 或者例如即时通讯应用, 在用户退出前它要一直保持运行并接收消息.</li>
<li><strong>直接由用户触发</strong> 比如照片共享应用, 用户拍完照后, 应用使用<code>Intent</code>把照片发送给<code>Service</code>(更准确地说是使用指向本地的Uri). 接下来<code>Service</code>启动并解析<code>Intent</code>里的数据, 最后在后台线程中上传该照片. 当操作完成后系统会自动停止<code>Service</code>.</li>
</ol>
<h3 id="Service的创建和销毁"><a href="#Service的创建和销毁" class="headerlink" title="Service的创建和销毁"></a>Service的创建和销毁</h3><p><code>service</code>有两个必定会调用的生命回调周期<code>onCreate()</code>和<code>onDestroy()</code></p>
<ul>
<li><code>onCreate():</code>做一些初始化例如初始化新的<code>Handler</code>对象, 获取系统服务, 注册广播, 以及执行<code>service</code>操作需要的其他初始化工作. <strong>请注意这个生命周期可是运行主线程的,如果要执行耗时操作需要使用AsyncTask,Handler等方法</strong></li>
<li><code>onDestroy():</code>所有的清理工作都应该在<code>onDestroy()</code>方法完成, 特别的, 需要停止所有已经启动的<code>HandlerThread</code>对象, 并且注销之前注册的广播. 同样, 此回调也是运行在主线程中, 所以清理工作同样放在单独线程.</li>
</ul>
<h3 id="启动Service"><a href="#启动Service" class="headerlink" title="启动Service"></a>启动Service</h3><p><code>Service</code>的启动方式有两种: 通过<code>Content.startService()</code>或者<code>Content.bindService()</code>.</p>
<p>这里先说<code>startService()</code>方法:</p>
<p>当以<strong>启动模式</strong>打开<code>Service</code>时, 参数中的<code>Intent</code>必须匹配<code>Service</code>定义的<code>intent-filter</code>. (也可以显示地使用<code>Service</code>的<code>ComponentName</code>而不再定义<code>intent-filter</code>). 该方法不提供任何对<code>Service()</code>的引用, 但它在执行基于消息的触发操作方面很有用. 该方法适合执行由用户触发并且运行时间不确定的操作, 比如上传照片或者向服务器发送状态更新. 它在为其他应用提供简单的接口方便也很有用.</p>
<p>当时用<strong>启动模式</strong>打开服务的时候, <code>Service#onStartCommand()</code>方法会被调用, 并收到发送给<code>Service</code>的<code>Intent</code>. 该方法返回一个整型常量, 用来告诉系统如何处理<code>Service</code>的重启操作. 这是<code>Service</code>比较复杂的部分, 所以最起码要记住以下三种返回值(真正返回不止3种):</p>
<ul>
<li><code>START_STICKY:</code> 代表当系统由于某些原因关闭<code>Service</code>时(通常是由于内存不足). <code>Service</code>会被重新启动. 然而当系统重新启动<code>Service</code>时, <code>onStartCommand()</code>参数中的<code>Intent</code>会被置为<code>null</code>, 请注意这一点. 使用<code>START_STICKY</code>返回值的一个典型例子就是音乐播放器.</li>
<li><code>START_NOT_STICKY:</code> 表示<code>Service</code>不会再系统关闭之后重新启动. 这在使用<code>Service</code>执行一次性操作的时候特别有用, 比如上传的东西到服务器. 如果Service在完成任务前就被系统关闭了, 它不应该再尝试重复之前的操作.</li>
<li><code>START_REDELIVER_INTENT:</code> 它和<code>START_STICKY</code>基本一样, 不过当系统重启<code>Service</code>时, <code>onStartCommand()</code>会收到<code>Service</code>被销毁之前接收到的最后一个<code>intent</code>.</li>
</ul>
<hr>
<p><strong>接着说onStartCommand()这个回调方法的一共有三个返回值:</strong></p>
<ul>
<li><code>intent:</code> 根据前面讲解返回值的时候可以看出在某些特定情况下, 该参数可能会为null.</li>
<li><code>标志位:</code> 标识本次启动请求, 可能的值为0, <code>START_FLAG_RETRY</code>, <code>START_FLAG_REDELIVERY</code>.</li>
<li><code>startId:</code> 如果多次调用<code>onStartCommand()</code>且需要安全地停止<code>Service</code>, 此参数会有用.</li>
</ul>
<h3 id="绑定Service"><a href="#绑定Service" class="headerlink" title="绑定Service"></a>绑定Service</h3><p><strong>绑定模式</strong>这是使用<code>Content.bindService()</code>. 被绑定的<code>Service</code>会一直运行, 知道所有绑定的客户端都断开后才会停止. 在同一个应用进程中绑定<code>Service</code>只需获取<code>Service</code>对象的的引用, 并调用对象相应的方法即可. 这种方式成为<code>本地binder</code>.</p>
<p>如下代码: 只贴出核心代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> *  实现一个bindService模式的, 简单演示方法被调用的服务类</div><div class="line"> */</div><div class="line">public class LocalService extends Service &#123;</div><div class="line"></div><div class="line">    public void doBackgroundOperation()&#123;</div><div class="line">        Toast.makeText(getApplicationContext(), &quot;定义服务方法被调用&quot;, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public IBinder onBind(Intent intent) &#123;</div><div class="line">        return new LocalBinder();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public class LocalBinder extends Binder&#123;</div><div class="line">        public LocalService getService()&#123;</div><div class="line">            return LocalService.this;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 在Activity中进行强转即可</div><div class="line">serviceConnection = new ServiceConnection() &#123;</div><div class="line">  @Override</div><div class="line">  public void onServiceConnected(ComponentName name, IBinder service) &#123;</div><div class="line">      mService = ((LocalService.LocalBinder)service).getService();</div><div class="line">      //  通过mService就可以调用服务的内部方法, 注意这只是在应用内部, 不可以跨进程</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  @Override</div><div class="line">  public void onServiceDisconnected(ComponentName name) &#123;</div><div class="line">      mService = null;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="保持活跃"><a href="#保持活跃" class="headerlink" title="保持活跃"></a>保持活跃</h3><p>当服务已经启动, 并且应用程序在前台运行(当前正在展示应用的某个Activity), 那么该<code>Service</code>会是最后一个被杀死. 然而一旦用户离开了发起服务的应用, 那么此服务也就不再是前台应用, 有可能会被杀死. 所以如果需要在应用不处于前台活动状态下仍然保持<code>Service</code>在前台运行, 则可以调用<code>Service.startForeground()</code>. (当应用程序更新可以使用<code>Notification</code>通知配合服务来完成)</p>
<blockquote>
<p>系统会试图尽可能长地保持<code>Service</code>处于活动和运行状态. 只有当资源耗尽, 通常是没有足够内存(RAM), 才有可能会去停止<code>Service</code>. 当是我们应该在开发中假设这种情况会随时发生.</p>
</blockquote>
<h3 id="停止服务Service"><a href="#停止服务Service" class="headerlink" title="停止服务Service"></a>停止服务Service</h3><p>一旦<code>Service</code>启动, 它会尽可能长时间运行. 根据启动方式的不同, 系统会在系统资源不足杀死<code>Service</code>后重启.</p>
<blockquote>
<p>当Service再次启动时, 可能会出现一些意想不到的结果, 所以适当的停止服务就显得很重要.</p>
</blockquote>
<ul>
<li><code>绑定模式:</code> 此模式下服务会一直运行到没有客户端连接为止. 但有一种例外情况, 即最后连接的客户端调用了<code>Service.startForeground()</code>时还会保持<code>Service</code>的运行, 所以需要在适当的时候调用<code>Service.stopForeground()</code></li>
<li><code>启动模式:</code> 只能通过<code>Service.stopSelf()</code>或者<code>Content.stopService()</code>来停止<code>Service</code>. 这标志着需要停止和移除<code>service</code>. 而重新启动<code>Service</code>的唯一方式是显示调用<code>Content.startService()</code>或者<code>Content.bindService()</code>. 注意, 当通过<code>startService()</code>启动服务时, 不管调用多少次<code>onStartCommand()</code>(即调用<code>Content.startService()</code>不会叠加), 调用<code>Service.stopSelf()</code>或者<code>Content.stopSelf()</code>一定会停止服务.</li>
</ul>
<h3 id="后台运行的IntentService"><a href="#后台运行的IntentService" class="headerlink" title="后台运行的IntentService"></a>后台运行的IntentService</h3><p>普通的服务的生命周期回调都是触发在<strong>主线程上</strong>. 如果需要处理耗时操作那么需要把耗时操作移动到一个单独的线程中.</p>
<p><strong>IntentService</strong></p>
<p>由于<code>Handler</code>在android中的处理消息的便利, 和<code>Service</code>分离与UI线程无关的代码. 所以google提供了一个名为<code>IntentService</code>的工具类, 它在<code>Service</code>中包装了一个处理后台线程的<code>Handler</code>. 开发者只需要继承该类, 实现<code>onHandlerIntent()</code>方法, 并添加希望<code>Service</code>能够接收的action.</p>
<p><code>onHandlerIntent()</code>方法运行在自己线程, 并不一定是主线程. 并且每次只能处理一个<code>Intent</code>,当处理结束之后服务也就自动关闭. 可以通过不同的<code>action</code>组装成intent, 也可以给<code>intent</code>附加信息, 用以在服务中区分不同的动作请求. 当多次通过<code>startService()</code>调用服务的时候, 每次调用的<code>Intent</code>会被保存到队列中, 所以该类能确保任意时间只会有一个<code>intent</code>会被处理. 知道队列为空, 那么服务也就随之消失.</p>
<hr>
<p><strong>并行问题</strong></p>
<p><code>IntentService</code>虽然方便好用, 并且能够顺序处理同一时间内的多个请求. 但是正因为是<strong>串行的处理模式</strong>, 可能我们有的时候更需要并行更快的处理完成.如果是这样, 那我们就使用线程池来处理. 可以在<code>AsyncTask</code>中使用<code>Executor</code>并行地执行操作. 但是<code>AsyncTask</code>的特点是比较适合执行运行时间至多几面的操作, 如果要执行比较耗时的操作. 可以使用<code>ExecutorService</code>使用<code>Executors.newCacheThreadPool()</code>.</p>
<h3 id="对Service的通信"><a href="#对Service的通信" class="headerlink" title="对Service的通信"></a>对Service的通信</h3><p>前面记录了何时使用, 如何执行. 那么接下来接说一下对服务的通信. 一般有两种:</p>
<ul>
<li><code>Content.StartService()</code>会把<code>Intent</code>分发给<code>Service.onStartCommand()</code>方法,可以在该方法中触发后台操作, 然后通过广播或者其他方式再把结果分发给调用组件.</li>
<li><code>Content.bindService()</code>方法可以获得<code>Binder</code>对象, 使用它可以直接调用<code>Service</code>对象.</li>
</ul>
<hr>
<p><strong>使用Intent进行异步消息的传递</strong></p>
<p>如果想要知道服务中处理的结果, 只需要采用发送广播的进行通知调用者即可.</p>
<p>总结一下这种的优缺点:</p>
<ul>
<li><strong>优点:</strong> Android提供了线程的机制, 而不需要开发者自己构建复杂的组件间消息处理系统. 开发者只需要声明表示异步消息的<code>action</code>. 并在响应的组件中注册这些广播. 即便<code>Service</code>属于其他应用或者运行在一个单独的进程中, 该方法同样有效.</li>
<li><strong>缺点:</strong> 通知的结果受限于<code>Intent</code>. 此外这种方式不适合在<code>IntentService</code>和<code>Activity</code>之间进行大规模快速更新的操作, 比如更新进度条, 因为这会阻塞系统. 如果确定需要实现此功能那么可以使用<code>bindService</code>.</li>
</ul>
<hr>
<p><strong>本地绑定的Service进行的交互</strong></p>
<p>当<code>Service</code>提供的接口太过复杂, 很难用<code>Intent</code>消息机制解决, 而普通的<code>Java</code>方法又可以很好的解决这个问题; 另一个使用绑定本地<code>Service</code>的原因是可以在<code>Service</code>中给Activity提供更为复杂的回调. 因为那些耗时的操作必须放到<code>Service</code>的后台线程, 所以<code>Service</code>的大部分回调应该是异步的. 实际的调用触发后台操作立即返回, 一旦操作完成, <code>Service</code>使用回调接口来通知<code>Activity</code>响应的执行结果.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap4_手势操作进阶, 重识Service/" data-id="cj7g7uqlr000616pjj48lo4s5" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap4_手势操作进阶, 重识Service/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android/books/《Android 编程实战》Chap3_组件 清单 资源和UI闲聊" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/11/android/books/《Android 编程实战》Chap3_组件 清单 资源和UI闲聊/">《Android 编程实战》Chap3_组件 清单 资源和UI闲聊</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/11/android/books/《Android 编程实战》Chap3_组件 清单 资源和UI闲聊/">
            <time datetime="2017-09-11T13:36:06.000Z" itemprop="datePublished">2017-09-11</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>阅读《Android 编程实战》一书的随记笔记<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h2 id="应用程序清单"><a href="#应用程序清单" class="headerlink" title="应用程序清单"></a>应用程序清单</h2><blockquote>
<p><code>AndroidManifest</code>是一个定义各种组件以及应用程序各个方向的XML文件. 该清单是所有<code>Android</code>的核心.</p>
</blockquote>
<h3 id="manifest元素"><a href="#manifest元素" class="headerlink" title="manifest元素"></a>manifest元素</h3><p><code>AndroidManifest.xml</code>文件的根节点元素是<code>manifest</code>. 应用程序的<strong>包名</strong>和<strong>唯一识别符</strong>都定义在该节点. 还可以在该节点中定义<code>Linux用户ID</code>和<code>名称(应用程序将运行在该ID下)</code>. 应用的版本, APK的安装位置.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    package=&quot;com.test.printertestdemo&quot;</div><div class="line">    android:sharedUserId=&quot;com.szysky.userid&quot;</div><div class="line">    android:sharedUserLabel=&quot;@string/user_name&quot;</div><div class="line">    android:installLocation=&quot;auto&quot;</div><div class="line">    android:versionCode=&quot;6&quot;</div><div class="line">    android:versionName=&quot;2.0&quot; &gt;</div><div class="line">    </div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<p>这是一个比较完整的配置. <code>sharedUserId</code>和<code>sharedUserLabel</code>是Linux用户ID和名称. 应用程序将会运行在上面. 默认情况下, 这些都是系统分配的. 如果为使用证书发布的多个应用设置同样的值时, 开发者就可以访问相同的数据, 并有可能可以共享这些应用的进程(下面说道).</p>
<p>多个应用共享同一个进程可以节省应用程序使用的<code>RAM</code>总量. 但当其中一个应用出现运行时错误, 那所有共享相同进程的其他应用也会崩溃.</p>
<p>使用<code>installLocation</code>属性来控制应用程序的安装位置. 即可以在设备的内部存储器(data分区)安装应用程序, 也可以在外部存储装置(SD卡)安装. 需要注意: 只能通过这个属性控制APK的<strong>安装位置</strong>. 应用程序数据仍然安全地存储在内部存储器中.</p>
<h3 id="user-feature"><a href="#user-feature" class="headerlink" title="user-feature"></a>user-feature</h3><p>这个属性元素<code>&lt;user-feature&gt;</code>可以让<code>Google Play</code>去过滤应用在哪台设备可见. 比如应用需要一个打电话的功能, 但是当前设备只支持wifi的平板电脑. 或者说一个Android电视是不支持触屏控制, 但是应用需要这个硬件特性的支持. 就可以通过这个属性设置.</p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;user-feature android:name=&quot;android.hardware.microphone&quot;&gt;</div><div class="line">&lt;!--需要电话功能支持--&gt;</div><div class="line">&lt;user-feature android:name=&quot;android.hardware.telephony&quot;&gt; </div><div class="line">&lt;!--支持多点触控的触摸屏--&gt;</div><div class="line">&lt;user-feature android:name=&quot;android.hardware.touchscreen.multitouch.jazzhand&quot;&gt;</div></pre></td></tr></table></figure>
<h3 id="application"><a href="#application" class="headerlink" title="application"></a>application</h3><p>使用自定义的<code>Application</code>必须要做的就是在清单文件中指定<code>&lt;application&gt;</code>中的<code>name</code>属性到自定义的application.</p>
<p>列举一下属性:</p>
<ul>
<li><code>label</code>, <code>description</code>: 可以让用户在设置页面中看到关于应用的更多详细的描述.</li>
<li><code>android:backupAgent</code>: 这是<code>Google</code>提供的一个备份服务, 需要实现自己的<strong>备份代理</strong>的类,并使用此属性指向此类.</li>
<li><code>android:largeHeap</code>: 可以让系统知道需要更多的内存. 但是, 除非特别需要, 否则不要这么做. 因为这样做会浪费系统资源,而且<strong>系统会更快的终止应用程序</strong>.</li>
<li><code>android:process</code>: 当多应用程序共享一个用户ID, 并且<code>process</code>属性设置为一个值的时候, 可以<strong>强制这些应用共享同一个进程</strong>. (所以如果需要使多应用使用一个进程, 那么所有的应用必须共享同一个用户ID并同一个证书签名和相同的process)</li>
<li><code>android:theme</code>: 属相设置整个应用的主题.</li>
</ul>
<h3 id="组件元素和属性"><a href="#组件元素和属性" class="headerlink" title="组件元素和属性"></a>组件元素和属性</h3><p>每个标准组件(<code>activity</code>, <code>service</code>, <code>broadcastReceiver</code>, <code>contentProvider</code>)在清单文件都有自己的节点元素, <code>AS</code>创建的默认属性通常能满足大部分情况. 下面看一下其他的属相把</p>
<hr>
<p><strong>android:enabled = “false”</strong></p>
<p>我们所定义的所有组件默认都是<strong>可用的</strong>. 当把enable设置为false的时候, 可以修改默认行为, 这将阻止组件接收<code>Intent</code>.</p>
<ul>
<li>禁用的<code>Activity</code>不会显示在应用程序启动器中;</li>
<li>禁用的<code>Service</code>不会响应<code>startService()</code>调用;</li>
<li>禁用的<code>BroadcastReceiver</code>不会监听<code>BroadcastIntent</code>;</li>
<li>禁用的<code>ContentProvider</code>不会响应<code>ContentResolver</code>.</li>
</ul>
<p>代码中同样可以设置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">PackageManager pm = getPackageManager();</div><div class="line">		</div><div class="line">// 启用一个activity</div><div class="line">pm.setComponentEnabledSetting(new ComponentName(this, MainActivity.class),</div><div class="line">		PackageManager.COMPONENT_ENABLED_STATE_ENABLED,</div><div class="line">		PackageManager.DONT_KILL_APP);</div><div class="line">	</div><div class="line">// 禁用一个activity</div><div class="line">pm.setComponentEnabledSetting(new ComponentName(this, MainActivity.class),</div><div class="line">		PackageManager.COMPONENT_ENABLED_STATE_DISABLED,</div><div class="line">		PackageManager.DONT_KILL_APP);</div></pre></td></tr></table></figure>
<hr>
<p>有时候出于安全的原因, 我们不希望把某个组件暴露给系统的其他应用使用, 这时可以通过<code>android:exported=&quot;false&quot;</code>, 这会有效地把对外可被调用属性关闭.</p>
<hr>
<p>如果你想设置一个组件供其他应用使用, 但又想提供某个安全级别, 则可以<strong>定义权限</strong>, 要做到这一点, 那么调用者应该在清单文件中添加使用权限(user-permission), 然后在提供者应用注册一个权限(permission).</p>
<h3 id="Intent过滤"><a href="#Intent过滤" class="headerlink" title="Intent过滤"></a>Intent过滤</h3><p>在<code>Android</code>中所有的组件都是通过<code>Intent</code>访问的, <code>Intent</code>抽象地描述了要执行的动作. <code>Intent</code>会被发送给<code>Activity</code>, <code>Service</code>, <code>BroadcastReceiver</code>. 一旦发送, <code>Android系统</code>的Intent将决定将Intent分发给哪个组件.</p>
<ol>
<li><code>Intent</code>要确认的第一件事情就是分辨出<strong>隐式</strong>还是<strong>显示</strong>. <code>显示Intent</code>包含有关包和组件的名称信息, 他们可以立即分发, 因为只能匹配到一个组件. 此方法通常应用于程序内部的通信. <code>隐式Intent</code>的取决于三个因素: <strong>action</strong>, <strong>数据的URI和类型</strong>, <strong>以及类别</strong>. 注意: <strong>extras和flags对Intent区分没有影响</strong></li>
<li><code>action</code>是最主要的, 通常也是唯一应该重点关注的. Android有许多预定义的action, 开发者也可以定义自己的action. 开发者定义自己的action时, 通常在前面加上自己的包名, 这样不同应用之间action定义的冲突也就基本不存在了.</li>
<li><code>data</code>并没有实际的数据, 只是包含了<code>URI</code>和<code>MIME</code>类型, 使用<code>Activity</code>打开只包含特定类型文件会非常有用.</li>
<li><code>category和Activity最相关</code>. 所有通过<code>startActivity()</code>发送的隐式Intent都至少定义了一个<code>category(android.intent.category,DEFAULT)</code>, 所以除非Activity的<code>Intent-filter</code>也包含这个<code>category</code>. 否则就不会通过<code>Intent</code>的匹配. 比较例外的是图标启动器的<code>intent-filter</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;activity</div><div class="line">  android:name=&quot;.PrinterTestDemoAct&quot;</div><div class="line">  android:label=&quot;@string/app_name&quot;&gt;</div><div class="line">  &lt;intent-filter&gt;</div><div class="line">      &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">      &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">  &lt;/intent-filter&gt;</div><div class="line">  </div><div class="line">  &lt;intent-filter&gt;</div><div class="line">      &lt;action android:name=&quot;android.intent.action.VIEW&quot;/&gt;</div><div class="line">      &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;/&gt;</div><div class="line">      &lt;data android:mimeType=&quot;video/*&quot;/&gt;</div><div class="line">  &lt;/intent-filter&gt;</div><div class="line">&lt;/activity&gt;</div></pre></td></tr></table></figure>
<p>如上清单配置: 有两个<code>intent-filter</code>, 第一个是用于桌面图标启动应用; 第二个是用于打开video开头的<code>MIME</code>类型文件.</p>
<p>第一个<code>intent-filter</code>不需要<code>category.DEFAULT</code>. 因为它将由启动器程序管理.<br>第二个<code>intent-filter</code>是我们经常使用<code>startActivity()</code>方法会匹配到的, 所以其中的<code>category</code>应该设置<code>default</code>, 无论被打开视频文件是本地还是网络, 只要<code>MIME</code>类型以<code>Video</code>开头就行.</p>
<h2 id="resources-和-assets"><a href="#resources-和-assets" class="headerlink" title="resources 和 assets"></a>resources 和 assets</h2><p>开发中除了实现业务逻辑的代码, 还有就是一些像<code>XML布局</code>,<code>图标</code>,<code>文本值</code>等这样的内容, 这些静态内容存储在APK文件的<code>resources</code>或者<code>assets</code>目录中. 所有的组员都属于一个特定的类型(比如layout, drawable等), 而<code>assets</code>是简单地存储在应用内的通用文件. 大多数非代码的内容都以资源的形式呈现, 因为他们紧密集成在Android API中.</p>
<p>从开发的角度来看, Android中的资源特性是平台最强大的功能之一, 它允许开发者根据<strong>屏幕尺寸</strong>, <strong>定位参数</strong>, <strong>设备能力</strong>等来提供多个版本的资源. 最常见的解决方案是通过在不同的文件中提供多个版本的文本字符串来支持多语言, 或者通过提供不同的布局文件和不同大小的图标来支持各种屏幕的尺寸.</p>
<hr>
<p><strong>在应用中定义资源要遵循的几个规则</strong></p>
<ol>
<li>一定要在应用中为每种类型的资源都提供一个默认值, 就是在没有任何限定符的资源目录中提供默认的图片, 图标, 文本字符串和布局. 确保当所有特定资源文件都无法匹配设备, 可以加载默认的资源而不会出现崩溃.</li>
<li>避免硬编码, 例如字符串和值. 虽然可能会需要做一些额外工作也不算太累, 相比与之后当需要改变整个应用中的所有字体, 外边距, 内边距, 增加字符串本地化的时候. 修改起来这简直就是轻而易举的简单.</li>
<li>通过提供<strong>限定符</strong>来过滤资源. 例如, 如果想为高密度像素的设备提供一套高分辨率的图标, 可以通过<code>drawable-xxxhdpi</code>目录内存储</li>
</ol>
<hr>
<h3 id="高级String资源"><a href="#高级String资源" class="headerlink" title="高级String资源"></a>高级String资源</h3><p>通常, 应用中的所有字符串都应该放在<code>string</code>资源中. 这样比在java代码中相比, 可以消除一下问题, 特别是当涉及格式化字符串和本地化时.</p>
<p>比如: 在<code>string.xml</code>声明</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;string name=&quot;personal_message&quot;&gt;Hi %s !&lt;/string&gt;</div><div class="line"></div><div class="line">&lt;string-array name=&quot;default_categories&quot;&gt;</div><div class="line">   &lt;item&gt;Work!&lt;/item&gt;</div><div class="line">   &lt;item&gt;personal&lt;/item&gt;</div><div class="line">&lt;/string-array&gt;</div></pre></td></tr></table></figure>
<p>在java中使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String oneStr = getString(R.string.personal_message, &quot;suzeyu&quot;);</div><div class="line">		String[] stringArray = getResources().getStringArray(R.array.default_categories);</div></pre></td></tr></table></figure>
<p>第一个在获取string资源的时候, 传入了一个字符串参数, 并在<code>%s</code>处进行插入处理.</p>
<h3 id="本地化"><a href="#本地化" class="headerlink" title="本地化"></a>本地化</h3><p>要做到本地化的支持, 把默认字符串资源复制到一个适当语言和地区限定符的新目录中, 然后开始翻译文本.</p>
<p>如果要翻译一种语言的资源文件到另一种语言, 你可以通过使用<strong>谷歌翻译工具Google Translator ToolKit</strong>, 这是谷歌的一个服务, 允许上传一个文件, 然后将字符串自动翻译为指定的语言.</p>
<h3 id="使用assets"><a href="#使用assets" class="headerlink" title="使用assets"></a>使用assets</h3><p>如果有一些较大的资源文件可以考虑放到<code>assets</code>和<code>raw</code>目录下.</p>
<p>考虑这样一种场景, 如果有一个游戏有许多的音效, 那么就可以在<code>assets</code>文件夹内创建一个<code>soundfx</code>目录, 接下来把所有的音频文件都放入此子目录中. (<code>assets</code>目录支持子文件夹)</p>
<p>如下代码显示了如何使用<code>SoundPool</code>和<code>AssetManager</code>来加载<code>assets/soundfx</code>目录内的所有音频文件. 并且最后关闭打开的文件, 防止内存泄漏.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public HashMap&lt;String, Integer&gt; loadSoundEffects(SoundPool soundPool) throws IOException&#123;</div><div class="line">		// 获取assets资源管理者</div><div class="line">		AssetManager assets = getAssets();</div><div class="line">		String[] soundEffectFiles = assets.list(&quot;soundfx&quot;);</div><div class="line">		HashMap&lt;String, Integer&gt; soundEffectMap = new HashMap&lt;String, Integer&gt;();</div><div class="line"></div><div class="line">		for (String soundEffectFile: soundEffectFiles) &#123;</div><div class="line">			AssetFileDescriptor fileDescriptor = assets.openFd(&quot;soundfx/&quot; + soundEffectFile);</div><div class="line">			int id = soundPool.load(fileDescriptor, 1);</div><div class="line">			soundEffectMap.put(soundEffectFile, id);</div><div class="line">			</div><div class="line">			fileDescriptor.close();</div><div class="line">		&#125;</div><div class="line">		return soundEffectMap;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h2 id="UI的一些小知识"><a href="#UI的一些小知识" class="headerlink" title="UI的一些小知识"></a>UI的一些小知识</h2><h3 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h3><p><strong>字体:</strong>人脑利用图像识别来分辨不同的字母汉字, 所以逻辑上来说, 应该使用很容易辨认的字体, 而高度装饰字体只适用于标识(logo)等其他场合.</p>
<hr>
<p><strong>文本布局:</strong>例如报纸中的布局分成若干个专栏, 人们更偏向于稍微适中, 比较短的文本阅读. 所以切记不要让你的文本布局显示一行很长很长的文字. 尽量可以保持一行在<code>45~72</code>个字符.</p>
<hr>
<p><strong>android中的大小单位</strong></p>
<ul>
<li><code>dp</code> (density-independent) 控制控件大小</li>
<li><code>sp</code> 基于dp产生, 主要用于文字大小</li>
<li><code>pt</code> (points, 磅)</li>
<li><code>px</code> (pixel, 像素)</li>
<li><code>mm</code> (millimeter, 毫米)</li>
<li><code>in</code> (inch, 英寸)</li>
</ul>
<hr>
<p><strong>推荐尺寸:</strong>一个按钮一个比较好的大小值为<code>48dp</code>转换之后相当于9毫米, 这个尺寸可以让用户手指在触摸屏上轻松的交互.</p>
<hr>
<p><strong>图标大小:</strong>针对之前说的<code>48dp</code>,当不同分辨密度下相对应的为 48像素(MDPI), 72像素(HDPI), 96像素(XHDPI), 以及144像素(XXHDPI). 这就是所谓的2:3:4:6. 对应的DPI分别指~160, ~240, ~320, ~480.</p>
<p>如果将位图作为图标使用, 那么就应该使用dp而不是像素为单位. 一个正常的图标, 如主屏幕上的启动图标, 应该为<code>48dp*48dp</code>, 而操作栏(action bar)的图标为<code>32dp*32dp</code>, 通知栏的图标<code>24dp*24dp</code></p>
<hr>
<p><strong>字体的大小:</strong>谷歌创建的<code>Roboto</code>字体被用于所有标准的Android程序. 不同的字体的尺寸即使一样, 实际看起来可能也会不同, 主要是因为他们的<code>x-height</code>不同, <code>x-height</code>即为当前字体小写字母x的高度. 经常使用的<code>x-height</code>较大的字体有<code>Arial</code>和<code>Verdana</code></p>
<p>谷歌为Android字体定义了四个标准大小:</p>
<ul>
<li><code>micro</code> 极小, 12sp</li>
<li><code>small</code> 小, 14sp</li>
<li><code>medium</code> 中, 18sp</li>
<li><code>large</code> 大, 22sp</li>
</ul>
<hr>
<p><strong>典型透视:</strong>当我们需要凭借记忆画一个物体时, 大多数人会从一个略高于它的角度来描述它, 这就叫做<strong>典型透视</strong>.</p>
<p><strong>人脸识别:</strong>人类擅长人脸识别, 许多人可以轻松地从一堆人中挑选出自己的朋友. 实际上相对于识别物体, 我们能更快识别人脸. 此外, 我们对文字的理解远远慢于识别人脸.</p>
<hr>
<p>不要让用户思考! 用户不应该花大量时间来研究如何使用应用程序. 开发者应该让第一次看到应用程序UI的用户无需置疑下一步该如何操作;</p>
<p><strong>视觉线索</strong>是指一个物体向用户发出的如何与之交互的信息. 人们对文字的理解慢于对简单图标的理解.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap3_组件 清单 资源和UI闲聊/" data-id="cj7g7uql9000316pjn6qp7fqi" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap3_组件 清单 资源和UI闲聊/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android/books/《Android 编程实战》Chap2_Android上编写高效Java" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/11/android/books/《Android 编程实战》Chap2_Android上编写高效Java/">《Android 编程实战》Chap2_Android上编写高效Java</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/11/android/books/《Android 编程实战》Chap2_Android上编写高效Java/">
            <time datetime="2017-09-11T13:35:09.000Z" itemprop="datePublished">2017-09-11</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>阅读《Android 编程实战》一书的随记笔记<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h2 id="Dalvik-Java和Java-SE"><a href="#Dalvik-Java和Java-SE" class="headerlink" title="Dalvik Java和Java SE"></a>Dalvik Java和Java SE</h2><p>在<code>Android</code>设备上运行的<code>VM</code>成为<code>Dalvik</code>. 适用于CPU和内存受限的移动设备. <code>Java SE</code>和<code>Dalvik Java</code>存在一些差异, 这些差异主要体现在虚拟机上.</p>
<ul>
<li><code>Java SE</code>: 使用了栈机设计</li>
<li><code>Dalvik</code>: 使用了基于寄存器的机器的设计</li>
</ul>
<p><code>Android SDK</code>中个有一个<code>dx</code>工具, 它会把<code>Java SE</code>栈机器的字节码转换成基于寄存器的<code>Dalvik</code>机器字节码, 这个步骤平时是由<code>AS</code>自动完成的.</p>
<p>虽然基于寄存器的虚拟机最多可以比基于栈的虚拟机快32%, 但这只限于执行解释代码的虚拟机. 在<code>Android 2.2</code>之前, <code>Dalvik</code>虚拟机都是纯解释性的. 之后才引入了<code>JIT</code>编译器.</p>
<p><strong>JIT编译</strong></p>
<p>也称<code>即时编译或者动态编译</code>. 它在执行前把字节码翻译成本地代码, 这样的两个好处:</p>
<ul>
<li>消除了那些纯解释性虚拟机的开销</li>
<li>它能对本机代码执行优化, 这通常是静态编译代码无法做到的.</li>
</ul>
<p>另一个区别是: <code>Dalvik</code>在开机时会启动一个<code>zygote</code>的进程, 该进程会创建第一个<code>Dalvik</code>实例, 由这个实例创建所有其他的实例. 当应用程序启动的时候, <code>zygote</code>进行会收到一个创建新虚拟机实例的请求, 并给该应用程序创建一个新进程.</p>
<hr>
<p>对于两个方向的API也不是一模一样, 比方说<code>Android</code>移除了<code>Java SE</code>中<code>Swing/AWT</code>包. 因为<code>Android</code>有自己的UI框架. 还有一些例如<code>RMI</code>, <code>CORBA</code>,<code>JMX</code>等.</p>
<h2 id="优化Android上的Java代码"><a href="#优化Android上的Java代码" class="headerlink" title="优化Android上的Java代码"></a>优化Android上的Java代码</h2><p><strong>1.更安全的队列</strong></p>
<p>例如如果需要实现一个<strong>生产者/消费者</strong>模式, 关于所使用的管理存储的集合可能需要选择队列(<code>LinkedList</code>)并且具体的存取操作要套上<code>synchronize</code>防止并发问题. 但是如果通过<code>LinkedBlockingQueue</code>就可以实现上面的手动编写的步骤. 对于做同样的事情但是更快的实现方法,我们没有例如不去使用</p>
<p>其实在<code>JDK1.5</code>之后, 提供了<code>java.util.concurrent</code>包, 这个包不仅有相关的类, 此外还包含信号量, 锁, 以及对单个变量进行原子操作的类.</p>
<hr>
<p><strong>2.更好的锁</strong></p>
<p>对于Java提供的<code>synchronize</code>关键字允许创建线程安全的代码块和方法. <code>synchronize</code>关键字虽然便于使用, 但也很容易滥用, 对性能造成损耗. 当需要区分读数据和写数据时, <code>synchronize</code>也不是最有效的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">public class ReadWriteLockDemo &#123;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 控制读写操作并发的锁</div><div class="line">     */</div><div class="line">    private final ReentrantReadWriteLock mLock ;</div><div class="line">    private String mName;</div><div class="line"></div><div class="line">    public ReadWriteLockDemo()&#123;</div><div class="line">        mLock = new ReentrantReadWriteLock();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public void setPersonData(String name)&#123;</div><div class="line">        // 获取写操作的锁</div><div class="line">        ReentrantReadWriteLock.WriteLock writeLock = mLock.writeLock();</div><div class="line">        </div><div class="line">        try &#123;</div><div class="line">            //  获取 写锁使用权, 其余线程需要操作只有在写锁被关闭才可以</div><div class="line">            writeLock.lock();</div><div class="line">            mName = name;    </div><div class="line">        &#125;finally &#123;</div><div class="line">            //  释放 写锁使用权 </div><div class="line">            writeLock.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public String getName()&#123;</div><div class="line">        ReentrantReadWriteLock.ReadLock readLock = mLock.readLock();</div><div class="line">        </div><div class="line">        try &#123;</div><div class="line">            readLock.lock();</div><div class="line">            return mName;</div><div class="line">        &#125;finally &#123;</div><div class="line">            readLock.unlock();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    // 省略其余实现</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码允许多个并发线程对数据进行只读方法, 并确保同一时间只有一个线程写入数据.</p>
<h2 id="管理和分配内存"><a href="#管理和分配内存" class="headerlink" title="管理和分配内存"></a>管理和分配内存</h2><p>Java的自动内存管理有效消除了开发过程中的许多问题. 不再需要记住为每个创建的对象进行手动释放对象内存. 当时同时也需要付出一定的性能代价. <strong>自动垃圾收集器会和程序并行运行. 垃圾回收器会一直运行, 并检查是否有可以回收的内存. 这种行为意味着应用程序进程会和垃圾收集器竞争CPU时间,即使垃圾回收器不会运行太长时间,但是也是一种性能损失. 虽然我们不能抛弃这中垃圾收集方式, 但是可以有效的控制, 例如:</strong></p>
<p><strong>减少对象分配</strong></p>
<p>如果可以不要在循环内部创建对象, 在循环的外部创建对象, 并复用此对象. 减少对象的生成造成的空间开辟, 和无用对象的回收.</p>
<h2 id="Android中的多线程"><a href="#Android中的多线程" class="headerlink" title="Android中的多线程"></a>Android中的多线程</h2><p>确保不再<code>UI线程</code>做耗时操作, 这基本已经印在<code>Android</code>开发的脑袋里了. 那么如何知道一个方法是否在主线程执行? <code>Android</code>文档指出, <strong>默认情况下, 应用的所有组件都运行在同一个进程和线程中(主线程)</strong>. 更确切点的说三个组件(<code>Activity</code>, <code>Service</code>, <code>Broadcast</code>, <code>Application</code>)的所有回调基本上所有的<code>onXXXX()</code>这种命名的方法都是运行在主线程的.</p>
<hr>
<p><strong>那么什么样的代码在主线程执行才是安全的?</strong></p>
<p>只有那些必须在主线程执行的方法才能放在主线程中. 其他一切操作都应该放在另一个单独的线程中执行. 实际情况下, 那些不会耗时的操作也可以放在主线程中. 如何能确保在另一个单独的线程中执行文件, 数据库或者网络操作, 通常主线程会是安全的. 当然也要确保同一时间不会运行太多线程, 原因是<code>CPU</code>切换线程也会造成性能损失.</p>
<h3 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h3><p><code>Thread</code>类是<code>Android</code>中所有线程的基类, <code>Java SE</code>中也包含它. 如果要在线程中执行代码, 即可以创建一个继承, 也可以把实现<code>Runnable</code>接口的类对象传给<code>Thread</code>的构造函数.</p>
<p>对于这个基础的类, 尽量能不用就不用. 除非配合缓冲池, 不然频繁的创建新的线程开销很大.</p>
<h3 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h3><p>这是<code>Android</code>中比较流行的一种, 因为使用简单,并且允许定义一个运行在单独线程中的任务, 并且提供了不同阶段的回调, 如<code>doInBackground()</code>会被回调在单独的线程. 而其余的三个回调都是被回调在主线程. 这都是为了让开发者可以把代码编写的重点放在实现的功能上, 而不是考虑是否应该避免系统级的问题发生.</p>
<p>使用<code>AsyncTask</code>创建的实例只能使用一次, 这也就意味着每次执行操作都新建一个实例对象. 虽然是个轻量级的类(实际的线程是由<code>ExecutorService</code>管理的), <strong>但是不适合那些频繁的操作</strong>, 因为这会快速聚集需要垃圾回收的对象, 并最终导致应用程序的卡顿.</p>
<p>并且, <code>AsyncTask</code>不能对操作设置执行时间, 也无法间隔一段时间去执行操作. 它适合文件下载, 以及不会频繁发生或通过用户交互等类似情况的操作. 但是使用简单嘛.</p>
<h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><p>当需要更细粒度地控制一个单独的线程中执行操作的时候, <code>Handler</code>类会是一个很有用的工具. 该类允许准确地控制操作的执行时间. 还可以重复多次的使用. 执行操作的线程会一直运行, 直到被显示地终止. <code>Loop</code>会处理幕后的事情, 但是作为开发人员却很少和其打交道.</p>
<p>使用<code>Handler</code>类最常见的方式是发送<code>Message</code>. 当向后台线程传递数据和参数时, 这些消息对象简单,易于创建, 并且可以重用. <code>Message</code>对象通常是由它的共有整型成员变量<code>what</code>定义的. 还有两个名为<code>arg1和arg2</code>的整型成员变量, 他们用于创建低开销的的参数, 以及<code>obj</code>成员变量(可以存储任意单个对象的引用). 如果你需要存储更复杂的数据那么通过<code>setData(Bundle)</code>方法设置更复杂的数据.</p>
<hr>
<p><strong>发送消息</strong></p>
<p>既可以使用<code>Message#sendToTarget()</code>也可以使用<code>Handler#sendXXX()</code>等方法. 如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// 创建一个带有data参数的Message, 然后立刻把它发送到handler执行</div><div class="line">Message.obtain(mHandler, FLAG_SYNC_DATA, data).sendToTarget();</div><div class="line"></div><div class="line">// 立刻给handler发送一个空消息</div><div class="line">mHandler.sendEmptyMessage(FLAG_SYNC_DATA);</div><div class="line"></div><div class="line">// 给handler发送一个空消息, 在30秒后执行</div><div class="line">mHandler.sendEmptyMessageAtTime(FLAG_SYNC_DATA, 30 * 1000);</div><div class="line"></div><div class="line">// 给handler发送带有arguments和obj参数的消息, 并在10秒后执行</div><div class="line">Message msg = mHandler.obtainMessage(FLAG_SYNC_DATA, 参数1, 参数2, data);</div><div class="line">mHandler.sendMessageDelayed(msg, 10 * 1000);</div></pre></td></tr></table></figure>
<hr>
<p>在创建<code>Handler</code>的时候构造函数传入<code>Looper</code>对象可以为<code>Handler</code>分配线程, 所以可以创建一个主线程消息的<code>Handler</code>, 避免使用<code>runOnUiThread()</code>这种丑陋缩进的代码并且还低效.</p>
<p>只要确保把消息发送给正确的<code>handler</code>即可.</p>
<h3 id="选择合适的线程"><a href="#选择合适的线程" class="headerlink" title="选择合适的线程"></a>选择合适的线程</h3><p>之前说过了三种在<code>Android</code>上创建和使用线程的方式, <code>API</code>中和线程相关的类还有<code>ExecutorService</code>和<code>Loader</code>.</p>
<ul>
<li><code>ExecutorService</code>适合处理并行运行的多个任务, 这个非常适合编写相应多客户端的服务器应用. <code>AsyncTask</code>内部同样使用了<code>ExecutorService</code>处理多线程</li>
</ul>
<p>三种中尽量少的直接使用<code>Thread</code>类, 大多数情况下推荐使用<code>AsyncTask</code>和<code>Handler</code>类, 具体使用哪一个取决于具体的需求. 如果不是很频繁地执行操作, 比如超过每分钟一次, 那么<code>AsyncTask</code>是个选择的对象. 如果需要安排操作时间或者需要快速间隔地执行操作, <code>Handler</code>是个更好的选择. 从长远的角度来看, <code>Handler</code>生成的代码较少, 而<code>AsyncTask</code>更容易使用.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap2_Android上编写高效Java/" data-id="cj7g7uql6000116pjqgp82afq" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap2_Android上编写高效Java/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android/books/《Android 编程实战》Chap1_完善开发环境和优化" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/11/android/books/《Android 编程实战》Chap1_完善开发环境和优化/">《Android 编程实战》Chap1_完善开发环境和优化</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/11/android/books/《Android 编程实战》Chap1_完善开发环境和优化/">
            <time datetime="2017-09-11T13:34:19.000Z" itemprop="datePublished">2017-09-11</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/android/">android</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>阅读《Android 编程实战》一书的随记笔记<br>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h2 id="Android-SDK-进一步了解"><a href="#Android-SDK-进一步了解" class="headerlink" title="Android SDK 进一步了解"></a>Android SDK 进一步了解</h2><p>SDK基本我们都是确保为最新的. 更新SDK最简单的方法就是命令行:</p>
<p><code>$ android update sdk --no-ui</code></p>
<p>命令脚本在<code>SDK</code>安装目录的<code>tools</code>文件夹下. 对于之后对其例如<code>tools</code>, <code>platform-tools</code>, <code>gradle</code>的全局环境配置就不单独说明. 说一下<code>mac</code>下的配置<code>/Users/yourname/</code>文件夹下的<code>bash_profile</code>文件. 放入一下我的全局配置文件,可以作为格式参考,别忘了替换成你自己的电脑用户名.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">export PATH=&quot;/usr/local/mysql/bin:$PATH&quot;</div><div class="line">#添加mysql的全局开启关闭服务</div><div class="line">export PATH=&quot;/usr/local/mysql/support-files:$PATH&quot; </div><div class="line">  </div><div class="line">export PATH=$&#123;PATH&#125;:/Users/suzeyu/Library/Android/sdk/tools  </div><div class="line"></div><div class="line">export PATH=$&#123;PATH&#125;:/Users/suzeyu/Library/Android/sdk/platform-tools </div><div class="line"></div><div class="line">export ANDROID_HOME=~/Library/Android/sdk</div><div class="line"></div><div class="line"># 设置ndk环境路径</div><div class="line">export PATH=$&#123;PATH&#125;:/Users/suzeyu/Library/Android/sdk/ndk-bundle</div><div class="line"></div><div class="line"></div><div class="line">#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!</div><div class="line">export SDKMAN_DIR=&quot;/Users/suzeyu/.sdkman&quot;</div><div class="line">[[ -s &quot;/Users/suzeyu/.sdkman/bin/sdkman-init.sh&quot; ]] &amp;&amp; source &quot;/Users/suzeyu/.sdkman/bin/sdkman-init.sh&quot;</div></pre></td></tr></table></figure>
<p>当配置全局环境完成之后, 可以手动刷新全局环境, 让更改的操作立即生效.</p>
<p><code>$ source ~/.bash_profile</code></p>
<h3 id="adb工具"><a href="#adb工具" class="headerlink" title="adb工具"></a>adb工具</h3><p><code>adb</code>位于<code>platform-tools</code>文件夹. 可以使用<code>$ adb help all</code>查看可执行的操作.</p>
<p>一些常用的命令:</p>
<ul>
<li><code>adb devices</code> 列出所有连接的Android设备和虚拟机</li>
<li><code>adb push &lt;local&gt; &lt;remote&gt;</code> 将电脑上的文件复制到设备</li>
<li><code>adb pull &lt;remote&gt; &lt;local&gt;</code> 将设备上的文件复制到电脑</li>
</ul>
<p><strong>如果存在多台设备,进行操作的时候需要选择某一个设备</strong></p>
<p><img src="http://szysky.com/2016/09/20/%E3%80%8AAndroid-%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98%E3%80%8B%E5%AE%8C%E5%96%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%92%8C%E4%BC%98%E5%8C%96/multi_devices.png" alt="img"></p>
<p>通过<code>-s &lt;指定serial number&gt;</code>来确定连接哪一个设备.</p>
<p><strong>adb logcat查看日志</strong></p>
<p><code>$ adb logcat MainActivity:* *:s</code></p>
<p>这条命令会开启日志输出, 并且只打印<code>MainActivity</code>标签的日志. <code>*</code>代表任何可能的值. 其格式<code>&lt;tag&gt;:&lt;priority&gt;</code>, 而后面的<code>*:s</code>添加的特殊过滤用来过滤所有信息. 如果还想显示Android系统相关的日志以及由平台引起的应用程序异常可以加上<code>AndroidRuntime:*</code>参数.</p>
<p><strong>WiFi连接adb</strong></p>
<p>USB连接时最常用, 当不代表就是唯一途径. 也可以用<code>WiFi</code>通过<code>TCP/IP</code>连接来连接设备.</p>
<p>如果想要无线连接, 首先需要使用USB先连接电脑, 进行配置; 并且保证电脑和手机是处在同一<code>WiFi</code>环境下. 这是先决条件. (WiFi ip地址可以在手机设备网络连接查看). 然后命令即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ adb tcpip 5555</div><div class="line">$ adb connect 192.168.1.104</div><div class="line">$ adb devices    #查看当前连接设备, 应该可以看见两个连接</div></pre></td></tr></table></figure>
<p>说明一下,<code>tcpip 5555</code>会在<code>TCP/IP</code>模式下重启adb守护进程, 然后监听5555端口(adb默认端口). <code>connect</code>命令会使用电脑上的adb服务连接设备的IP地址. 然后拔掉usb查看设备应该会出现一个<strong>ip地址:端口</strong>序列名的设备. 你可以使用<code>adb shell</code>简单测试一下.</p>
<p>adb守护进程会一直保持<code>TCP/IP</code>模式, 直到设备重新启动, 或者运行了<code>adb usb</code>, 该命令会重启<code>USB守护进程</code>.</p>
<p>当然有利就有弊, 首先不是所有设备都支持<code>WiFi</code>连接, 并且相比较usb调试. 速度方面明显比较慢.</p>
<p><strong>在Android设备上执行命令</strong></p>
<p>当在<code>Android</code>设备上运行<code>shell</code>时, <code>am</code>和<code>pm</code>命令会比较有用, 他们对应<code>应用程序Application</code>和<code>包管理器Package Manager</code>. 例如由一个外部<code>Intent</code>启动<code>Service</code>可以使用<code>am</code>命令手动发送<code>Intent</code>.</p>
<p><code>$ adb shell am startservice -a &lt;intent action&gt;</code></p>
<p>同时也可以指定某一个具体的组件名. 也可以启动<code>Activity</code>或者发送<code>Intent广播</code>. 例如当开发过程中需要测试一个<code>Service</code>, 但是启动它的<code>Activity</code>还没有被创建, 这时候就可以使用命令.</p>
<p><code>包管理器</code>是<code>Android</code>上的一个核心组件. 它用来管理设备上已安装的应用程序. 可以像使用<code>Application Manager</code>一样控制pm命令来使用. 比如允许开发者查看, 安装, 卸载已安装程序等. 还能检查这些应用的特性和应用权限. 例如:</p>
<p>查看已安装的程序</p>
<p><code>$ adb shell pm list packages</code></p>
<p>如果需要查看更多使用说明可以看官网说明<a href="https://developer.android.com/studio/command-line/adb.html" target="_blank" rel="external">adb使用说明</a> 注意科学上网…</p>
<h3 id="Gradle简单说明"><a href="#Gradle简单说明" class="headerlink" title="Gradle简单说明"></a>Gradle简单说明</h3><p>随着AS的普及, 对于<code>Gradle</code>也将彻底替代<code>Ant</code>脚本. 和<code>Ivy</code>,<code>Maven</code>一样的模块化构建系统. 他结合了<code>Ant</code>的灵活以及<code>Maven</code>中的依赖管理. <code>Gradle</code>使用了<code>Groovy</code>领域的专用语言, 可以更清楚地描述配置项, 不用再写复杂的XML构建脚本.</p>
<p>关于根目录的<code>build.gradle</code>文件. 中主要有三个区块:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">apply plugin: xxx       // gradle应用哪种插件</div><div class="line"></div><div class="line">buildscript&#123;    // 告诉gradle使用哪个仓库去下载构建所用的插件以及依赖</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies&#123;   // 项目的依赖</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">android&#123;        // 项目的配置项</div><div class="line">    ..</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>虽然可以直接在<code>AS</code>中构建项目, 同样也可以通过命令与构建系统交互. <code>Gradle</code>定义了一系列任务. 在项目根目录下输入如下命令即可列出可用的任务:</p>
<p><code>$ ./gradlew tasks</code></p>
<p>如果需要从头开始构建一个应用程序, 只需要运行下面的命令:</p>
<p><code>$ ./gradlew clean build</code></p>
<h3 id="ProGuard优化和混淆代码好处"><a href="#ProGuard优化和混淆代码好处" class="headerlink" title="ProGuard优化和混淆代码好处"></a>ProGuard优化和混淆代码好处</h3><ol>
<li>对代码混淆可以让反编译更加困难.</li>
<li>删除无用的代码能压缩生成更小的二进制dex文件</li>
<li>并且由于对方法名,成员变量等混淆可以提高相应的运行速度</li>
</ol>
<p>由于<code>ProGuard</code>工具对Android代码进行了混淆, <code>Gradle</code>构建工具也支持该工具, 可在<code>build.gradle</code>文件的<code>android块-&gt;buildTypes块-&gt;</code>添加对应代码.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">buildTypes &#123;</div><div class="line">   debug &#123;</div><div class="line">   &#125;</div><div class="line">   release &#123;</div><div class="line">       //混淆开关</div><div class="line">       minifyEnabled true</div><div class="line">      </div><div class="line">       //加载默认混淆配置文件 progudard-android.txt在sdk目录里面，不用管，proguard.cfg是我们自己配的混淆文件</div><div class="line">       proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="熟悉IDE"><a href="#熟悉IDE" class="headerlink" title="熟悉IDE"></a>熟悉IDE</h2><h3 id="断点"><a href="#断点" class="headerlink" title="断点"></a>断点</h3><p>当程序达到断点出, 可以检查此时的应用状态. 所有的作用域中的变量都会直接显示IDE的调试视图中. 并且可以改变当前作用域的变量值, 可不需要重启应用.</p>
<p>根据单步的不同跳入方法, 可以<strong>顺序执行</strong>, <strong>自己定义的方法跳入</strong>, <strong>系统提供的方法跳入</strong>, 鼠<strong>标垫跳入</strong>.等可以追踪到不容易发现的问题.</p>
<h3 id="lint静态代码分析"><a href="#lint静态代码分析" class="headerlink" title="lint静态代码分析"></a>lint静态代码分析</h3><p>编写代码总会伴随着错误发生, 即使经验丰富的人也不过是把错误发生的概率降低. 但是不能杜绝. 针对这种问题就出现了编写单元测试来检测方法代码. 但是编写的单元测试也不可能覆盖所有的情况. 所以有时候可能需要其他的方式来检测. 例如<strong>静态代码分析</strong></p>
<p><strong>功能:</strong></p>
<p><code>lint</code>工具会检查性项目中的源文件, 包括<code>XML</code>和<code>Java</code>. 它还会查找缺失元素,结构不良的代码,问呗使用的变量等. 在<code>AS</code>中高亮显示的代码表示代码要修正. 可以将鼠标移动到此处会显示更多细节.</p>
<p><strong>问题:</strong></p>
<p>虽然<code>lint</code>可以很强大的检测一些错误, 但有时候可能我们并不想让其显示警告, 例如如果缺少了推荐代码, 由于某些原因使用了过时代码, 但是毫无办法并且确认程序是不会发生错误的, 这个时候是就可以压制<code>lint</code>的警告.</p>
<ul>
<li><code>java文件</code>: 可以使用<code>@SuppressLint</code>注解, 把需要一直的警告当做参数</li>
<li><code>xml文件</code>: 需要引入<code>lint</code>命名空间(<code>xmlns:tools=&quot;http://scheme.android.com/tools&quot;</code>), 然后在需要抑制警告的时候添加<code>tools:ignore=&quot;WarningName&quot;</code></li>
</ul>
<h3 id="重构代码"><a href="#重构代码" class="headerlink" title="重构代码"></a>重构代码</h3><p><code>IDE</code>内置了多种重构任务. 重构涉及<strong>命名</strong>, <strong>移动变量,方法,类</strong>, <strong>修改方法签名</strong>, <strong>封装字段</strong>等等. 在<code>AS</code>中将光标放在需要修改的代码处, 然后从<code>Refactor</code>菜单中进行后续具体的操作</p>
<ol>
<li><strong>提取常量</strong>: (<code>Extract Constant</code>). 可以快速的将一个变量替换成常量.</li>
<li><strong>修改方法签名</strong>: 方法签名定义了方法的修饰符, 返回类型, 名称, 参数.</li>
<li><strong>从代码提取方法</strong>: 保持方法的内容不要过多, 并且方法的目的明确.这是一种好的习惯. 可以选中一段代码块然后执行<code>Extract Method</code>(抽取方法)来提取出一段代码重构为一个方法. 此后如果有需要还可以修改方法签名(<code>Change Method Signature</code>)来进行处理.</li>
<li>…</li>
</ol>
<p>更多的选项可以自己去手动实践. 当熟练之后, 对于代码编写速度是一个不错的提升.</p>
<h2 id="手机上的开发者选项"><a href="#手机上的开发者选项" class="headerlink" title="手机上的开发者选项"></a>手机上的开发者选项</h2><p>这里稍微介绍一下关于开发者选项里面的一些功能.</p>
<ul>
<li><strong>不锁定屏幕(Stay Awake)</strong>: 该选项可以在设备充电的时防止屏幕锁屏, 前提是用USB线和电脑连接. 这样就不需要由于等待时间过长, 手机自动锁屏.</li>
<li><strong>启动USB调试</strong>: 这是使用<code>adb</code>连接设备和开发环境的先决条件.</li>
<li><strong>Allow Mock Location</strong>: 如果需要对位置相关开发, 可以使用此模式模拟(不同厂商可能不提供)</li>
<li><strong>显示触摸操作(Shoe Touches)和指针位置(Pointer Location)</strong>: 它们对编写需要手势或者多点触控界面等高级触摸开发调试比较有用处</li>
<li><strong>Drawing(绘图)</strong>: 可以让开发者获取视图反馈的设置项, 比如用户界面布局以及重绘的速度和频率. 可以为动画和过渡效果设置缩放参数. 也可以在调试的时候完全禁用他们. <code>Android4.2</code>中的一个新功能是允许模拟辅助显示屏.</li>
<li><strong>Monitoring(监控)</strong>: 有些设置项对确保设备流畅运行非常有用. 大部分开发者通常使用的测试机为新款手机. 但是有些用户的的一些旧设备可能会出现一些高端机上不会发生的问题. 使用以下这些选项可以更早的定位这些问题.</li>
<li><ul>
<li><code>Strict Mode Enabled(严格检查模式)</code>: 在主线程执行一个很耗时的操作时设配屏幕会闪烁.</li>
</ul>
</li>
<li><ul>
<li><code>Show CPU Usage(显示CPU使用情况)</code>: 性能比较, 可以跟踪程序的CPU使用率</li>
</ul>
</li>
<li><strong>Apps部分</strong>: 也可以作为模拟使用较差的CPU和低内存的设备行为.</li>
<li><ul>
<li><code>不保留活动(Don&#39;t keep Activities)</code>: 可确保每次启动<code>Activity</code>都重新创建. <strong>默认</strong>是只有内存不足的时候才会删除, 并且做到尽量保持<code>activity</code>处于活动状态.</li>
</ul>
</li>
<li><ul>
<li><code>后台进行限制(Background Process Limit)</code>: 可以更早的结束后台操作,和上面选项模拟的行为类似.</li>
</ul>
</li>
<li><ul>
<li><code>显示所有ANR(Show All ANRs)</code>: 当应用程序在后台崩溃时他会变得更加明显. 通常, 只有当前在前台运行的应用程序才会显示<code>ANR</code></li>
</ul>
</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap1_完善开发环境和优化/" data-id="cj7g7uql1000016pjm0ap5y8d" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/11/android/books/《Android 编程实战》Chap1_完善开发环境和优化/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-mysql/mysql_4 数据控制语言控制" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/08/mysql/mysql_4 数据控制语言控制/">mysql_4 数据控制语言控制</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/08/mysql/mysql_4 数据控制语言控制/">
            <time datetime="2017-09-08T09:10:54.000Z" itemprop="datePublished">2017-09-08</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/mysql/">mysql</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/mysql/">mysql</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h3 id="数据控制语言-DCL-Data-Control-Language"><a href="#数据控制语言-DCL-Data-Control-Language" class="headerlink" title="数据控制语言 DCL (Data Control Language)"></a>数据控制语言 DCL (Data Control Language)</h3><p>数据控制语言,是用于对<code>mysql</code>的用户及其权限进行管理的语句.</p>
<p><strong>用户管理</strong></p>
<p>mysql中的所有用户,都存在系统数据库(mysql)中的 <code>user</code> 表中–不敢那个数据库的用户,都存储在这里.<code>(服务器: localhost--&gt;数据库: mysql--&gt; 表 user)</code></p>
<p><strong>创建用户</strong></p>
<p>形式: <code>create user &#39;用户名&#39;@&#39;允许登录的地址/服务器&#39; identified by &#39;密码&#39;</code></p>
<p>如果想创建一个指定的 <code>ip</code> 用户想访问我们本地的数据库这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create user &apos;extra&apos;@&apos;192.168.x.x&apos; identified by &apos;123&apos;;    //这样就创建了一个 extra 的用户  对方访问可以这样&lt;br/&gt;</div><div class="line">mysql -h我的主机名 -uextra -p;</div></pre></td></tr></table></figure>
<p><strong>删除用户</strong></p>
<p><code>drop user &#39;用户名&#39;@&#39;允许登录的地址或服务器&#39;</code></p>
<p><strong>修改用户密码</strong></p>
<p><code>set password = password(&#39;密码&#39;);</code></p>
<p><code>setpassword for &#39;用户名&#39;@&#39;允许登录的地址&#39; = password(&#39;密码&#39;);</code></p>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><p><code>mysql</code> 数据库,将其中所能做的所有事情否分门别类分配到大约30多个权限中去了,其中每个权限,都是一个单词而已.</p>
<ul>
<li><code>select</code>: 代表可以查询数据;</li>
<li><code>update</code>: 代表可以修改数据;</li>
<li><code>delete</code>: 代表可以删除数据;</li>
<li>……</li>
</ul>
<p>其中有一个特别的权限 : <code>all</code> 设置出 <code>GRANT OPTION</code> 之外的所有简单权限.</p>
<p><strong>授予权限</strong></p>
<p>形式:</p>
<ul>
<li><code>grant 权限列表 on 某库.某对象 to &#39;用户名&#39;@&#39;允许登录的位置&#39; [identified by &#39;密码&#39;];</code></li>
</ul>
<p>说明:</p>
<ol>
<li>权限列表,就是多个权限的名字,相互之间用逗号分开,比如: <code>select,insert,update</code>, 也可以写 <code>all</code></li>
<li><code>某库.某对象</code>,表示给指定的某个数据库中的某个下级单位附权,下级单位有: 表名,视图名,存储过程名,存储函数名.其中可以使用统配语法–&gt;</li>
<li><code>\*.\*</code>: 代表所有的数据库的所有下级单位.</li>
<li>某库.*: 代表指定的该库中的所有下级单位</li>
</ol>
<p><strong>剥夺权限</strong></p>
<p>形式:</p>
<ul>
<li><code>revoke 权限列表 on 某库.某个对象 from &#39;用户名&#39;@&#39;允许登录的位置&#39;</code></li>
<li>其含义,跟 <code>grant</code> 完全一样;</li>
</ul>
<h3 id="数据事务语言-DDL-Data-Transaction-Language"><a href="#数据事务语言-DDL-Data-Transaction-Language" class="headerlink" title="数据事务语言 DDL (Data Transaction Language)"></a>数据事务语言 DDL (Data Transaction Language)</h3><p>就是用来保证多条增删改语句的执行的一致性,要么都执行,要么都没有执行.</p>
<p><strong>事务的特点</strong></p>
<ul>
<li>原子性: 一个事务总的所有语句,应该做到要么全做,要么一个都不做.</li>
<li>一致性: 让数据保持逻辑上的合理性,例如一个商品出库时,既要让商品库数量减1,又让让对应用户购物车商品加1.</li>
<li>隔离性: 如果多个事务同时并发执行,但每个事务就像各自独立执行一样.</li>
<li>持久性: 一个事务执行成功,则对数据来说应该死一个明确的硬盘数据更改,而不仅仅是内存中的变化.</li>
</ul>
<p><strong>事务模式</strong></p>
<p>在我们 <code>cmd</code> 命令模式中,是否开启了 一条语句就是一个事务 的这个开关.<br>默认情况下(安装后) ,这个模式是开启的,称为自动提交模式;我们可以手动把他关闭,那就是’非自动提交模式’</p>
<p><code>set autocommit = 0/false</code> //关闭该模式</p>
<p><strong>事务执行的基本流程</strong></p>
<ol>
<li><p>开启一个事务: <code>start transaction;</code> //也可以写成: <code>begin</code></p>
</li>
<li><p>执行多条增删改语句; //也就是相当于希望这多条语句作为一个不可分割的整体去执行.</p>
</li>
<li><p>判断这些语句执行的结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if(没有出错)&#123;</div><div class="line">    commit;        //提交事务;此时就是一次性完成;</div><div class="line">&#125; else&#123;</div><div class="line">    roolback;    //回滚事务;此时什么都没有做;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="mysql-编程"><a href="#mysql-编程" class="headerlink" title="mysql 编程"></a>mysql 编程</h3><p><strong>mysql 编程中语句块包含符</strong></p>
<p>就是相当于 <code>js</code> 或 <code>php</code> 中的大括号语法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[标识符 :] begin</div><div class="line">    //语句...</div><div class="line">end;[标识符];</div></pre></td></tr></table></figure>
<p>标识符就是定义任意的名字而已,比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">if(条件判断)    </div><div class="line">    begin</div><div class="line">        //.....</div><div class="line">    end;</div><div class="line">end if;</div><div class="line"></div><div class="line">if(条件判断)</div><div class="line">    A:begin</div><div class="line">        //...</div><div class="line">    end A;</div><div class="line">end if;</div><div class="line">A 就是标识符,它的租用是标识该语句块,以期可以在该语句块中使用它--其实就是退出.</div></pre></td></tr></table></figure>
<p><strong>流程控制语句</strong></p>
<p>1.<code>if</code> 语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">if 条件语句 then</div><div class="line">    begin</div><div class="line">        语句块</div><div class="line">    end;</div><div class="line"></div><div class="line">    elseif 条件语句 then </div><div class="line">    begin</div><div class="line">        语句块</div><div class="line">    end;</div><div class="line"></div><div class="line">    else</div><div class="line">    begin</div><div class="line">        else 语句块</div><div class="line">    end;</div><div class="line">end if;</div></pre></td></tr></table></figure>
<p>2.<code>case</code> 语句 相当于 <code>java</code> 的 <code>switch</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CASE case_value</div><div class="line"></div><div class="line">    WHEN when_value THEN statement_list</div><div class="line"></div><div class="line">    WHEN when_value1 THEN statement_list    //可以有很多 when 和 then 组合</div><div class="line">    ELSE statement_list</div><div class="line"></div><div class="line">END CASE</div></pre></td></tr></table></figure>
<p>语法 <code>case @v1 ... end case; //@v1表示一个变量;后面都这样</code></p>
<p><strong>3.loop 循环语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">标识符: loop</div><div class="line">begin</div><div class="line">    //这里就是循环的语句块</div><div class="line">    //注意这里必须要有一个退出循环的逻辑机制,否则该循环就是死循环,其基本形式类似这样</div><div class="line">        if(条件) then</div><div class="line">            leave 标识符;    //退出</div><div class="line">        end if;</div><div class="line">end;</div><div class="line">end loop 标识符;</div></pre></td></tr></table></figure>
<p><strong>4.while循环语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">set @v1&lt;10 do</div><div class="line">    begin</div><div class="line">        insert into tab1 (id,num) values(null, @v1);</div><div class="line">        set @v1 = @v1 + 1;</div><div class="line">    end;</div><div class="line">end while;</div></pre></td></tr></table></figure>
<p><strong>5.repeat语句</strong><br>类似于<code>dowhile</code>语句,但是这里条件为真就不执行,为假就继续执行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">set @v1 = 1;    //赋值语句</div><div class="line">repeat</div><div class="line">    begin</div><div class="line">        insert into tab1 (id,num) values(null,@v1);</div><div class="line">        set @v1 = @v1+1;</div><div class="line">    end;</div><div class="line">    until @v1 &gt;= 9;</div><div class="line">end repeat;</div></pre></td></tr></table></figure>
<p><strong>leave语句</strong></p>
<p>语法: <code>leave</code> 标识符;</p>
<p>作用: 用来退出<code>begin...end</code>结构或其他具有标识符的结构.</p>
<p><strong>mysql中的变量</strong></p>
<p><code>mysql</code>中,有两种变量形式:</p>
<ul>
<li>普通变量: 不带 <code>@</code> 符号</li>
</ul>
<p>形式: <code>declare 变量名 类型名 [default 默认值]; //普通变量必须先这样定义</code></p>
<p>使用场景:只能在编程环境使用,有3个:1函数内部,存储过程内部,触发器的内部.</p>
<ul>
<li>会话变量: 带 <code>@</code> 符号</li>
</ul>
<p>形式: <code>set @变量名 = 值; //跟php类似,无需定义,直接赋值,第一次就算是定义</code></p>
<p>使用场景: 任何场景.</p>
<p><strong>变量赋值</strong></p>
<ol>
<li><code>set 变量名 = 表达式;</code> #此语法中的变量必须先使用declare声明.</li>
<li><code>set @变量名 = 表达式;</code> #此方式可以无需<code>declare</code>语法声明,而是直接赋值,类似<code>php</code>定义变量并赋值.</li>
<li><code>select @变量名:=表达式;</code> #此语句会给该变量赋值,同时还会作为一个<code>select</code>语句输出结果集.</li>
<li><code>select 表达式 into @变量名;</code>#此语句虽然看起来是<code>select</code>语句,但其实并不输出结果集,而只是给变量赋值.</li>
</ol>
<p><strong>(存储)函数</strong></p>
<p>函数,也说成存储函数,其实就是<code>js</code>和<code>php</code>中所说的函数.</p>
<p>注意:</p>
<ol>
<li>在函数内部,可以有各种变量和流程控制的的使用.</li>
<li>在函数内部,也可以有各种增删改语句.</li>
<li>在函数内部,不可以用<code>select</code>或其他返回结果集的查询类语句.</li>
</ol>
<p>唯一的区别:</p>
<ul>
<li>这里的函数必须返回一个数据(值);</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//创建一个函数</div><div class="line">create function getMaxValue(p1 float, p2 float, p3 float)</div><div class="line">returns float;    #返回float类型</div><div class="line">begin</div><div class="line">    .... # 要执行的内容</div><div class="line">end;</div></pre></td></tr></table></figure>
<p>上处代码直接在命令行执行可能会有error,因为代码中包含; 会提前结束没有完成的语句.解决方案可以通过修改’语句结束符’. <code>delimiter ///</code></p>
<p><strong>删除函数</strong></p>
<p><code>drop function</code></p>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>存储过程,其实还是函数 – 但其规定: 不能有返回值.</p>
<p>创建一个存储过程</p>
<p>效果目标: 将3个数据写入到表<code>tab_int</code></p>
<p>并返回该表的第一个字段的前3大值得行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">create procedure insert_get_date(p1 int, p2 tinyint, p3 bigint)</div><div class="line">begin</div><div class="line">    insert into tab_int(f1,f2,f3) values(p1,p2,p3);</div><div class="line">    select * from tab_int order by table_int.f1 desc limit 0,3;</div><div class="line">end;</div></pre></td></tr></table></figure>
<p>调用存储过程:</p>
<ul>
<li><code>call</code> 存储过程名(实参1, 实参2, …)</li>
<li>它应该是在非编程环境中调用,既执行增删改查的场景.</li>
</ul>
<p><strong>删除存储过程</strong></p>
<p><code>drop procedure 存储过程名;</code></p>
<h3 id="触发器-trigger"><a href="#触发器-trigger" class="headerlink" title="触发器 trigger"></a>触发器 trigger</h3><p>触发器,也是一段预先定义好的编程代码(跟存储过程和存储函数一样),并有个名字.</p>
<p>它不能调用,而是,在某个表发生某个事件(增,删,改)的时候,会自动触发而调用起来.</p>
<p>定义形式:</p>
<ul>
<li><code>create trigger 触发器名 触发时机 触发事件 on 表名 for each row</code></li>
</ul>
<p>begin //…. end;</p>
<p>说明:</p>
<ol>
<li>触发时机,只有两个: <code>before</code>(在…之前), <code>after</code>(在…之后);</li>
<li>触发事件,只有三个: <code>insert</code>, <code>update</code>, <code>delete</code></li>
<li>既触发器的含义是: 在某个表上进行<code>insert</code>(或<code>update</code>或<code>delete</code>)之前,或之后.</li>
<li>通常,触发器用于在对某个表进行增删改的操作的时候,需要同时去做另外一件事的时候;</li>
<li>在触发器的内部,有两个关键字代表某种特定的含义,可以用来获取数据<br><code>new</code>:它代表当前正要执行的<code>insert</code>或<code>update</code>的时候’新行’数据;通过他,可以获取这一新行数据的任意一个字段形式为: <code>set @v1 = new.id;</code> //获得该新插入或update行的id的值(前提是有该id).</li>
<li><code>old</code>:它代表当前正要执行的delete的时候’旧行’数据;通过他,可以获取这一旧行数据的任意一个字段形式为: <code>set @v1 = new.id;</code> //获得该新插入或<code>update</code>行的<code>id</code>的值(前提是有该id).</li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/08/mysql/mysql_4 数据控制语言控制/" data-id="cj7bo43qz0001v5pjyl3gnqwh" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/08/mysql/mysql_4 数据控制语言控制/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-mysql/mysql_3 子查询" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/08/mysql/mysql_3 子查询/">mysql_3 子查询</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/08/mysql/mysql_3 子查询/">
            <time datetime="2017-09-08T09:10:17.000Z" itemprop="datePublished">2017-09-08</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/mysql/">mysql</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/mysql/">mysql</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>概念: 就是将两个或两个以上的表，连接起来，当做一个数据源，并从中去取得所需要的数据。</p>
<p>就是将每一个表的每一行数据两两之间相互对接起来，每次对接的结果都是连接结果的 一行 数据。</p>
<p>没有条件的连接写法:</p>
<ul>
<li><code>select * from 表1, 表2;</code></li>
<li><code>select * from 表1 join 表2;</code></li>
<li><code>select * from 表1 cross join 表2;</code></li>
</ul>
<p><strong>连接基本形式</strong></p>
<p>在代码级别，连接的基本形式为:</p>
<ul>
<li><code>表1 [连接形式] join 表2 [on 连接条件];</code></li>
</ul>
<p>如果是3个表，则进一步扩展为:</p>
<ul>
<li><code>表1 [连接形式] join 表2 [on 连接条件] [连接形式] join 表3 [on 连接条件]</code></li>
</ul>
<p><strong>连接的分类</strong></p>
<p>交叉连接</p>
<ul>
<li>其实就是上面的连接形式，–因为没有条件，只是按连接的基本概念，将所有数据行都连接起来的结果。它又叫做‘笛卡尔积’。</li>
<li>对于表1 和表2 的连接，交叉结果是: 行数=两个表字段之和； 列数=两个表的乘积数</li>
</ul>
<p><strong>内连接</strong></p>
<ul>
<li><code>形式: select * from 表1 [inner] join 表2 on 连接条件。</code></li>
</ul>
<p>例如有 <code>student</code>表和 <code>type</code>表 学生表中包含科目<code>pro_id</code>, 而<code>Type</code>表有每个<code>pro_id</code>字段并对应说明。这时候如果需要类连接查询如下：</p>
<p><code>select * from student inner join type on student.pro_id = type.pro_id;</code></p>
<p>优化: <code>SELECT o.* ,t.sex FROM db1.join1 as o inner join db1.join2 as t on o.type = t.type;</code></p>
<p>注意: 这种的表和表之间的内连接传，虽然可以提现为表跟表之间的关系– 一般情况下这就是外键的关系，单并不是有外键关系才可以使用。</p>
<p><strong>左(外)连接 left(outer) join</strong></p>
<ul>
<li>形式: <code>表1(左表) left [outer] join 表2(右表) on 连接条件</code></li>
<li>含义: 就是将两个表的内连接的结果，再加上左边表不符合内连接所设定的条件的那些数据结果。</li>
<li><code>SELECT o.* ,t.sex FROM db1.join1 as o left join db1.join2 as t on o.type = t.type;</code></li>
</ul>
<p><strong>右(外)连接 right(outer) join</strong></p>
<p>同左连接–只不过关键字为right(outer)</p>
<p><strong>全连接 full(outer) join</strong></p>
<p>在<code>mysql</code>中不支持全连接的语法;</p>
<p>含义: 将两个表内连接的结果，加上左边不符合的结果，和右边不符合的结果。</p>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>含义: 一个<code>select</code>语句，就是一个查询语句</p>
<ul>
<li><code>select 字段或表达式 from 数据源 where xx条件判断；</code></li>
</ul>
<p>上述<code>select</code>部分，<code>from</code>部分，<code>where</code>部分，往往都是一些数据 或者数据的集合。</p>
<p><code>from</code>部分, 当然就是 表 ，或 表的连接结果，他们也是数据，只是通常为表数据。</p>
<p>例子 <code>select pro_id, price from product where price &gt; (select avg(price) from product)</code></p>
<p>例子的<code>where</code>后面括号中的<code>select</code>语句就是子查询。</p>
<p>所以可以认为就是在一个查询语句的内部，某些位置，又出现了查询语句。 由此引出了主查询和子查询的概念。</p>
<p>通常，子查询是为主查询服务的，所以子查询获得一定的结果数据之后，才去执行主查询。</p>
<p>形式: <code>select 字段或表达式或子查询 [as 别名] from 表名或链接结果或子查询 where 字段或表达式或子查询的条件判断。</code></p>
<p><strong>按子查询结果，可分为如下几个</strong></p>
<ul>
<li>表 子查询</li>
</ul>
<p>一个子查询返回的结果理论上是多行多列的时候，此时可以当做一个表来使用，通常是放在<code>from</code>后面。</p>
<ul>
<li>行 子查询</li>
</ul>
<p>一个子查询返回的结果理论是一行多列的时候。此时可以当做一个行来使用，通常放在行比较语法上。<br>行比较语法类似这样: <code>where row(字段1,字段2) = (select 行子查询)</code>;</p>
<ul>
<li>列 子查询</li>
</ul>
<p>一个子查询返回的结果理论上是多行一列的时候，此时可以当做多个值来使用。<br>类似(5,8,10,11).</p>
<ul>
<li>标量 子查询</li>
</ul>
<p>一个子查询返回的结果理论上是一行一列的时候，此时可以当做一个单个值使用，类似这种: <code>select 5 as c1; 或select ... where id = 17, 或select ... where b&gt;8;</code></p>
<p><strong>子查询，按位置(场合)分</strong></p>
<ul>
<li>作为主查询的结果数据</li>
<li>作为主查询的条件数据</li>
<li>作为主查询的来源数据</li>
</ul>
<p><strong>常见子查询</strong></p>
<p><strong>比较运算符总的子查询</strong></p>
<p>形式: 操作数 比较运算符 (标量子查询)</p>
<p>说明: 操作数，其实就是比较运算符的2个数据之一而已，通常就是一个字段名。</p>
<p>举例:</p>
<p>找出最高价的商品:</p>
<ul>
<li><code>select * from product where price = (select max(price) from product);</code></li>
</ul>
<p><strong>使用in的子查询</strong></p>
<p>以前的in的用法:</p>
<ul>
<li><code>xx in (值1, 值2, 值3, ...);</code></li>
</ul>
<p>in的子查询为:</p>
<ul>
<li><code>xx in (列子查询)</code></li>
</ul>
<p>举例: 找出所有列别名称中带电这个字的所有商品。</p>
<p>可以分两步思考:</p>
<p><code>select protype_id from product_type where protype_name like %电%;</code></p>
<p>为子查询条件 — 以下为主程序 嵌入where其中。</p>
<p><code>select * product where protype_id in(&#39;此处为上一步&#39;);</code></p>
<p><strong>使用any的子查询</strong></p>
<p>形式: 操作数 比较运算符 <code>any</code> (列子查询);</p>
<p>含义: 当某个操作数(字段) 对于该列子查询的任意一个值，只要有一个满足该比较运算符，则就算是满足了条件。</p>
<p><strong>使用all的子查询</strong></p>
<p>形式: 操作数 比较运算符 <code>all</code> (列子查询);</p>
<p>含义: 当某个操作数(字段) 对于该列子查询的任意一个值，必须全部满足该比较运算符，则就算是满足了条件。</p>
<p>列子查询 子查询只能是一个字段。</p>
<p>举例: 查询出所有非最高价的商品</p>
<ol>
<li>查询所有的价格 <code>select price form product;</code></li>
<li>在所有的价格中只有最高价会不满足 <code>&lt;any</code>(全部价格)，所以可以这样</li>
</ol>
<ul>
<li><code>select * from product where price &lt; any(select price from product);</code></li>
</ul>
<p>同理: 求出最高价的商品价格，特征： 大于所有的价格</p>
<ul>
<li><code>select * from product where price &gt;= all(select price from produc);</code></li>
</ul>
<p><strong>使用some的子查询</strong></p>
<p>一句话: <code>some</code>是<code>any</code>的同义词。</p>
<p><strong>使用exists的查询</strong></p>
<p>形式: <code>where exists (子查询)</code></p>
<p>含义: 该子查询如果有数据，则<code>exists</code>的结果是<code>true</code>，否则就是<code>false</code>。</p>
<p>在实际应用中，该子查询往往都不是独立的子查询，而是会需要跟主查询的数据源(表),建立牟宗关系—通常就是连接关系。建立的方式是”隐式的”，既没有在代码上体现关系，单却在内部有其连接的 实质 。</p>
<p>此隐式方式，通常就体现在查询中的where条件语句中，使用了主查询表中的数据(字段)，</p>
<p>问题: 查询商品表中其类别名称中带”电”这个字的所有商品。</p>
<p><code>select * from product where exists(select * from product_type where protype_name like &#39;%电%&#39; and protype_id = product.protype_id);</code></p>
<p>注意:</p>
<ol>
<li>这种子查询语句，没法独立存在或者独立运行的，而是必须跟主查询一起使用。</li>
<li>其他子查询，是可以独立运行的，而且会得到一个运行结果。</li>
<li>盖子查询中的条件，应该设定为跟主查询的某个字段有一定的关联性判断。筒仓该判断就是这两个表的 本来该有的脸连接条件。</li>
</ol>
<h3 id="联合查询union"><a href="#联合查询union" class="headerlink" title="联合查询union"></a>联合查询union</h3><p>提示:</p>
<p>在<code>mysql</code>的手册中，将连接查询(<code>join</code>) 翻译为联合查询。而联合查询(<code>union</code>),没有明确翻译。</p>
<p>在通常的书籍或文章，<code>join</code>被翻译为连接查询；而<code>union</code>才被翻译为联合查询。</p>
<p><strong>基本概念</strong></p>
<p>将两个具有相同字段数量的查询语句的结果，以 上下堆叠 的方式，合并为一个查询结果</p>
<p>形式: <code>select 语句1 union [all | distinct] select 语句2;</code></p>
<p>此联合查询语句，默认会”自动消除重复行” ，既默认是<code>distinct</code>。 如果想要将所有数据都显示(允许重复行),就是用<code>all</code>。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/08/mysql/mysql_3 子查询/" data-id="cj7bo43r90006v5pjp48ekdbd" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/08/mysql/mysql_3 子查询/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-mysql/mysql_2 基本查询语句" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/09/08/mysql/mysql_2 基本查询语句/">mysql_2 基本查询语句</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/09/08/mysql/mysql_2 基本查询语句/">
            <time datetime="2017-09-08T09:09:49.000Z" itemprop="datePublished">2017-09-08</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/mysql/">mysql</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/mysql/">mysql</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p>注：本文主要参考<a href="http://szysky.com" target="_blank" rel="external">http://szysky.com</a></p>
</blockquote>
<h3 id="数据库表设计3范式"><a href="#数据库表设计3范式" class="headerlink" title="数据库表设计3范式"></a>数据库表设计3范式</h3><p><strong>第一范式(1NF)</strong></p>
<p>要求数据达到原子性，是数据不可再分</p>
<p><strong>第二范式(2NF)</strong></p>
<p>使每一行数据具有唯一性，并消除数据之间的部分依赖</p>
<ol>
<li>每一行数据具有唯一性: 只要给表设计主键，就可以保证唯一性</li>
<li>消除数据之间的”部分依赖”</li>
</ol>
<p>依赖的概念</p>
<p>就是在一个表中，其中某个字段的值B可以由另一个字段的值A来决定，则此时我们就称为：字段B依赖于字段A,或者字段A决定字段B。</p>
<p>就是根据字段A的某个值，一定可以找出一个确定的字段B的值，就是A决定B.</p>
<p>部分依赖？</p>
<p>如果某个字段，值依赖于部分主键字段，此时就称为部分依赖。–发生此情况的前提一定是: 主键字段有多个。</p>
<p>完全依赖？<br>某个字段，是依赖于主键的所有字段。– 如果一个表的主键只有一个字段，则此时必然是完全依赖。</p>
<p><strong>第三范式(3NF)</strong></p>
<p>独立性，消除传递依赖。</p>
<p>使每个字段都独立地依赖于主键字段(独立性),而要消除其中部分非主键字段的内部依赖–这种内部依赖会构成传递依赖</p>
<h3 id="数据操作语言-DML"><a href="#数据操作语言-DML" class="headerlink" title="数据操作语言 DML"></a>数据操作语言 DML</h3><p><strong>插入数据(增)</strong></p>
<ul>
<li>形式1: <code>insert [into] 表名 [(字段名1，字段名2...)] values(值表达式1，值表达式2,...),(),()...;</code></li>
<li><ul>
<li>这是最常用的插入语句，可以一次性插入多行数据，用逗号隔开；</li>
</ul>
</li>
<li><ul>
<li>插入语句，要理解为每次插入数据都是以行为单位进行插入；</li>
</ul>
</li>
<li><ul>
<li>字段名通常不推荐省略，其后续的值列表应该字段列表一一对应</li>
</ul>
</li>
<li><ul>
<li>其中的值表达式，可以是一个直接或函数调用结果，或变量值; 其中，如果对应字段是字符或时间类型，则直接值应该使用单引号</li>
</ul>
</li>
<li>形式2: <code>replace [into] 表名 [(字段名1，字段名2...)] values(值表达式1，值表达式2,...),(),()...;</code></li>
<li><ul>
<li>其跟<code>insert into</code>几乎一样: 唯一区别 如果插入的数据的主键或唯一键有重复，则此时就会变成修改改行数据</li>
</ul>
</li>
<li>形式3: <code>insert [into] 表名 [(字段名1，字段名2，...)] select 字段名1，字段名2,... from 其他表名;</code></li>
<li>形式4: <code>insert [into] 表名 set 字段名1=值表达式1，字段名2=值表达式2,...;</code></li>
</ul>
<p><strong>load data (载入数据) 语法</strong></p>
<p>使用于载入 结构整齐的纯文本数据。 前提也要有一个对应结构的已存在的表。</p>
<p>简单格式: <code>LOAD DATA INFILE &#39;文件名&#39; INTO TABLE 表名;</code></p>
<p><strong>删除数据</strong></p>
<p>形式: <code>delete from 表名 [where 条件] [order by 排序] [limit 限定];</code></p>
<p>说明:</p>
<ol>
<li>删除数据仍然是以行为单位进行</li>
<li>通常删除数据都需要带<code>where</code>条件，否则就会删除所有数据。</li>
<li><code>where</code>条件的语法跟<code>select</code>中的语法一样</li>
<li><code>order by</code> 排序设定，用于指定这些数据的删除顺序，他通常跟<code>limit</code>配合使用才有意义</li>
<li><code>limit</code>限定用于设定删除多少行(按<code>orderby</code> 设定顺序)</li>
</ol>
<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><p>形式: <code>update 表名 set 字段1=值1, 字段2=值2,...[where 条件] [order by 排序字段][limit 限制行数];</code></p>
<p>说明:</p>
<ol>
<li>通常，<code>update</code>语句，也都需要<code>where</code>条件，否则: 就会修改所有(这很少见);</li>
<li><code>where</code>条件的语法跟select中语法一样;</li>
<li><code>order by</code> 用于设定修改的顺序，<code>limit</code>用于设定修改的行数，他们通常也是结合使用(虽然很少用)</li>
<li>实际应用中，通常很少用到<code>order by</code>和<code>limit</code>，修改的常规操作就成为: <code>update 表名 set 字段1=值1，字段2=值2,... where条件</code></li>
</ol>
<h3 id="数据查询语言-DQL"><a href="#数据查询语言-DQL" class="headerlink" title="数据查询语言 DQL"></a>数据查询语言 DQL</h3><p><strong>基本语法形式</strong></p>
<p><code>select [all | distinct] 字段或表达式列表 [from 子句] [where 子句] [group by 子句] [having 子句] [order by 子句] [limit 子句];</code></p>
<p><strong>字段或表达式列表</strong></p>
<ol>
<li>字段，肯定来源于表，所以必然依赖于<code>from</code>语句</li>
<li>表达式是类似这样一个内容: 8 ， 8+3， now(); //concat()函数是mysql中的系统函数，用于连接多个字符串。</li>
<li>每个输出项(字段或表达式结果)，都可以给其设定一个别名，形式为: 字段或表达式 <code>as</code> 别名。</li>
<li><code>all</code> 和 <code>distinct</code> 设定<code>select</code>出来的数据，是否消除重复行，可以不写，那就是默认值<code>all</code>。 <code>all</code>表示不消除，既所有都出来，默认值；<code>distinct</code>表示会消除。</li>
<li><code>form</code>，表示<code>select</code>部分从中取得数据的数据源—就是表。</li>
<li><code>where</code>，对数据源中的数据进行帅选的条件设定，所以<code>where</code>依赖于<code>form</code>子句。</li>
</ol>
<p><strong>is 运算符: 空值和布尔值的判断</strong></p>
<p>有四种情况:</p>
<ul>
<li><code>xx is null</code>: 判断某个字段是null值，就是没有值</li>
<li><code>xx is not null</code>: 判断某个字段不是null值</li>
<li><code>xx is true</code>: 判断某个字段为真</li>
<li><code>xx is false</code>: 判断某个字段为假，false，0，0.0，’’, null</li>
</ul>
<p><strong>其他扩展</strong></p>
<ul>
<li>位类型<code>bit</code>: 使用形式: <code>bit[(M)]</code> ，其中M是1~64的数字，表示使用多少位二进制数字来存储数据。插入形式为: b’value’ 比如: b’101’</li>
<li>序列类型<code>serial</code>: 只是BIGINT UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE的一个别名(同义词)</li>
<li>布尔类型<code>bool</code>: 其实只是<code>tinyint(1)</code>的同义词，其值为<code>0</code>就表示<code>false</code>，否则为<code>true</code></li>
</ul>
<p><strong>between运算符: 范围判断</strong></p>
<p>用于判断某个字段的数据值是否在某个给定的范围之间–适用于数字类型</p>
<p>形式: <code>xx between 值1 and 值2;</code></p>
<p>含义: xx字段的值在给定值1和值2之间，其实相当于: xx&gt;=值1 and xx&lt;=值2</p>
<p><strong>in运算符</strong></p>
<p>给出确定数据的范围判断</p>
<p>语法: <code>xx in (值1, 值2, 值3, ...);</code></p>
<p>含义: 表示字段xx的值为所给出的这些值中的一个，就算是满足了条件；这些值，通常是零散无规律的。</p>
<p><strong>like运算符</strong></p>
<p>对字符串进行模糊查找</p>
<p>语法: <code>xx like &#39;要查找的内容&#39;</code></p>
<p>含义: 实现对字符串的某种特征信息的模糊查找，它依赖于一下两个特殊的符号。</p>
<ul>
<li><code>%</code> :它代表任何个数的任何字符</li>
<li><code>_</code> :它代表一个任何字符</li>
</ul>
<p><strong>group by 分组</strong></p>
<p>形式: <code>group by 字段1 [desc|asc] ,字段2 [desc | asc], ....</code></p>
<p>说明:</p>
<ol>
<li>分组是对前述已经找出的数据(既<code>where</code>已经筛选结束的)进行某种指定标准依据的分组。</li>
<li>同时，该分组结果，可以同时指定其 排序方式 ：<code>desc</code>倒序 ，<code>asc</code>顺序</li>
<li>通常，分组就是一个字段，2个以上很少</li>
</ol>
<p>什么叫做分组？</p>
<p>分组: 就是讲多行数据，以某种标准(就是指定的字段)来进行分类存放。</p>
<p>特别注意: 分组之后的结果，一定要理解为：只有一个个的组。 在部分语言此语法可能会出现不同的问题。</p>
<p>应用中，分组之后，通常只有如下几种可用的组信息。</p>
<ul>
<li>分组依据本身的信息，其实就是该分组依据的字段名</li>
<li>每一组的数量信息: 就是<code>count(*)</code>获得</li>
<li>原来数据中的 数值类型字段的聚合信息 包括如下几个:</li>
<li>最大值: <code>max(字段名)</code>; 最小值: <code>min(字段名)</code>; 平均值 <code>avg(字段名)</code>; 总和值: <code>sum(字段名)</code>; 上述其实是4个系统内部函数。</li>
</ul>
<p><strong>having 子句</strong></p>
<p><code>having</code>的作用和<code>where</code>完全一样，但其只是对 分组的结果数据 进行筛选。 既<code>where</code>对原始数据进行筛选； <code>having</code>对分组之后的数据进行筛选。</p>
<p>这里既是在<code>select</code> 后面没有写查询<code>count(*)</code> 时，在<code>having</code>设定筛选条件的时候，也可以使用，因为<code>count(\*)</code>是独立计算的结果，既对每一组进行原始数据行的统计，并用该条件进行筛选。</p>
<p><strong>恢复(导入)数据</strong></p>
<p>mysql登录后: <code>source &quot;备份数据文件的完整路径&quot;</code></p>
<p><strong>order by 子句</strong></p>
<p>用于 将前面取得的数据以设定的标准(字段)来进行排序以输出结果。</p>
<p>形式: <code>order by 字段1 [asc | desc], 字段2 [asc | desc], ...</code></p>
<p><strong>limit子句</strong></p>
<p>用于将 前述取得的数据 ，按指定的行取出来: 从第几行开始取出多少行。</p>
<p>形式: <code>limit</code> 起始行号 , 要取出的行号</p>
<p>说明: 行号默认从<code>0</code>开始， 行号和<code>id</code>没有关系。</p>
<h3 id="对select语句进行简要总结"><a href="#对select语句进行简要总结" class="headerlink" title="对select语句进行简要总结"></a>对select语句进行简要总结</h3><ol>
<li>虽然在形式上，<code>select</code>的很多子句都是可以省略的，但是他们的顺序(如果出现)，就不能打乱:必须仍然按照给出的顺序写出</li>
<li><code>where</code>子句依赖于<code>from</code>子句: 既没有<code>from</code>，就不能有<code>where</code></li>
<li><code>having</code>子句依赖于<code>group by</code>子句: 既没有<code>group by</code>就不能有<code>having</code></li>
<li><code>select</code> 中的字段也是依赖于<code>from</code>子句</li>
<li>上述子句的执行过程，基本上也是按照该顺序进行: – 从from的数据源中获取所有的数据，然后使用<code>where</code>对这些数据进行筛选，之后再使用<code>group by</code>子句对筛选出来的数据进行分组，接下来才可以使用<code>having</code>对这些分组的数据进行筛选，然后才可以<code>order by</code> 和<code>limit</code>。</li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/09/08/mysql/mysql_2 基本查询语句/" data-id="cj7bo43r20003v5pj2v2k51v0" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2017/09/08/mysql/mysql_2 基本查询语句/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/ssh/">ssh</a></p>
                            <p class="item-title"><a href="/2017/09/20/other/Gitlab权限说明/" class="title">Gitlab权限说明</a></p>
                            <p class="item-date"><time datetime="2017-09-20T09:54:25.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/glide/">glide</a></p>
                            <p class="item-title"><a href="/2017/09/20/android/github/glide解析5_图片变换/" class="title">Glide解析5_图片变换</a></p>
                            <p class="item-date"><time datetime="2017-09-20T08:53:48.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/glide/">glide</a></p>
                            <p class="item-title"><a href="/2017/09/20/android/github/glide解析4_回调监听/" class="title">Glide解析4_回调监听</a></p>
                            <p class="item-date"><time datetime="2017-09-20T08:46:52.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/09/20/android/github/glide解析3_缓存流程/" class="title"></a></p>
                            <p class="item-date"><time datetime="2017-09-20T08:42:24.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/android/">android</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/android/glide/">glide</a></p>
                            <p class="item-title"><a href="/2017/09/20/android/github/glide解析2_执行流程/" class="title">Glide解析2_执行流程</a></p>
                            <p class="item-date"><time datetime="2017-09-20T08:40:45.000Z" itemprop="datePublished">2017-09-20</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">43</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/android/code/">code</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/github/">github</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/glide/">glide</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android-编程实战》/">《Android 编程实战》</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android开发艺术探索》/">《Android开发艺术探索》</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/《Android编程权威指南》/">《Android编程权威指南》</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/设计模式/">设计模式</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/面试/">面试</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/learn/">learn</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/learn/《如何高效学习》/">《如何高效学习》</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node/7days/">7days</a><span class="category-list-count">7</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ssh/">ssh</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vim/">vim</a><span class="category-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">54</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">7</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/analysis/">analysis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">37</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anslysis/">anslysis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/autoLink/">autoLink</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code/">code</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glide/">glide</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/indicator/">indicator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/learn/">learn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/share/">share</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/textview/">textview</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/analysis/" style="font-size: 10px;">analysis</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/anslysis/" style="font-size: 10px;">anslysis</a> <a href="/tags/autoLink/" style="font-size: 10px;">autoLink</a> <a href="/tags/code/" style="font-size: 16.67px;">code</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/github/" style="font-size: 18.33px;">github</a> <a href="/tags/glide/" style="font-size: 15px;">glide</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/indicator/" style="font-size: 10px;">indicator</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/learn/" style="font-size: 10px;">learn</a> <a href="/tags/markdown/" style="font-size: 11.67px;">markdown</a> <a href="/tags/mysql/" style="font-size: 16.67px;">mysql</a> <a href="/tags/node/" style="font-size: 18.33px;">node</a> <a href="/tags/share/" style="font-size: 10px;">share</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/ssh/" style="font-size: 11.67px;">ssh</a> <a href="/tags/textview/" style="font-size: 10px;">textview</a> <a href="/tags/vim/" style="font-size: 11.67px;">vim</a> <a href="/tags/设计模式/" style="font-size: 11.67px;">设计模式</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 Ernest Chang<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2142274"></script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>